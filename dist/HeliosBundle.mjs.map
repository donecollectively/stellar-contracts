{"version":3,"file":"HeliosBundle.mjs","sources":["../src/helios/CachedHeliosProgram.ts","../src/helios/scriptBundling/HeliosScriptBundle.ts"],"sourcesContent":["import {\n    Program,\n    type CompileOptions,\n    type ProgramProps,\n} from \"@helios-lang/compiler\";\nimport type { Source } from \"@helios-lang/compiler-utils\";\nimport {\n    decodeUplcProgramV2FromCbor,\n    deserializeUplcSourceMap,\n    makeUplcSourceMap,\n    type UplcProgramV2,\n    type UplcSourceMapJsonSafe,\n} from \"@helios-lang/uplc\";\nimport { bytesToHex } from \"@helios-lang/codec-utils\";\nimport { blake2b } from \"@helios-lang/crypto\";\nimport { extractName } from \"@helios-lang/compiler\";\n\nimport { textToBytes } from \"../HeliosPromotedTypes.js\";\nimport type { CompileOptionsForCachedHeliosProgram } from \"../HeliosPromotedTypes.js\";\n\nexport type CacheableProgramProps = ProgramProps & {\n    isTestnet: boolean; // non-optional\n    /**\n     * The cache key for the program. Defaults to the hash of the source code.\n     * If there is no source code, the cacheKey is required\n     */\n    cacheKey?: string;\n    /**\n     * The timeout, in milliseconds for waiting for another instance to finish compiling.\n     * The default timeout is 30 seconds.\n     */\n    timeout?: number;\n    /**\n     * The expected script hash for the program.  The compiled program is checked against\n     * this script hash, if provided.\n     */\n    expectedScriptHash?: string;\n    /**\n     * name of the script, which may be different from the name of the script's entry-point\n     * / main module\n     */\n    name?: string;\n};\n\ntype OptimizeOptions =\n    | false\n    | Omit<\n          Exclude<CompileOptions[\"optimize\"], boolean | undefined>,\n          \"iterSpecificOptions\" | \"commonSubExprCount\"\n      >;\n\n/**\n * @internal\n */\nexport type HeliosProgramCacheEntry = {\n    version: \"PlutusV2\" | \"PlutusV3\";\n    createdBy: string;\n    programElements: Record<string, string | Object>;\n    optimizeOptions: OptimizeOptions;\n    optimized?: UplcProgramV2; // | UplcProgramV3I;\n    unoptimized?: UplcProgramV2; //| UplcProgramV3I;\n    optimizedIR?: string;\n    unoptimizedIR?: string;\n    optimizedSmap?: UplcSourceMapJsonSafe;\n    unoptimizedSmap?: UplcSourceMapJsonSafe;\n};\n\n/**\n * @internal\n */\nexport type SerializedHeliosCacheEntry = {\n    version: \"PlutusV2\" | \"PlutusV3\";\n    createdBy: string;\n    programElements: Record<string, string | Object>;\n    optimizeOptions: OptimizeOptions;\n    optimized?: string;\n    unoptimized?: string;\n    optimizedIR?: string;\n    unoptimizedIR?: string;\n    optimizedSmap?: UplcSourceMapJsonSafe;\n    unoptimizedSmap?: UplcSourceMapJsonSafe;\n};\n\n/**\n * @internal\n */\nexport type DeployedProgramBundle = Pick<\n    SerializedHeliosCacheEntry,\n    | \"version\"\n    | \"programElements\"\n    | \"optimized\"\n    | \"unoptimized\"\n    | \"optimizedIR\"\n    | \"unoptimizedIR\"\n    | \"optimizedSmap\"\n    | \"unoptimizedSmap\"\n>;\n\n/**\n * @internal\n */\nexport type lockInfo<T> = {\n    lock: T;\n    release: () => void;\n};\n\n/**\n * @internal\n */\nexport type LockInfoForStrat<T extends CachedHeliosProgram> = Awaited<\n    ReturnType<T[\"acquireLock\"]>\n>;\n\nconst redirecToCorrectConstructor =\n    \"üê¢${this.id}: wrong direct use of new() constructor in CachedHeliosProgram; use forCurrentPlatform() instead\";\n\n/**\n * A Helios program that caches its compiled UPLC program.\n * @remarks\n * Only available in the node.js environment for now, by importing\n * HeliosProgramWithCacheAPI from the @stellar-contracts/HeliosProgramWithCacheAPI module.\n *\n * ### Feedback please?\n * Probably nobody ever sees this doc?  If you do, please let us know!\n * @public\n */\nexport class CachedHeliosProgram extends Program {\n    // static memoryCache = new Map<string, UplcProgramV2 | UplcProgramV3>();\n    props: CacheableProgramProps;\n    locks: Map<string, lockInfo<any>> = new Map();\n    programElements: Record<string, string | Object>;\n    cacheEntry: HeliosProgramCacheEntry | undefined;\n\n    sources: (Source | string)[];\n    static id: string =\n        globalThis?.id || Math.floor(Math.random() * 1000).toString();\n    id: string;\n\n    /**\n     * Creates a new CachedHeliosProgram.\n     * @remarks\n     * Expects the same arguments as the Helios {@link Program} constructor.\n     *\n     * Returns a Program subclass that also conforms to the CachedHeliosProgram interface.\n     *\n     * Use the {@link compileCached | compileCached()} method to compile the program.\n     * @public\n     */\n    constructor(mainSource: string | Source, props: CacheableProgramProps) {\n        super(mainSource, props);\n        this.sources = [mainSource, ...(props?.moduleSources || [])];\n        this.programElements = {};\n        this.id = this.subclass.id;\n        const effectiveProps = {\n            ...{\n                timeout: 30000,\n            },\n            ...(props || {}),\n        };\n        this.props = effectiveProps;\n\n        if (this.constructor === CachedHeliosProgram) {\n            throw new Error(redirecToCorrectConstructor);\n        }\n    }\n\n    /**\n     * Checks for the presence of a cache key, without attempting a lock.  Indicates\n     * whether the program is in the cache; if so, no lock is needed to read it.  Returns\n     * the cached program if found, or null if not found.  Must be implemented by each subclass\n     * as a platform-specific STATIC method.\n     */\n    static async ifCached(cacheKey: string): Promise<string | null> {\n        throw new Error(redirecToCorrectConstructor);\n    }\n\n    /**\n     * Acquires a lock for the given cache key.  Must be implemented by each subclass\n     * as a platform-specific STATIC method.  Blocks while waiting for the lock.  Returns\n     * the lock details or throws an error if the lock cannot be acquired.\n     * The method receives the cache key and the program properties, which includes\n     * the timeout to be used.\n     */\n    static async acquireLock(\n        cacheKey: string,\n        props: CacheableProgramProps\n    ): Promise<lockInfo<any>> {\n        throw new Error(redirecToCorrectConstructor);\n    }\n\n    /**\n     * Acquires a lock for the given cache key, but does not wait.  Must be implemented by each subclass\n     * as a platform-specific STATIC method.\n     */\n    static async acquireImmediateLock(\n        cacheKey: any,\n        props: CacheableProgramProps\n    ): Promise<lockInfo<any> | null> {\n        throw new Error(redirecToCorrectConstructor);\n    }\n\n    /**\n     * Stores a compiled UPLC program in the cache.  Must be implemented by each subclass\n     * as a platform-specific STATIC method.\n     */\n    static async cacheStore(\n        key: string,\n        value: string,\n        raw: HeliosProgramCacheEntry\n    ): Promise<void> {\n        throw new Error(redirecToCorrectConstructor);\n    }\n\n    static async initCacheFromBundle(\n        cacheEntries: Record<string, string | SerializedHeliosCacheEntry>\n    ): Promise<void> {\n        //!!! todo work on this more\n        for (const [key, value] of Object.entries(cacheEntries)) {\n            const found = await this.ifCached(key);\n            if (found) {\n                console.log(\n                    `üê¢${this.id}: duplicate key in compiler cache: ${key}`\n                );\n            }\n            if (\"string\" === typeof value) {\n                this.cacheStore(\n                    key,\n                    value,\n                    this.toHeliosProgramCacheEntry(JSON.parse(value))\n                );\n            } else {\n                const { version } = value;\n                if (version !== \"PlutusV2\" && version !== \"PlutusV3\") {\n                    console.log(\n                        `üê¢${this.id}: unknown version '${version}'' in compiler cache entry: ${key}; skipping`\n                    );\n                    continue;\n                }\n                try {\n                    programFromCacheEntry(value);\n                } catch (e: any) {\n                    console.log(e.message);\n                    console.log(\n                        `^^ üê¢${this.id}: error parsing CBOR program from cache entry: ${key}; skipping`\n                    );\n                    continue;\n                }\n\n                this.cacheStore(\n                    key,\n                    JSON.stringify(value),\n                    this.toHeliosProgramCacheEntry(value)\n                );\n            }\n        }\n    }\n\n    static toHeliosProgramCacheEntry(\n        value: SerializedHeliosCacheEntry\n    ): HeliosProgramCacheEntry {\n        throw new Error(\"todo\");\n    }\n\n    /**\n     * for vscode index view\n     * @internal\n     */\n    private async ______endStatics() {}\n\n    // hashObjectElements(obj: Record<string, string>): Record<string, string> {\n    //     return Object.fromEntries(\n    //         Object.entries(obj).map(([name, content]) => [\n    //             name,\n    //             bytesToHex(blake2b(textToBytes(content))),\n    //         ])\n    //     );\n    // }\n\n    /**\n     * transforms an object of strings, hashing its values\n     */\n    hashObjectEntries(obj: Record<string, string>): Record<string, string> {\n        return Object.fromEntries(\n            Object.entries(obj).map(([name, content]) => [\n                name,\n                bytesToHex(blake2b(textToBytes(content))),\n            ])\n        );\n    }\n\n    /**\n     * transforms an object of strings to a text representation in RFC822 \"headers\" style\n     */\n    objectToText(obj: Record<string, string | number | boolean>): string {\n        return Object.entries(obj)\n            .map(([name, content]) => `${name}: ${content}`)\n            .join(\"\\n\");\n    }\n\n    /**\n     * Builds an index of the source code hashes for the program elements\n     * (main script, other modules)\n     */\n    sourceHashIndex(): Record<string, string> {\n        return this.hashObjectEntries(\n            Object.fromEntries(\n                this.sources.map((s) => {\n                    const name =\n                        \"string\" === typeof s ? extractName(s) : s.name;\n                    const content = \"string\" === typeof s ? s : s.content;\n                    return [name, content];\n                })\n            )\n        );\n    }\n\n    /**\n     * Gathers the program elements needed for caching\n     */\n    gatherProgramElements(): Record<string, string | Object> {\n        return (this.programElements = {\n            ...this.sourceHashIndex(),\n            params: this.entryPoint.paramsDetails(),\n        });\n    }\n\n    computeInputsHash(options: CompileOptionsForCachedHeliosProgram): string {\n        const index = {\n            ...this.programElements,\n        };\n        const { params, ...otherElements } = index;\n        const elementsText = this.objectToText(otherElements as any);\n        const paramsContent = this.objectToText(params as any);\n        // let optimize: OptimizeOptions = options.optimize ?? {};\n        // if (true == optimize) optimize = {};\n        // const optimizeText =\n        // false == optimize ? \"unoptimized\" : this.objectToText(optimize);\n        const optimizeText = this.textOptimizeOptions(options);\n        const optimizeHash = bytesToHex(blake2b(textToBytes(optimizeText)));\n\n        const paramsHashText = this.objectToText(\n            this.hashObjectEntries({ params: paramsContent })\n        );\n        return bytesToHex(\n            blake2b(\n                textToBytes(\n                    elementsText +\n                        \"\\n\" +\n                        paramsHashText +\n                        \"\\n\" +\n                        optimizeHash +\n                        \"\\n\"\n                )\n            )\n        );\n    }\n\n    optimizeOptions(\n        options: CompileOptionsForCachedHeliosProgram\n    ): OptimizeOptions {\n        let optimize: OptimizeOptions =\n            true == options.optimize\n                ? {}\n                : (options.optimize as OptimizeOptions) ?? {};\n\n        return optimize;\n    }\n\n    textOptimizeOptions(options: CompileOptionsForCachedHeliosProgram): string {\n        let optimize = this.optimizeOptions(options);\n        if (false == optimize) return \"unoptimized\";\n        type justOptions = Exclude<OptimizeOptions, false>;\n        let o: justOptions = optimize as any;\n        return this.objectToText(\n            // sort the keys in optimize.\n            Object.fromEntries(\n                Object.entries(o).sort(([a], [b]) => a.localeCompare(b))\n            ) as justOptions\n        );\n    }\n\n    get preferredProgramName(): string {\n        return this.props.name || this.name;\n    }\n\n    getCacheKey(options: CompileOptionsForCachedHeliosProgram): string {\n        if (this.props.cacheKey) {\n            // for using ScriptHash as the caching key\n            return this.props.cacheKey;\n        }\n        const hashString = this.computeInputsHash(options);\n        const opt = false == options.optimize ? \"-unoptimized\" : \"\";\n\n        return `${this.preferredProgramName}${opt}-${hashString}`;\n    }\n\n    /**\n     * Compiles a Helios program to UPLC, with caching for performance\n     *\n     * ### Caching behavior\n     * This method seeks to quickly return a compiled version of the program, using\n     * a platform-specific cache (and lock) mechanism.\n     * #### Happy path\n     *  - if the program is found in the cache, it is immediately returned\n     * #### First compilation and cache-storage\n     *  - Otherwise, a lock is acquired and the program is compiled\n     *  - Once compiled, the cache entry is created for future use, and its lock is lifted\n     *\n     * #### When there is a compile already pending\n     *\n     * Once a Helios program starts compiling once, calling `compileCached()` on any\n     * instance of the same program with the same settings results in the same cache\n     * key.  This may occur in a different browser tab, service worker, node-js thread/worker,\n     * or a different node process.  In each case, the second `compileCached()` call:\n     *\n     *  - Issues a warning that it is waiting for another process to complete the compilation.\n     *  - waits up to 15 seconds (or the configured `timeout`) for a lock (indicating that\n     *    another instance is compiling the program already)\n     * - when the lock  is released, the compiled program is read from the cache, and returned.\n     *  - includes the unoptimized version of the UPLC program for logging\n     *\n     * #### When everything goes wrong\n     * If the process holding a lock doesn't succeed and doesn't release the lock, the\n     * lock goes stale automatically, and the lock fails (after the `timeout` period).  In\n     * this case, each instance of the program:\n     *\n     *   - makes a last attempt to compile the program\n     *   - If it fails, the local process will report the error normally, and no caching is done\n     *   - If it succeeds, the result is returned.\n     *   - it also tries to cache the result (if it can do so without delay)\n     *\n     *  - todo: measure the time cost of the \"has errors\" path.\n     *\n     * See Helios' {@link Program.compile} for more information about compiling Helios programs.\n     *\n     * import from stellar-contracts/CacheableProgramAPI in a node.js environment\n     * to access this method.  In the web environment, that import returns a different\n     * class with the same interface.\n     */\n    async compileWithCache(\n        optimizeOrOptions: boolean | CompileOptionsForCachedHeliosProgram\n    ): Promise<UplcProgramV2> {\n        // Promise<UplcProgramV2 | UplcProgramV3> {\n        const options: CompileOptionsForCachedHeliosProgram =\n            typeof optimizeOrOptions === \"boolean\"\n                ? { optimize: optimizeOrOptions }\n                : optimizeOrOptions;\n        const optimize = this.optimizeOptions(optimizeOrOptions as any);\n\n        const programElements = (this.programElements =\n            this.gatherProgramElements());\n\n        const cacheKey = this.getCacheKey(options);\n        // const cachedProgram = CachedHeliosProgram.memoryCache.get(cacheKey);\n\n        const fromCache = await this.getFromCache(cacheKey);\n        if (fromCache) {\n            // const programCount = fromCache.alt ? 2 : 1;\n            console.log(`üê¢${this.id}: ${cacheKey}: from cache`);\n            return fromCache;\n        }\n        // not in cache.  Get the lock; if we get it, then we compile.  If not, we wait\n        // for the lock to be released by another instance.\n        const weMustCompile = await this.acquireImmediateLock(cacheKey);\n        const otherInstanceIsCompiling = !weMustCompile;\n        if (otherInstanceIsCompiling) {\n            console.log(\n                `üê¢${this.id}: waiting for pending compile: ${cacheKey}`\n            );\n            try {\n                const cacheEntry = await this.waitForCaching(cacheKey);\n                const program = programFromCacheEntry(cacheEntry);        \n                this.cacheEntry = deserializeHeliosCacheEntry(cacheEntry);\n                debugger\n                return program\n            } catch (e) {\n                console.log(\n                    `üê¢${this.id}: Failed getting cache-awaited program with cacheKey: ${cacheKey}; will compile in-process`\n                );\n                // if this happens, there should be a lock in the locks map... vvvvv\n            }\n        }\n        // we either are delayed from a failed wait-for-cache (with pending lock)\n        // ... or we got an immediate lock\n        let lock = weMustCompile || this.locks.get(cacheKey);\n        if (!lock) {\n            throw new Error(\n                `we should have a lock one way or other at this point`\n            );\n        }\n\n        try {\n            console.log(\n                `üê¢${this.id}: compiling program with cacheKey: ${cacheKey}`\n            );\n            // slow!\n            const uplcProgram = this.compile(options);\n            const cacheEntry: HeliosProgramCacheEntry = {\n                version: \"PlutusV2\",\n                createdBy: this.id,\n                optimizeOptions: optimize,\n                programElements,\n            };\n\n            if (uplcProgram.alt) {\n                cacheEntry.unoptimized = uplcProgram.alt;\n                cacheEntry.unoptimizedIR = uplcProgram.alt.ir;\n                cacheEntry.unoptimizedSmap = makeUplcSourceMap({\n                    term: uplcProgram.alt.root,\n                }).toJsonSafe();\n\n                cacheEntry.optimized = uplcProgram;\n                cacheEntry.optimizedIR = uplcProgram.ir;\n                cacheEntry.optimizedSmap = makeUplcSourceMap({\n                    term: uplcProgram.root,\n                }).toJsonSafe();\n            } else {\n                const sourceMap = makeUplcSourceMap({ term: uplcProgram.root });\n                if (false == options.optimize) {\n                    cacheEntry.unoptimized = uplcProgram;\n                    cacheEntry.unoptimizedIR = uplcProgram.ir;\n                    cacheEntry.unoptimizedSmap = sourceMap.toJsonSafe();\n                } else {\n                    cacheEntry.optimized = uplcProgram;\n                    cacheEntry.optimizedIR = uplcProgram.ir;\n                    cacheEntry.optimizedSmap = sourceMap.toJsonSafe();\n                }\n            }\n            this.cacheEntry = cacheEntry;\n            this.storeInCache(cacheKey, cacheEntry);\n            return uplcProgram;\n        } catch (e: any) {\n            debugger;\n            console.log(\n                `üê¢${this.id}: compiler cache: throwing compile error: ${e.message} (not caching) (dbpa)`\n            );\n            this.releaseLock(cacheKey);\n            throw e;\n        }\n    }\n\n    async waitForCaching(\n        cacheKey: string\n    ): Promise<SerializedHeliosCacheEntry> {\n        // we won't get the lock very quickly, but it should come through as\n        // soon as the other process finishes.\n        return this.acquireLock(cacheKey).then(async (lock) => {\n            if (lock) {\n                const cached = await this.ifCached(cacheKey);\n                if (cached) {\n                    lock?.release();\n                    return cached;\n                }\n                // things aren't great if we get here.  But we got the lock, so we can\n                // use it to store the program in the cache.\n                this.locks.set(cacheKey, lock);\n                console.log(\n                    `üê¢${this.id}: waitForCaching: Lock acquired but no cache entry.  Storing lock in map`\n                );\n                throw new Error(\n                    `Lock acquired but no cache entry for ${cacheKey}; compute locally then release this.locks[key].`\n                );\n            }\n            throw new Error(\n                `Lock for ${cacheKey} not acquired; compute locally (and try to populate the cache if possible)`\n            );\n        });\n    }\n\n    async getFromCache(\n        cacheKey: string\n    ): Promise<undefined | UplcProgramV2 /* | UplcProgramV3 */> {\n        const cacheEntry = await this.ifCached(cacheKey);\n        if (cacheEntry) {\n            this.cacheEntry = deserializeHeliosCacheEntry(cacheEntry)\n            // debugger\n            return programFromCacheEntry(cacheEntry);\n        }\n        return undefined;\n    }\n\n    get subclass(): typeof CachedHeliosProgram {\n        return this.constructor as typeof CachedHeliosProgram;\n    }\n\n    static checkPlatform(): \"web\" | \"nodejs\" {\n        // determine if in-browser or using node.js\n        // thanks to https://gist.github.com/rhysburnie/498bfd98f24b7daf5fd5930c7f3c1b7b\n\n        // alt: consider this approach https://stackoverflow.com/a/31090240\n\n        // thuthy\n        var _nodejs: any =\n            typeof process !== \"undefined\" &&\n            process.versions &&\n            process.versions.node;\n        if (_nodejs) {\n            _nodejs = {\n                version: process.versions.node,\n            };\n        }\n\n        // truthy\n        var _browser: any =\n            !_nodejs &&\n            (typeof window !== \"undefined\" || typeof self !== \"undefined\");\n        if (_browser) {\n            // _browser = {\n            //     window: false,\n            //     self: false,\n            //     $: false,\n            // };\n            if (typeof global === \"undefined\") {\n                if (typeof window !== \"undefined\") {\n                    global = window;\n                    _browser.window = true;\n                } else if (typeof self !== \"undefined\") {\n                    global = self;\n                    _browser.self = true;\n                }\n                // } else if (typeof $ !== \"undefined\") {\n                //     global = $;\n                //     _browser.$ = true;\n                // }\n            }\n        }\n\n        if (_nodejs) {\n            console.log(\"Node.js detected\");\n            return \"nodejs\";\n            // module.export = {\n            //     nodejs: _nodejs,\n            //     browser: _browser,\n            // };\n        }\n        console.log(\"Browser env detected\");\n        return \"web\";\n    }\n\n    /**\n     * for vscode index view\n     * @internal\n     */\n    async __vvv_______instanceToStatic() {}\n\n    async ifCached(\n        cacheKey: string\n    ): Promise<SerializedHeliosCacheEntry | null> {\n        const string = await this.subclass.ifCached(cacheKey);\n        if (string) {\n            try {\n                return JSON.parse(string) as SerializedHeliosCacheEntry;\n            } catch (e: any) {\n                console.log(\n                    `  -- üê¢${this.id}: cleaning up invalid cache entry for ${cacheKey}: ${e.message}`\n                );\n                // (cleanup implied by returning null)\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Acquires a lock for the given cache key, waiting according to the\n     * configured `timeout` for another instance to finish compiling.\n     *\n     * Throws an error if the timeout expires\n     */\n    async acquireLock(cacheKey: string) {\n        return this.subclass.acquireLock(cacheKey, this.props).then((lock) => {\n            this.locks.set(cacheKey, lock);\n            return lock;\n        });\n    }\n\n    /**\n     * Acquires a lock for the given cache key if it can do so immediately.\n     * Stores the lock in the instance's lock map.\n     */\n    async acquireImmediateLock(cacheKey: string) {\n        const lock = await this.subclass.acquireImmediateLock(\n            cacheKey,\n            this.props\n        );\n        if (lock) {\n            this.locks.set(cacheKey, lock);\n        }\n        return lock;\n    }\n\n    /**\n     * Stores a compiled UPLC program in the cache.\n     * Requires the lock to exist.\n     * Releases the lock after storing the program.\n     */\n    async storeInCache(\n        cacheKey: string,\n        value: HeliosProgramCacheEntry\n    ): Promise<void> {\n        if (!this.locks.has(cacheKey)) {\n            throw new Error(\n                `storeInCache: the lock for ${cacheKey} is not present`\n            );\n        }\n\n        return this.subclass\n            .cacheStore(\n                cacheKey,\n                stringifyCacheEntry(value),\n                value\n            )\n            .then(() => {\n                this.releaseLock(cacheKey);\n            });\n    }\n\n    /**\n     * Releases the lock for the given cache key.\n     * Removes the lock from the instance's lock map.\n     * Throws an error if the lock is not found.\n     */\n    releaseLock(cacheKey: string) {\n        const lock = this.locks.get(cacheKey);\n        if (lock) {\n            lock.release();\n            this.locks.delete(cacheKey);\n        } else {\n            throw new Error(`releaseLock: no lock found for ${cacheKey}`);\n        }\n    }\n}\n\nexport function stringifyCacheEntry(entry: HeliosProgramCacheEntry): string {\n    return JSON.stringify(\n        serializeCacheEntry(entry),\n        null,\n        2\n    );\n}\n\nexport function serializeCacheEntry(\n    entry: HeliosProgramCacheEntry): SerializedHeliosCacheEntry \n{\n    const { optimized, unoptimized } = entry;\n    return {\n        ...entry,\n        ...(optimized\n            ? { optimized: bytesToHex(optimized.toCbor()) }\n            : {}),\n        ...(unoptimized\n            ? { unoptimized: bytesToHex(unoptimized.toCbor()) }\n            : {}),\n    } as any;\n}\n\nexport function programFromCacheEntry(\n    fromCache: DeployedProgramBundle | SerializedHeliosCacheEntry\n): UplcProgramV2 {\n    //  | UplcProgramV3 {\n    // the program is a hex-string, accepted by both UplcProgramV2 and UplcProgramV3\n    const {\n        optimized,\n        optimizedIR,\n        unoptimized,\n        unoptimizedIR,\n        version,\n        optimizedSmap,\n        unoptimizedSmap,\n        // optimizeOptions,\n        // createdBy,\n        programElements\n    } = fromCache;\n    if (version !== \"PlutusV2\") throw new Error(`pv3supportpending`);\n    // TargetClass = version == \"PlutusV2\" ? UplcProgramV2 : UplcProgramV3;\n\n    const o = optimized\n        ? decodeUplcProgramV2FromCbor(optimized, {\n              ir: optimizedIR,\n              sourceMap: optimizedSmap,\n          })\n        : undefined;\n    const u = unoptimized\n        ? decodeUplcProgramV2FromCbor(unoptimized, {\n              ir: unoptimizedIR,\n              sourceMap: unoptimizedSmap,\n          })\n        : undefined;\n    if (o) {\n        if (u) {\n            return o.withAlt(u); // | UplcProgramV3;\n        }\n        return o;\n    }\n    if (!u) {\n        throw new Error(\n            `üê¢ No optimized or unoptimized program in cache entry: ${fromCache}`\n        );\n    }\n    return u;\n}\n\nexport function deserializeHeliosCacheEntry(\n    entry: SerializedHeliosCacheEntry\n): HeliosProgramCacheEntry {\n    const {\n        optimized,\n        optimizedIR,\n        unoptimized,\n        unoptimizedIR,\n        version,\n        optimizedSmap,\n        unoptimizedSmap,\n        optimizeOptions,\n        createdBy,\n        programElements\n    } = entry\n\n    return {\n        optimized: optimized ? decodeUplcProgramV2FromCbor(optimized) : undefined,\n        unoptimized: unoptimized ? decodeUplcProgramV2FromCbor(unoptimized) : undefined,\n        optimizedSmap: optimizedSmap || undefined, \n        //XXX it's already json-safe. deserializeUplcSourceMap(optimizedSmap).toJsonSafe() : undefined,\n        unoptimizedSmap: unoptimizedSmap || undefined,\n        //XXX it's already json-safe. deserializeUplcSourceMap(unoptimizedSmap).toJsonSafe(): undefined,\n        optimizeOptions,\n        version,\n        createdBy,\n        programElements,\n        optimizedIR,\n        unoptimizedIR,\n    };\n}\n","import type { DataType, Program } from \"@helios-lang/compiler\";\nimport type { Source } from \"@helios-lang/compiler-utils\";\nimport {\n    type UplcData,\n    type UplcProgramV2,\n    type UplcSourceMapJsonSafe,\n} from \"@helios-lang/uplc\";\nimport { decodeUplcProgramV2FromCbor } from \"@helios-lang/uplc\";\n// import { decodeUplcProgramV3FromCbor } from \"@helios-lang/uplc\";\n\nimport { HeliosProgramWithCacheAPI } from \"@donecollectively/stellar-contracts/HeliosProgramWithCacheAPI\";\n\nimport type { CapoHeliosBundle } from \"./CapoHeliosBundle.js\";\nimport type {\n    configBaseWithRev,\n    HeliosOptimizeOptions,\n    SetupOrMainnetSignalForBundle,\n    StellarBundleSetupDetails,\n    UplcRecord,\n} from \"../../StellarContract.js\";\nimport type { anyUplcProgram } from \"../../HeliosPromotedTypes.js\";\nimport type {\n    CapoBundleClass,\n    HeliosBundleClassWithCapo,\n    HeliosBundleTypes,\n} from \"../HeliosMetaTypes.js\";\nimport {\n    programFromCacheEntry,\n    serializeCacheEntry,\n} from \"../CachedHeliosProgram.js\";\nimport type {\n    RequiredDeployedScriptDetails,\n} from \"../../configuration/DeployedScriptConfigs.js\";\nimport { bytesToHex, equalsBytes } from \"@helios-lang/codec-utils\";\nimport { makeCast } from \"@helios-lang/contract-utils\";\nimport {\n    makeMintingPolicyHash,\n} from \"@helios-lang/ledger\";\nimport { environment } from \"../../environment.js\";\n\n/**\n * @internal\n */\nexport const defaultNoDefinedModuleName = \"‚Äπdefault-needs-override‚Ä∫\";\n\n/**\n * @public\n */\nexport const placeholderSetupDetails = {\n    setup: {\n        isMainnet: \"mainnet\" === environment.CARDANO_NETWORK,\n        isPlaceholder: \"for abstract bundleClass\",\n    },\n};\n\n/**\n * Base class for any Helios script bundle\n * @remarks\n * See also {@link CapoHeliosBundle} and {@link CapoDelegateBundle}\n * and {@link DelegatedDataBundle} for specialized bundle types\n * @public\n */\nexport abstract class HeliosScriptBundle {\n    /**\n     * an indicator of a Helios bundle that is intended to be used as a Capo contract\n     * @remarks\n     * the CapoHeliosBundle class overrides this to true.\n     * @internal\n     */\n    static isCapoBundle = false;\n    abstract requiresGovAuthority: boolean;\n    /**\n     * set to true if the bundle depends on having a deployed capo's configuration details\n     * @public\n     */\n    static needsCapoConfiguration = false;\n\n    /**\n     * an opt-in indicator of abstractness\n     * @remarks\n     * Subclasses that aren't intended for instantiation can set this to true.\n     *\n     * Subclasses that don't set this will not be treated as abstract.\n     * @public\n     */\n    static isAbstract?: boolean | undefined = undefined;\n\n    /**\n     * Constructs a base class for any Helios script bundle,\n     * given the class for an application-specific CapoHeliosBundle.\n     * @remarks\n     * The resulting class provides its own CapoHeliosBundle instance\n     * for independent use (specifically, for compiling this bundle using\n     * the dependency libraries provided by the Capo bundle).\n     */\n    //\n    //     * NOTE: the following is NOT needed for efficiency, and not implemented\n    //     *, as the Capo\n    //     * bundle referenced above should never need to be compiled via\n    //     * `this.capoBundle.program`.\n    //     *\n    //     * XXX - For application runtime purposes, it can ALSO accept a\n    //     * XXX - CapoHeliosBundle instance as a constructor argument,\n    //     * XXX - enabling lower-overhead instantiation and re-use across\n    //     * XXX - various bundles used within a single Capo,\n    //     */\n    static usingCapoBundleClass<CB extends CapoBundleClass>(\n        c: CB\n    ): HeliosBundleClassWithCapo {\n        //@ts-expect-error returning a subclass without concrete implementations\n        // of the abstract members; hopefully the subclass will error if they're missing\n        const cb = new c(placeholderSetupDetails);\n\n        abstract class aCapoBoundBundle extends HeliosScriptBundle {\n            capoBundle = cb;\n            constructor(\n                setupDetails: StellarBundleSetupDetails<any> = placeholderSetupDetails\n            ) {\n                super(setupDetails);\n            }\n\n            isConcrete = true;\n        }\n\n        return aCapoBoundBundle as HeliosBundleClassWithCapo &\n            typeof aCapoBoundBundle;\n    }\n\n    static create<THIS extends typeof HeliosScriptBundle>(\n        this: THIS,\n        setupDetails: StellarBundleSetupDetails<any> = placeholderSetupDetails\n    ) {\n        //@ts-expect-error creating instance of abstract class\n        const created = new this(setupDetails);\n\n        created.init(setupDetails);\n        return created;\n    }\n    abstract scriptParamsSource: \"config\" | \"bundle\" | \"mixed\";\n    capoBundle?: CapoHeliosBundle;\n    isConcrete = false;\n\n    /**\n     * optional attribute explicitly naming a type for the datum\n     * @remarks\n     * This can be used if needed for a contract whose entry point uses an abstract\n     * type for the datum; the type-bridge & type-gen system will use this data type\n     * instead of inferrring the type from the entry point.\n     */\n    datumTypeName?: string;\n\n    /**\n     * optional attribute explicitly naming a type for the redeemer\n     * @remarks\n     * This can be used if needed for a contract whose entry point uses an abstract\n     * type for the redeemer; the type-bridge & type-gen system will use this data type\n     * instead of inferring the type from the entry point.\n     */\n    redeemerTypeName: string = \"\";\n    isMainnet: boolean;\n    _program: HeliosProgramWithCacheAPI | undefined = undefined;\n    previousOnchainScript: {\n        validatorHash: number[];\n        uplcProgram: anyUplcProgram;\n    } | undefined = undefined;\n    _progIsPrecompiled = false;\n    setup: SetupOrMainnetSignalForBundle;\n    configuredUplcParams: UplcRecord<any> | undefined = undefined;\n    configuredParams: any | undefined = undefined;\n    preCompiled?: {\n        [variant: string]: RequiredDeployedScriptDetails<any, \"json\">;\n    };\n    alreadyCompiledScript: anyUplcProgram | undefined;\n\n    constructor(\n        setupDetails: StellarBundleSetupDetails<any> = placeholderSetupDetails\n    ) {\n        // this.devReloadModules()\n        // if (setupDetails) debugger;\n        this.setup = setupDetails.setup;\n        this.isMainnet = this.setup.isMainnet;\n\n        if (this.setup && \"undefined\" === typeof this.isMainnet) {\n            debugger;\n            throw new Error(\n                `${this.constructor.name}: setup.isMainnet must be defined (debugging breakpoint available)`\n            );\n        }\n    }\n\n    get hasAnyVariant() {\n        return true;\n    }\n    _didInit = false;\n    debug = false;\n    scriptHash?: number[] | undefined;\n\n    init(setupDetails: StellarBundleSetupDetails<any>) {\n        const {\n            deployedDetails,\n            params,\n            params: { delegateName, variant = \"singleton\" } = {},\n            setup,\n            previousOnchainScript\n        } = setupDetails;\n        const { config, programBundle } = deployedDetails || {};\n        if (previousOnchainScript) {\n            this.previousOnchainScript = previousOnchainScript;\n            this.scriptHash = previousOnchainScript.uplcProgram.hash();\n                // \"string\" === typeof deployedDetails?.scriptHash\n                //     ? hexToBytes(deployedDetails.scriptHash)\n                //     : deployedDetails?.scriptHash;\n            return;\n        }\n\n        if (this.scriptParamsSource === \"config\") {\n            if (programBundle) {\n            //     if (!scriptHash)\n            //         throw new Error(\n            //     `${this.constructor.name}: missing deployedDetails.scriptHash`\n            // );\n            \n                // debugger; // do we need to cross-check config <=> params ?\n                this.configuredParams = config;\n                this.configuredUplcParams = this.paramsToUplc(config);\n                this.preCompiled = {\n                    singleton: {programBundle, config },\n                };\n            } else if (params) {\n                if (this.preCompiled) {\n                    const thisVariant = this.preCompiled[variant];\n                    if (!thisVariant) {\n                        const msg = `${this.constructor.name}: no precompiled variant '${variant}'`;\n                        console.warn(\n                            `${msg}\\n  -- available variants: ${Object.keys(\n                                this.preCompiled\n                            ).join(\", \")}`\n                        );\n                        console.log(\n                            \"configured variant should be in scriptBundle's 'params'\"\n                        );\n                        throw new Error(msg);\n                    }\n                    this._selectedVariant = variant;\n                    const preConfig = thisVariant.config;\n                    preConfig.rev = BigInt(preConfig.rev);\n\n                    if (preConfig.capoMph?.bytes) {\n                        preConfig.capoMph = makeMintingPolicyHash(\n                            preConfig.capoMph.bytes\n                        );\n                    }\n                    const uplcPreConfig = this.paramsToUplc(preConfig);\n                    // omits delegateName from the strict checks\n                    //  ... it's provided by the bundle, which the\n                    //  ... off-chain wrapper class may not have access to.\n                    const {\n                        params: { delegateName, ...params },\n                    } = setupDetails;\n                    const uplcRuntimeConfig = this.paramsToUplc(params);\n                    let didFindProblem: string = \"\";\n                    for (const k of Object.keys(uplcPreConfig)) {\n                        const runtime = uplcRuntimeConfig[k];\n                        // skips past any runtime setting that was not explicitly set\n                        if (!runtime) continue;\n                        const pre = uplcPreConfig[k];\n                        if (!runtime.isEqual(pre)) {\n                            if (!didFindProblem) {\n                                console.warn(\n                                    `${this.constructor.name}: config mismatch between pre-config and runtime-config`\n                                );\n                                didFindProblem = k;\n                            }\n                            console.warn(\n                                `‚Ä¢ ${k}:  pre-config: `,\n                                preConfig[k] || (pre.rawData ?? pre),\n                                ` at runtime:`,\n                                params[k] || (runtime.rawData ?? runtime)\n                            );\n                        }\n                    }\n                    if (didFindProblem) {\n                        throw new Error(\n                            `runtime-config conflicted with pre-config (see logged details) at key ${didFindProblem}`\n                        );\n                    }\n                }\n                this.configuredParams = setupDetails.params;\n                this.configuredUplcParams = this.paramsToUplc(\n                    setupDetails.params\n                );\n            } else if (!setup.isPlaceholder) {\n                throw new Error(\n                    `${this.constructor.name}: scriptParamsSource=config, but no program bundle, no script params`\n                );\n            }\n        } else if (this.scriptParamsSource == \"mixed\") {\n            debugger;\n            const {params} = setupDetails\n            \n            if (this.configuredParams) {\n                debugger;\n                throw new Error(\n                    `unreachable: configuredParameters used without deployedDetails? (dbpa)`\n                );\n            }\n        } else if (this.scriptParamsSource == \"bundle\") {\n            // the bundle has its own built-in params\n\n            // temp singleton\n            const selectedVariant = \"singleton\";\n            this.configuredParams =\n                this.getPreconfiguredVariantParams(selectedVariant);\n            if (this.configuredParams) {\n                this.configuredUplcParams =\n                    this.getPreconfiguredUplcParams(selectedVariant);\n            }\n        } else {\n            throw new Error(`unknown scriptParamsSource: ${this.scriptParamsSource}`);\n        }\n        this._didInit = true;\n    }\n\n    get isPrecompiled() {\n        return !!this.preCompiled\n    }\n\n    getPreCompiledBundle(variant: string) {\n        const foundVariant = this.preCompiled?.[variant];\n        if (!foundVariant) {\n            throw new Error(\n                `${this.constructor.name}: variant ${variant} not found in preCompiled scripts`\n            );\n        }\n\n        return foundVariant.programBundle;\n    }\n\n    getPreconfiguredVariantParams(variantName: string) {\n        const p = this.variants?.[variantName] || this.params;\n        return p;\n    }\n\n    getPreconfiguredUplcParams(\n        variantName: string\n    ): UplcRecord<any> | undefined {\n        const p = this.getPreconfiguredVariantParams(variantName);\n        if (!p) return undefined;\n        return this.paramsToUplc(p);\n    }\n\n    withSetupDetails(details: StellarBundleSetupDetails<any>): this {\n        if (details.setup.isPlaceholder) {\n            debugger;\n            throw new Error(\n                `unexpected use of placeholder setup for helios script bundle (debugging breakpoint available)`\n            );\n        }\n        //@ts-expect-error with dynamic creation\n        const created = new this.constructor(details) as this;\n        created.init(details);\n        return created;\n    }\n\n    // these should be unnecessary if we arrange the rollup plugin\n    // ... to watch the underlying helios files for changes that would affect the bundle\n    // checkDevReload() {\n    //     const env = process.env.NODE_ENV;\n    //     if (env !== \"test\" && env !== \"development\") {\n    //         console.log(\"disabling module reloading in non-dev environment\");\n    //         return\n    //     }\n    //     this.reloadModule(this.main);\n    //     for (const module of this.modules) {\n    //         this.reloadModule(module)\n    //     }\n    // }\n    // reloadModule(module: HeliosModuleSrc) {\n    //     // treat module.name as a filename.\n    //     // check if it can be opened as a file.\n    //     // reassign module.content to the file's contents.\n\n    //     if (existsSync(module.name)) {\n    //         console.log(`bundle module load: ${module.name}`);\n    //         const newContent = readFileSync(module.name, \"utf8\");\n    //         if (module.content !== newContent) {\n    //             console.log(`‚ôªÔ∏è module reload: ${module.name}`);\n    //             module.content = newContent;\n    //         }\n    //     }\n    // }\n\n    get params() {\n        return undefined as any;\n    }\n    /**\n     * The known variants of this contract script, with any contract\n     * parameters applicable to each variant.  By default, there is a\n     * singleton variant that uses the result of `get params()`.\n     */\n    get variants(): { [variantName: string]: any } {\n        return { singleton: this.params };\n    }\n\n    get main(): Source {\n        throw new Error(\n            `${this.constructor.name}: get main() must be implemented in subclass`\n        );\n    }\n\n    /**\n     * A list of modules always available for import to Capo-hosted policy scripts\n     * @public\n     */\n    implicitIncludedCapoModules() : string[]{\n        return [\n            \"CapoMintHelpers\",\n            \"CapoDelegateHelpers\",\n            \"StellarHeliosHelpers\",\n            \"CapoHelpers\",\n        ];\n    }\n\n    /**\n     * specifies a list module names to be included in the compilation of this script\n     * @remarks\n     * Only used in bundles created with `HeliosScriptBundle.usingCapoBundleClass()` or\n     * `CapoDelegateBundle.usingCapoBundleClass()`.\n     *\n     * Each of these module-names MUST be provided by the CapoHeliosBundle used for\n     * this script bundle (in its `get modules()`).  CapoMintHelpers, CapoDelegateHelpers,\n     * StellarHeliosHelpers and CapoHelpers are always available for import to the\n     * policy script, and the module names you list here will be added to that list.\n     *\n     * These module names will then be available for `import { ... }` statements in your helios script.\n     *\n     * ### Beware of Shifting Sands\n     *\n     * If you include any modules provided by other scripts in your project, you should\n     * be aware that any material changes to those scripts will change your delegate's validator,\n     * resulting in a need to deploy new script contracts.  This is why it's important to only include\n     * modules that are relatively stable, or whose changes SHOULD trigger a new deployment\n     * for this script.\n     *\n     * When you can use isolation techniques including abstract data definitions and/or granular\n     * code-modularization, you can reduce the incidence of such changes while ensuring that needed\n     * upgrades are easy to manage.\n     * @public\n     */\n    includeFromCapoModules(): string[] {\n        return [];\n    }\n\n    /**\n     * Computes a list of modules to be provided to the Helios compiler\n     * @remarks\n     * includes any explicit `modules` from your script bundle, along with any\n     * modules, provided by your Capo and listed by name in your\n     * `includeFromCapoModules()` method.\n     * @public\n     */\n    getEffectiveModuleList() {\n        if (!this.capoBundle) {\n            return [...this.modules];\n        }\n\n        return [...this.resolveCapoIncludedModules(), ...this.modules];\n    }\n\n    resolveCapoIncludedModules() {\n        const includeList = [\n            ...this.implicitIncludedCapoModules(),\n            ...this.includeFromCapoModules(),\n        ];\n\n        const unsatisfiedIncludes = new Set(includeList);\n        const capoModules =this.capoBundle!.modules\n        if (!capoModules) {\n            throw new Error(`${this.capoBundle!.constructor.name}: no modules() list defined`)\n        }\n        const capoIncludedModules = capoModules.filter((x) => {\n            const mName = x.moduleName!;\n            const found = includeList.includes(mName);\n            unsatisfiedIncludes.delete(mName);\n            return found;\n        });\n\n        if (unsatisfiedIncludes.size) {\n            throw new Error(\n                `${\n                    this.displayName\n                }: includeFromCapoModules() includes modules not provided by the Capo:\\n ${Array.from(\n                    unsatisfiedIncludes\n                )\n                    .map((m) => `   ‚Ä¢ ${m}\\n`)\n                    .join(\"\\n\")}`\n            );\n        }\n\n        return capoIncludedModules;\n    }\n\n    logModuleDetails() {\n        const capoIncludedModules = this.resolveCapoIncludedModules();\n\n        function moduleDetails(m: Source) {\n            const pInfo = m.project ? ` [in ${m.project}]/` : \"\";\n            return `    ‚Ä¢ ${m.moduleName}${pInfo}${m.name} (${m.content.length} chars)`;\n        }\n\n        console.log(\n            `\\nModules in ${this.displayName}:\\n` +\n                ` ‚Ä¢ includeFromCapoModules(): ${this.includeFromCapoModules().join(\n                    \", \"\n                )}\\n` +\n                ` ‚Ä¢ implicit Capo modules:    ${this.implicitIncludedCapoModules().join(\n                    \", \"\n                )}\\n` +\n                ` ‚Ä¢ modules from Capo: \\n${capoIncludedModules\n                    .map(moduleDetails)\n                    .join(\"\\n\")}\\n` +\n                ` ‚Ä¢ get modules() (${this.modules.length}): \\n${this.modules\n                    .map(moduleDetails)\n                    .join(\"\\n\")}`\n        );\n    }\n\n    /**\n     * lists any helios modules owned by & needed for this script bundle.\n     * @remarks\n     * Modules listed here should (imported from their .hl files as helios Source objects.\n     *\n     * Any modules shared ***from other script bundles in your project*** should instead be\n     * added to your Capo's `modules`, and named in your `includeFromCapoModules()` method.\n     *\n     * Any of these modules needed by ***other script bundles*** in your project may also be\n     * listed in your Capo's `modules`.\n     */\n    get modules(): Source[] {\n        return [];\n    }\n\n    get displayName() {\n        return this.moduleName || this.program.name;\n    }\n    get bridgeClassName() {\n        const mName = this.displayName;\n        return `${mName}DataBridge`;\n    }\n\n    /**\n     * indicates whether the script should be optimized.\n     * @remarks\n     * Defaults to the general optimize setting provided by the factoryArgs.\n     * Override to force optimization on or off.\n     */\n    get optimize() : HeliosOptimizeOptions | boolean | undefined {\n        return this.setup!.optimize ?? true;\n    }\n\n    get moduleName() {\n        return this.constructor.name\n            .replace(/Bundle/, \"\")\n            .replace(/Helios/, \"\");\n        defaultNoDefinedModuleName; // overridden in subclasses where relevant\n    }\n\n    _selectedVariant?: string;\n    withVariant(vn: string) {\n        if (!this.variants) {\n            throw new Error(\n                `variants not defined for ${this.constructor.name}`\n            );\n        }\n        const foundVariant = this.variants[vn] ?? this.preCompiled?.[vn];\n        if (!foundVariant) {\n            throw new Error(\n                `${this.constructor.name}: variant ${vn} not found in variants()`\n            );\n        }\n        if (this._selectedVariant) {\n            throw new Error(\n                `we aren't sharing variants on a single bundle instance, right?`\n            );\n        }\n\n        this._selectedVariant = vn;\n        return this;\n    }\n\n    previousCompiledScript() {\n        const { uplcProgram, validatorHash } = this.previousOnchainScript || {};\n        if (!uplcProgram) return undefined;\n        if (!validatorHash) return undefined;\n\n        const actualHash = uplcProgram.hash();\n        if (!equalsBytes(validatorHash, actualHash)) {\n            throw new Error(\n                `script hash mismatch: ${bytesToHex(\n                    validatorHash\n                )} != ${bytesToHex(actualHash)}`\n            );\n        }\n\n        return uplcProgram\n    }\n\n        /**\n     * resolves the compiled script for this class with its provided\n     * configuration details\n     * @remarks\n     * The configuration details & pre-compiled script may be injected by\n     * the HeliosRollupBundler or by compiling the script with provided\n     * params (in tests or during a first deployment of a Capo)\n     *\n     * When the asyncOk flag is not present, returns or fails synchronously.\n     * With the asyncOk flag, returns synchronously if the script is already\n     * compiled, or returns a Promise that resolves to the compiled script.\n     */\n    compiledScript(): anyUplcProgram;\n    compiledScript(asyncOk: true): anyUplcProgram | Promise<anyUplcProgram>;\n    compiledScript(asyncOk?: true): anyUplcProgram | Promise<anyUplcProgram> {\n        const {\n            configuredUplcParams: params,\n            setup,\n            previousOnchainScript,\n            program,\n        } = this;\n\n        if (this.alreadyCompiledScript) {\n            return this.alreadyCompiledScript;\n        }\n\n        if (this.isPrecompiled) {\n            const { singleton } = this.preCompiled!;\n            if (singleton && !this._selectedVariant) {\n                this.withVariant(\"singleton\");\n            }\n            const bundleForVariant = this.preCompiled?.[this._selectedVariant!];\n            if (!bundleForVariant) {\n                throw new Error(\n                    `${this.constructor.name}: variant ${this._selectedVariant} not found in preCompiled`\n                );\n            }\n            if (bundleForVariant) {\n                const p = (this.alreadyCompiledScript = programFromCacheEntry(\n                    bundleForVariant.programBundle\n                ));\n                return p;\n            }\n        } else {\n            if (!params || !setup) {\n                debugger; // eslint-disable-line no-debugger - keep for downstream troubleshooting\n                // theoretically only here for type-narrowing\n                throw new Error(\n                    `${this.constructor.name}: missing required params or setup for compiledScript() (debugging breakpoint available)`\n                );\n            }\n\n        }\n        console.warn(\n            `${this.constructor.name}: compiling helios script.  This could take 30s or more... `\n        );\n\n        // falls back to actually compiling the program.\n        // on server side, this comes with caching for performance.\n        // on the browser, there's not (currently) a cache.  It's intended\n        // that the preCompiled= settings\n        // will usually be available, so the cases where this is needed on the browser\n        // side should be rare (from .hlb's params() or variants())\n        // or only used in special cases of capo deployment (with its configuredScriptDetails)\n        const t = new Date().getTime();\n        const rawValues: Record<string, any> = {};\n        if (params) {\n            for (const [p, v] of Object.entries(params)) {\n                program.changeParam(p, v);\n                rawValues[p] = v.rawData;\n            }\n        }\n\n        const net = this.isMainnet ? \"mainnet\" : \"testnet\";\n        console.log(\n            `(${net}) ${this.moduleName} with params:\\n`,\n            Object.fromEntries(\n                Object.entries(program.entryPoint.paramsDetails()).map(\n                    ([k, uplcVal]) => {\n                        return [k, [uplcVal, rawValues[k]?.toString()].flat()];\n                    }\n                )\n            )\n        );\n\n        return program\n            .compileWithCache({\n                optimize: this.optimize,\n            })\n            .then((uplcProgram) => {\n                //     // optimize: {\n                //     //     keepTracing: true,\n                //     //     factorizeCommon: false,\n                //     //     inlineSimpleExprs: false,\n                //     //     flattenNestedFuncExprs: false,\n                //     //     removeUnusedArgs: false,\n                //     //     replaceUncalledArgsWithUnit: false,\n                //     //     inlineErrorFreeSingleUserCallExprs: false,\n                //     //     inlineSingleUseFuncExprs: false,\n                //     // },\n                //     withAlt: true,\n                // });\n                this.alreadyCompiledScript = uplcProgram;\n                const scriptHash = bytesToHex(uplcProgram.hash());\n                console.log(\n                    `compiled in ${new Date().getTime() - t}ms -> ${scriptHash}`\n                );\n                // if (globalThis.document) {\n                //     console.log({\n                //         uplcProgram,\n                //         cbor: bytesToHex(uplcProgram.toCbor()),\n                //     });\n                // }\n                return uplcProgram;\n            });\n    }\n\n    get preBundledScript() {\n        if (!this.isPrecompiled) return undefined;\n        const { singleton } = this.preCompiled!;\n        if (singleton && !this._selectedVariant) {\n            this.withVariant(\"singleton\");\n        }\n        const bundleForVariant = this.preCompiled?.[this._selectedVariant!];\n        if (!bundleForVariant) {\n            throw new Error(\n                `${this.constructor.name}: variant ${this._selectedVariant} not found in preCompiled`\n            );\n        }\n        return programFromCacheEntry(bundleForVariant.programBundle);\n    }\n\n    async getSerializedProgramBundle() {\n        const compiledScript = await this.compiledScript();\n        const cacheEntry = this.program.cacheEntry;\n        if (!cacheEntry) throw new Error(`missing cacheEntry`);\n        const serializedCacheEntry = serializeCacheEntry(cacheEntry);\n        const {\n            programElements,\n            version,\n            optimizeOptions,\n            optimized,\n            unoptimized,\n            optimizedIR,\n            unoptimizedIR,\n            optimizedSmap,\n            unoptimizedSmap,\n        } = serializedCacheEntry;\n        return {\n            scriptHash: bytesToHex(compiledScript.hash()),\n            programBundle: {\n                programElements,\n                version,\n                optimized,\n                unoptimized,\n                optimizedIR,\n                unoptimizedIR,\n                optimizedSmap,\n                unoptimizedSmap,\n            },\n        };\n    }\n\n    decodeAnyPlutusUplcProgram(\n        version: \"PlutusV2\" | \"PlutusV3\",\n        cborHex: string,\n        ir?: string,\n        sourceMap?: UplcSourceMapJsonSafe,\n        alt?: anyUplcProgram\n    ) {\n        if (version === \"PlutusV2\") {\n            if (alt && alt.plutusVersion != \"PlutusScriptV2\") {\n                throw new Error(\n                    `expected alt script to have matching Plutus V2, not ${alt.plutusVersion}`\n                );\n            }\n            return decodeUplcProgramV2FromCbor(cborHex, {\n                ir: ir,\n                sourceMap: sourceMap,\n                alt: alt as UplcProgramV2,\n            });\n        } else if (version === \"PlutusV3\") {\n            throw new Error(`Plutus V3 not yet supported`);\n            // if (alt && alt.plutusVersion != \"PlutusScriptV3\") {\n            //     throw new Error(`expected alt script to have matching Plutus V3, not ${alt.plutusVersion}`);\n            // }\n            // return decodeUplcProgramV3FromCbor(cborHex, {\n            //     ir: ir,\n            //     sourceMap: sourceMap,\n            //     alt: alt as UplcProgramV3\n            // });\n        } else {\n            throw new Error(`unexpected Plutus version ${version}`);\n        }\n    }\n\n    /**\n     * provides a temporary indicator of mainnet-ness, while not\n     * requiring the question to be permanently resolved.\n     */\n    isDefinitelyMainnet() {\n        return this.isMainnet ?? false;\n    }\n\n    // _pct: number = 0\n    get program(): HeliosProgramWithCacheAPI {\n        if (this._program) {\n            // bust through pre-cached version if the\n            // fundmental settings are changed\n            if (\n                this.isPrecompiled != this._progIsPrecompiled ||\n                this.setup?.isMainnet !== this.isMainnet\n            ) {\n                console.warn(\"busting program cache\");\n                this._program = undefined;\n            } else {\n                return this._program;\n            }\n        }\n        const isMainnet = this.setup?.isMainnet ?? false;\n        const isTestnet = !isMainnet;\n\n        const ts1 = Date.now();\n        let mName = this.moduleName;\n        if (mName === defaultNoDefinedModuleName) {\n            mName = \"\";\n        }\n        const moduleSources = this.getEffectiveModuleList();\n\n        if (!isTestnet) {\n            debugger;\n        }\n        try {\n            const p = new HeliosProgramWithCacheAPI(this.main, {\n                isTestnet,\n                moduleSources,\n                name: mName, // it will fall back to the program name if this is empty\n            });\n            this._program = p;\n            this._progIsPrecompiled = this.isPrecompiled;\n\n            // Hi!  Are you investigating a duplicate load of the same module?\n            //  üî•üî•üî•  thanks! you're saving people 100ms at a time!\n            console.log(\n                `üì¶ ${mName}: loaded & parsed ${\n                    this.isPrecompiled ? \"with\" : \"without\"\n                } pre-compiled program: ${Date.now() - ts1}ms`\n                // new Error(`stack`).stack\n            );\n            return p;\n        } catch (e: any) {\n            // !!! probably this stuff needs to move to compileWithScriptParams()\n            if (e.message.match(/invalid parameter name/)) {\n                debugger;\n                throw new Error(\n                    e.message +\n                        `\\n   ... this typically occurs when your StellarContract class (${this.constructor.name})` +\n                        \"\\n   ... can be missing a getContractScriptParams() method \" +\n                        \"\\n   ... to map from the configured settings to contract parameters\"\n                );\n            }\n            const [unsetConst, constName] =\n                e.message.match(/used unset const '(.*?)'/) || [];\n            if (unsetConst) {\n                console.log(e.message);\n                throw new Error(\n                    `${this.constructor.name}: missing required script param '${constName}' in static getDefaultParams() or getContractScriptParams()`\n                );\n            }\n            if (!e.site) {\n                console.error(\n                    `unexpected error while compiling helios program (or its imported module) \\n` +\n                        `> ${e.message}\\n` +\n                        `(debugging breakpoint available)\\n` +\n                        `This likely indicates a problem in Helios' error reporting - \\n` +\n                        `   ... please provide a minimal reproducer as an issue report for repair!\\n\\n` +\n                        e.stack.split(\"\\n\").slice(1).join(\"\\n\")\n                );\n                try {\n                    debugger;\n                    // debugger'ing?  YOU ARE AWESOME!\n                    //  reminder: ensure \"pause on caught exceptions\" is enabled\n                    //  before playing this next line to dig deeper into the error.\n\n                    const try2 = new HeliosProgramWithCacheAPI(this.main, {\n                        isTestnet,\n                        moduleSources,\n                        name: mName, // it will fall back to the program name if this is empty\n                    });\n\n                    // const script2 = new Program(codeModule, {\n                    //     moduleSources: modules,\n                    //     isTestnet: this.setup.isTest,\n                    // });\n                    // console.log({ params });\n                    // if (params) {\n                    //     for (const [p, v] of Object.entries(params || {})) {\n                    //         script2.changeParam(p, v);\n                    //     }\n                    //     script2.compile();\n                    // }\n                    console.warn(\"NOTE: no error thrown on second attempt\");\n                } catch (sameError) {\n                    // entirely expected it would throw the same error\n                    // throw sameError;\n                }\n                // throw e;\n            }\n            debugger;\n            const [_, notFoundModule] =\n                e.message.match(/module '(.*)' not found/) || [];\n            if (notFoundModule) {\n                this.logModuleDetails();\n                console.log(\n                    `${this.constructor.name} module '${notFoundModule}' not found; see module details above`\n                );\n            }\n            if (!e.site) {\n                console.warn(\n                    \"error thrown from helios doesn't have source site info; rethrowing it\"\n                );\n                throw e;\n            }\n            const moduleName2 = e.site.file; // moduleName? & filename ? :pray:\n            const errorModule = [this.main, ...moduleSources].find(\n                (m) => m.name == moduleName2\n            );\n\n            // const errorModule = [codeModule, ...modules].find(\n            //     (m) => (m as any).name == moduleName\n            // );\n\n            const {\n                project,\n                moduleName,\n                name: srcFilename = \"‚Äπunknown path to module‚Ä∫\",\n                moreInfo,\n            } = errorModule || {};\n            let errorInfo: string = \"\";\n\n            if (!HeliosProgramWithCacheAPI.checkFile(srcFilename)) {\n                const indent = \" \".repeat(6);\n                errorInfo = project\n                    ? `\\n${indent}Error found in project ${project}:${srcFilename}\\n` +\n                      `${indent}- in module ${moduleName}:\\n${moreInfo}\\n` +\n                      `${indent}  ... this can be caused by not providing correct types in a module specialization,\\n` +\n                      `${indent}  ... or if your module definition doesn't include a correct path to your helios file\\n`\n                    : `\\n${indent}WARNING: the error was found in a Helios file that couldn't be resolved in your project\\n` +\n                      `${indent}  ... this can be caused if your module definition doesn't include a correct path to your helios file\\n` +\n                      `${indent}  ... (possibly in mkHeliosModule(heliosCode, \\n${indent}    \"${srcFilename}\"\\n${indent})\\n`;\n            }\n\n            const { startLine, startColumn } = e.site;\n            const t = new Error(errorInfo);\n            const modifiedStack = t.stack!.split(\"\\n\").slice(1).join(\"\\n\");\n            debugger;\n            const additionalErrors = (e.otherErrors || []).slice(1).map(\n                (oe) =>\n                    `       |         ‚ö†Ô∏è  also: ${\n                        // (oe.message as string).replace(e.site.file, \"\")}`);\n                        oe.site.file == e.site.file\n                            ? oe.site\n                                  .toString()\n                                  .replace(e.site.file + \":\", \"at \") +\n                              \": \" +\n                              oe.originalMessage\n                            : oe.site.toString() + \" - \" + oe.originalMessage\n                    }`\n            );\n            const addlErrorText = additionalErrors.length\n                ? [\"\", ...additionalErrors, \"       v\"].join(\"\\n\")\n                : \"\";\n            t.message = `${e.kind}: ${\n                this.constructor.name\n            }\\n${e.site.toString()} - ${\n                e.originalMessage\n            }${addlErrorText}\\n${errorInfo}`;\n\n            t.stack =\n                `${this.constructor.name}: ${\n                    e.message\n                }\\n    at ${moduleName2} (${srcFilename}:${1 + startLine}:${\n                    1 + startColumn\n                })\\n` + modifiedStack;\n\n            throw t;\n        }\n    }\n\n    isHeliosScriptBundle() {\n        return true;\n    }\n\n    addTypeProxies() {\n        // const typeGenerator = new BundleTypeGenerator(this);\n        // const { activityTypeDetails, datumTypeDetails } = typeGenerator;\n        // this.Activity = new ActivityMaker(this);\n        // if (datumTypeDetails) {\n        //     this.readDatum = new DataReader(datumTypeDetails);\n        // }\n    }\n\n    effectiveDatumTypeName() {\n        return (\n            this.datumTypeName ||\n            this.locateDatumType()?.name ||\n            \"‚Äπunknown datum-type name‚Ä∫\"\n        );\n    }\n\n    /**\n     * @internal\n     */\n    locateDatumType(): DataType | undefined {\n        let datumType: DataType | undefined;\n        // let datumTypeName: string | undefined;\n\n        const program = this.program;\n        const programName = program.name;\n        const argTypes = program.entryPoint.mainArgTypes;\n        const argCount = argTypes.length;\n        if (argCount === 2) {\n            datumType = argTypes[0];\n            // datumTypeName = argTypes[0].name;\n        }\n\n        if (this.datumTypeName) {\n            datumType =\n                program.entryPoint.userTypes[programName][this.datumTypeName];\n            if (!datumType) {\n                throw new Error(\n                    `${this.constructor.name}.datumTypeName=\\`${this.datumTypeName}\\` not found in userTypes of script program ${programName}`\n                );\n            }\n        }\n\n        return datumType;\n    }\n\n    /**\n     * @internal\n     */\n    locateRedeemerType(): DataType {\n        const program = this.program;\n        const argTypes = program.entryPoint.mainArgTypes;\n        const argCount = argTypes.length;\n\n        let redeemerType: DataType;\n        if (argCount === 2) {\n            redeemerType = argTypes[1];\n        } else {\n            redeemerType = argTypes[0];\n        }\n\n        if (this.redeemerTypeName) {\n            const programName = program.name;\n            redeemerType =\n                program.entryPoint.userTypes[programName][\n                    this.redeemerTypeName\n                ];\n            if (!redeemerType) {\n                throw new Error(\n                    `${this.constructor.name}.redeemerTypeName=\\`${this.redeemerTypeName}\\` not found in userTypes of script program ${programName}`\n                );\n            }\n        }\n\n        return redeemerType;\n    }\n\n    get includeEnums() : string[] {\n        return []\n    }\n\n    /**\n     * @internal\n     */\n    getTopLevelTypes(): HeliosBundleTypes {\n        const types = {\n            datum: this.locateDatumType(),\n            redeemer: this.locateRedeemerType(),\n        };\n\n        const program = this.program;\n        const { userTypes } = program;\n        const { mainModule } = program.entryPoint;\n        const mainTypes = userTypes[mainModule.name.value];\n        for (const [typeName, type] of Object.entries(mainTypes)) {\n            const s = type.toSchema();\n            if (s.kind == \"struct\") {\n                types[typeName] = type;\n            }\n            if (s.kind == \"enum\" && this.includeEnums.includes(typeName)) {\n                types[typeName] = type;\n            }\n        }\n\n        if (userTypes.specializedDelegate) {\n            const specializationName = this.moduleName;\n            const specializationTypes = userTypes[specializationName];\n            if (!specializationTypes) {\n                console.log(\n                    \"NOTE: the module name for the delegate policy script must match bundle's moduleName\"\n                );\n                debugger; // eslint-disable-line no-debugger - keep for downstream troubleshooting\n                throw new Error(\n                    `specialization types not found for ${this.moduleName} in program ${program.name} (debugging breakpoint available)`\n                );\n            }\n            for (const [typeName, type] of Object.entries(\n                specializationTypes\n            )) {\n                const s = type.toSchema();\n                if (s.kind == \"struct\") {\n                    types[typeName] = type;\n                }\n                if (s.kind == \"enum\" && this.includeEnums.includes(typeName)) {\n                    types[typeName] = type;\n                }\n            }\n        }\n\n        return types;\n    }\n\n    /**\n     * @internal\n     */\n    paramsToUplc<ConfigType extends configBaseWithRev>(\n        params: Record<string, any>\n    ): UplcRecord<ConfigType> {\n        const namespace = this.program.name;\n        const { paramTypes } = this.program;\n\n        return Object.fromEntries(\n            Object.entries(params)\n                .map(([paramName, data]) => {\n                    const fullName = `${namespace}::${paramName}`;\n                    // console.log(\"  -- param\", fullName);\n                    const thatType = paramTypes[fullName];\n                    if (!thatType) {\n                        // group the params by namespace to produce a list of:\n                        //   \"namespace::{ ... paramNames ... }\"\n                        //   \"namespace2::{ ... paramNames ... }\"\n                        const availableParams = Object.entries(\n                            paramTypes\n                        ).reduce((acc, [k, v]) => {\n                            const [ns, name] = k.split(\"::\");\n                            if (!acc[ns]) acc[ns] = [];\n                            acc[ns].push(name);\n                            return acc;\n                        }, {} as Record<string, string[]>);\n                        // if (Array.isArray(data)) {\n                        //     // probably it's wrong to categorically reject arrays,\n                        //     // but if you have this problem, please let us know and we'll help you resolve it.\n                        //     throw new Error(\n                        //         `invalid script-parameter '${paramName}' in namespace '${namespace}' \\n` +\n                        //             `  ... expected single value, got array`\n                        //     );\n                        // }\n\n                        // throw an error showing all the namespaces and all the short params in each\n                        const availableScriptParams = Object.entries(\n                            availableParams\n                        )\n                            .map(\n                                ([ns, names]) =>\n                                    `  ${ns}::{${names.join(\", \")}}`\n                            )\n                            .join(\"\\n\");\n                        // console.log(\"availableScriptParams\", availableScriptParams);\n                        if (paramName == \"0\") {\n                            throw new Error(\n                                `numeric param name is probably wrong`\n                            );\n                        }\n                        if ((paramName = \"addrHint\")) {\n                            // silently ignore this one\n                            return undefined;\n                        }\n                        throw new Error(\n                            `invalid script-parameter '${paramName}' in namespace '${namespace}' \\n` +\n                                `  ... expected one of: ${availableScriptParams}`\n                        );\n                    }\n                    return [\n                        fullName,\n                        this.typeToUplc(thatType, data, `params[${fullName}]`),\n                    ];\n                })\n                .filter((x) => !!x)\n        ) as UplcRecord<ConfigType>;\n    }\n\n    /**\n     * @internal\n     */\n    typeToUplc(type: DataType, data: any, path: string = \"\"): UplcData {\n        const schema = type.toSchema();\n        if (!this.setup) {\n            debugger;\n        }\n        const isMainnet = this.setup!.isMainnet;\n        if (\"undefined\" == typeof isMainnet) {\n            throw new Error(\n                `${this.constructor.name}: isMainnet must be defined in the setup`\n            );\n        }\n        const cast = makeCast(schema, {\n            isMainnet,\n            unwrapSingleFieldEnumVariants: true,\n        });\n        return cast.toUplcData(data, path);\n    }\n}\n"],"names":["textToBytes","delegateName","params"],"mappings":"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"}