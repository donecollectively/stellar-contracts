{"version":3,"file":"ContractBasedDelegate2.mjs","sources":["../src/delegation/UutName.ts","../src/colors.ts","../src/utils.ts","../src/delegation/jsonSerializers.ts","../src/diagnostics.ts","../src/UplcConsoleLogger.ts","../src/StellarTxnContext.ts","../src/UtxoHelper.ts","../src/ActivityTypes.ts","../src/helios/dataBridge/DataBridge.ts","../src/StellarContract.ts","../src/Requirements.ts","../src/delegation/StellarDelegate.ts","../src/delegation/ContractBasedDelegate.ts"],"sourcesContent":["import { bytesToText } from \"../HeliosPromotedTypes.js\";\n\nexport const maxUutName = 32;\n\n/**\n * a unique utility token having a unique name\n * @remarks\n *\n * This class contains a general 'purpose' name, mapped to a unique\n * `name`, which is generated using a seed-utxo pattern.\n *\n * @public\n **/\nexport class UutName {\n    _uutName: string;\n    purpose: string;\n    constructor(purpose: string, fullUutName: string | number[]) {\n        this.purpose = purpose;\n        if (Array.isArray(fullUutName)) {\n            fullUutName = bytesToText(fullUutName);\n        }\n        if (fullUutName.length > maxUutName) {\n            throw new Error(\n                `uut name '${fullUutName}' exceeds max length of ${maxUutName}`\n            );\n        }\n        this._uutName = fullUutName;\n    }\n    /**\n     * the full uniquified name of this UUT\n     * @remarks\n     *\n     * format: `purpose-‹...uniqifier...›`\n     * @public\n     **/\n    get name() {\n        return this._uutName;\n    }\n    toString() {\n        return this._uutName;\n    }\n}\n","// local copy of picocolors.js\n// guards against supply chain attacks\n// original ISC license preserved:\n\n// ISC License\n\n// Copyright (c) 2021-2024 Oleksii Raspopov, Kostiantyn Denysov, Anton Verinov\n\n// Permission to use, copy, modify, and/or distribute this software for any\n// purpose with or without fee is hereby granted, provided that the above\n// copyright notice and this permission notice appear in all copies.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\n// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\n// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\n// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\n// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\n// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\n// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n\n\n\nlet p = process || {}, argv = p.argv || [], env = p.env || {}\nlet isColorSupported =\n\t!(!!env.NO_COLOR || argv.includes(\"--no-color\")) &&\n\t(!!env.FORCE_COLOR || argv.includes(\"--color\") || \n        p.platform === \"win32\" || \n        (\n            true \n        //  && (p.stdout || {}).isTTY \n        // && env.TERM !== \"dumb\"\n        ) || \n        !!env.CI\n        )\n\nlet formatter = (open, close, replace = open) => {\n    const f = (input) => {\n\t\tlet string = \"\" + input, index = string.indexOf(close, open.length)\n\t\treturn ~index ? open + replaceClose(string, close, replace, index) + close : open + string + close\n\t}\n    f.start = open\n    f.close = close\n    return f\n}\n\nlet replaceClose = (string, close, replace, index) => {\n\tlet result = \"\", cursor = 0\n\tdo {\n\t\tresult += string.substring(cursor, index) + replace\n\t\tcursor = index + close.length\n\t\tindex = string.indexOf(close, cursor)\n\t} while (~index)\n\treturn result + string.substring(cursor)\n}\n\nlet createColors = (enabled = isColorSupported) => {\n\tlet f = enabled ? formatter : () => String\n\treturn {\n\t\tisColorSupported: enabled,\n\t\treset: f(\"\\x1b[0m\", \"\\x1b[0m\"),\n\t\tbold: f(\"\\x1b[1m\", \"\\x1b[22m\", \"\\x1b[22m\\x1b[1m\"),\n\t\tdim: f(\"\\x1b[2m\", \"\\x1b[22m\", \"\\x1b[22m\\x1b[2m\"),\n\t\titalic: f(\"\\x1b[3m\", \"\\x1b[23m\"),\n\t\tunderline: f(\"\\x1b[4m\", \"\\x1b[24m\"),\n\t\tinverse: f(\"\\x1b[7m\", \"\\x1b[27m\"),\n\t\thidden: f(\"\\x1b[8m\", \"\\x1b[28m\"),\n\t\tstrikethrough: f(\"\\x1b[9m\", \"\\x1b[29m\"),\n\n\t\tblack: f(\"\\x1b[30m\", \"\\x1b[39m\"),\n\t\tred: f(\"\\x1b[31m\", \"\\x1b[39m\"),\n\t\tgreen: f(\"\\x1b[32m\", \"\\x1b[39m\"),\n\t\tyellow: f(\"\\x1b[33m\", \"\\x1b[39m\"),\n\t\tblue: f(\"\\x1b[34m\", \"\\x1b[39m\"),\n\t\tmagenta: f(\"\\x1b[35m\", \"\\x1b[39m\"),\n\t\tcyan: f(\"\\x1b[36m\", \"\\x1b[39m\"),\n\t\twhite: f(\"\\x1b[37m\", \"\\x1b[39m\"),\n\t\tgray: f(\"\\x1b[90m\", \"\\x1b[39m\"),\n\n\t\tbgBlack: f(\"\\x1b[40m\", \"\\x1b[49m\"),\n\t\tbgRed: f(\"\\x1b[41m\", \"\\x1b[49m\"),\n\t\tbgGreen: f(\"\\x1b[42m\", \"\\x1b[49m\"),\n\t\tbgYellow: f(\"\\x1b[43m\", \"\\x1b[49m\"),\n\t\tbgBlue: f(\"\\x1b[44m\", \"\\x1b[49m\"),\n\t\tbgMagenta: f(\"\\x1b[45m\", \"\\x1b[49m\"),\n\t\tbgCyan: f(\"\\x1b[46m\", \"\\x1b[49m\"),\n\t\tbgWhite: f(\"\\x1b[47m\", \"\\x1b[49m\"),\n\n\t\tblackBright: f(\"\\x1b[90m\", \"\\x1b[39m\"),\n\t\tredBright: f(\"\\x1b[91m\", \"\\x1b[39m\"),\n\t\tgreenBright: f(\"\\x1b[92m\", \"\\x1b[39m\"),\n\t\tyellowBright: f(\"\\x1b[93m\", \"\\x1b[39m\"),\n\t\tblueBright: f(\"\\x1b[94m\", \"\\x1b[39m\"),\n\t\tmagentaBright: f(\"\\x1b[95m\", \"\\x1b[39m\"),\n\t\tcyanBright: f(\"\\x1b[96m\", \"\\x1b[39m\"),\n\t\twhiteBright: f(\"\\x1b[97m\", \"\\x1b[39m\"),\n\n\t\tbgBlackBright: f(\"\\x1b[100m\", \"\\x1b[49m\"),\n\t\tbgRedBright: f(\"\\x1b[101m\", \"\\x1b[49m\"),\n\t\tbgGreenBright: f(\"\\x1b[102m\", \"\\x1b[49m\"),\n\t\tbgYellowBright: f(\"\\x1b[103m\", \"\\x1b[49m\"),\n\t\tbgBlueBright: f(\"\\x1b[104m\", \"\\x1b[49m\"),\n\t\tbgMagentaBright: f(\"\\x1b[105m\", \"\\x1b[49m\"),\n\t\tbgCyanBright: f(\"\\x1b[106m\", \"\\x1b[49m\"),\n\t\tbgWhiteBright: f(\"\\x1b[107m\", \"\\x1b[49m\"),\n\t} as any\n}\n\n/**\n * @public\n */\nexport const colors : Colors = createColors()\n\n\n/**\n * @public\n */\nexport type Formatter = {\n    start: string;\n    end: string;\n} & ((input: string | number | null | undefined) => string);\n\n/**\n * @public\n */\nexport interface Colors {\n    isColorSupported: boolean;\n\n    reset: Formatter;\n    bold: Formatter;\n    dim: Formatter;\n    italic: Formatter;\n    underline: Formatter;\n    inverse: Formatter;\n    hidden: Formatter;\n    strikethrough: Formatter;\n\n    black: Formatter;\n    red: Formatter;\n    green: Formatter;\n    yellow: Formatter;\n    blue: Formatter;\n    magenta: Formatter;\n    cyan: Formatter;\n    white: Formatter;\n    gray: Formatter;\n\n    bgBlack: Formatter;\n    bgRed: Formatter;\n    bgGreen: Formatter;\n    bgYellow: Formatter;\n    bgBlue: Formatter;\n    bgMagenta: Formatter;\n    bgCyan: Formatter;\n    bgWhite: Formatter;\n\n    blackBright: Formatter;\n    redBright: Formatter;\n    greenBright: Formatter;\n    yellowBright: Formatter;\n    blueBright: Formatter;\n    magentaBright: Formatter;\n    cyanBright: Formatter;\n    whiteBright: Formatter;\n\n    bgBlackBright: Formatter;\n    bgRedBright: Formatter;\n    bgGreenBright: Formatter;\n    bgYellowBright: Formatter;\n    bgBlueBright: Formatter;\n    bgMagentaBright: Formatter;\n    bgCyanBright: Formatter;\n    bgWhiteBright: Formatter;\n}\n\n","import { isValidUtf8 } from \"@helios-lang/codec-utils\";\nimport type { uutPurposeMap } from \"./CapoTypes.js\";\nimport { textToBytes, type valuesEntry } from \"./HeliosPromotedTypes.js\";\nimport { UutName } from \"./delegation/UutName.js\";\nimport {\n    makeAssets,\n    makeValue,\n    type Value,\n    type MintingPolicyHash,\n} from \"@helios-lang/ledger\";\n\n/**\n * Creates Value-creation entires for a list of uuts\n * @remarks\n *\n * returns a list of `entries` usable in Value's `[mph, entries[]]` tuple.\n * @param uuts - a list of {@link UutName}s or a {@link uutPurposeMap}\n * @public\n **/\nexport function mkUutValuesEntries(uuts: UutName[]): valuesEntry[];\n/** @public **/\nexport function mkUutValuesEntries(uuts: uutPurposeMap<any>): valuesEntry[];\n/** @public **/\nexport function mkUutValuesEntries(\n    uuts: UutName[] | uutPurposeMap<any>\n): valuesEntry[];\n/** @public **/\nexport function mkUutValuesEntries(\n    uuts: UutName[] | uutPurposeMap<any>\n): valuesEntry[] {\n    const uutNs = Array.isArray(uuts) ? uuts : Object.values(uuts);\n    const uniqs: UutName[] = [];\n    for (const un of uutNs) {\n        if (!uniqs.includes(un)) uniqs.push(un);\n    }\n    return uniqs.map((uut) => mkValuesEntry(uut.name, BigInt(1)));\n}\n\n/**\n * Creates a tuple usable in a Value, converting token-name to byte-array if needed\n * @public\n **/\nexport function mkValuesEntry(\n    tokenName: string | number[],\n    count: bigint\n): valuesEntry {\n    const tnBytes = Array.isArray(tokenName)\n        ? tokenName\n        : textToBytes(tokenName);\n\n    // addrHint,  //moved to config\n    // reqdAddress,  // removed\n\n    return [tnBytes, count];\n}\n\n/**\n * construct a Value based on a token-name\n * @remarks\n *\n * A simpler version of the Value constructor to serve the\n * common case of a single, string-based token name.\n *\n * If you need the Value to contain its minUtx computed based\n * on network parameters, use the StellarContract's mkMinTv()\n * method instead.\n *\n * @param mph - policy-hash of the token\n * @param tokenName - string name of the token\n * @param count: number of the tokens to include in the value\n * @public\n **/\nexport function mkTv(\n    mph: MintingPolicyHash,\n    tokenName: string | number[],\n    count: bigint = 1n\n): Value {\n    const v = makeValue(\n        0,\n        makeAssets([[mph, [mkValuesEntry(tokenName, count)]]])\n    );\n    return v;\n}\n\n/**\n * Multiplies two numbers using integer math semantics for matching with Helios on-chain Real math\n *\n * @remarks\n * The numbers can be whole or fractional, with 6 decimal places of honored precision.\n * The result is rounded to 6 decimal places.\n * @todo - delegate this to a call into the on-chain version of same\n * @public\n */\nexport function realMul(a: number, b: number) {\n    const a2 = Math.trunc(1000000 * a);\n    const b2 = Math.trunc(1000000 * b);\n    const result1 = a2 * b2;\n    const result2 = result1 / 1_000_000_000_000;\n    if (debugRealMath) {\n        console.log(\"    ---- realMul\", a2, b2);\n        console.log(\"    ---- realMul result1\", result1);\n        console.log(\"    ---- realMul result2\", result2);\n    }\n    return result2;\n}\n\n/**\n * Divides two numbers using integer math semantics for matching with Helios on-chain Real math\n *\n * @remarks\n * The numbers can be whole or fractional, with 6 decimal places of honored precision.\n * The result is rounded to 6 decimal places.\n * @todo - delegate this to a call into the on-chain version of same\n * @public\n */\nexport function realDiv(a: number, b: number) {\n    if (b === 0) {\n        throw new Error(\"Cannot divide by zero\");\n    }\n    const a2 = Math.trunc(1_000_000 * a);\n    const b2 = Math.trunc(1_000_000 * b);\n    const result1 = a2 / b;\n    // const result2 = toFixedReal(result1 / 1_000_000);\n    const result2 = Math.round(result1) / 1_000_000;\n    if (debugRealMath) {\n        console.log(\"    ---- realDiv\", a, \"/\", b);\n        console.log(\"    ---- realDiv\", a2);\n        console.log(\"    ---- realDiv result1\", result1);\n        console.log(\"    ---- realDiv result2\", result2);\n    }\n    return result2;\n}\n\n/**\n * Rounds a number to 6 decimal places, with correction for low-value floating-point\n * errors e.g. `(2.999999999) -> 3.0`\n * @public\n */\nexport function toFixedReal(n: number) {\n    return parseFloat((Math.floor(n * 1_000_000 + 0.1) / 1_000_000).toFixed(6));\n}\n/**\n * Temporarily enable debugRealMath for the duration of the callback\n * @internal\n */\nexport function debugMath<T extends number>(callback: () => T): T {\n    const old = debugRealMath;\n    debugRealMath = true;\n    const result = callback();\n    debugRealMath = old;\n    return result;\n}\n\nlet debugRealMath = false;\n\n\n\n/**\n * @public\n */\nexport class TxNotNeededError extends Error {\n    constructor(message: string) {\n        super(message);\n        this.name = \"TxAlreadyPresentError\";\n    }\n}\n\n/**\n * @public\n */\nexport class AlreadyPendingError extends TxNotNeededError {\n    constructor(message: string) {\n        super(message);\n        this.name = \"AlreadyPendingError\";\n    }\n}\n\n/**\n * @public\n */\nexport function checkValidUTF8(data: number[]) {\n  // quickly check, without throwing errors, for invalid UTF-8 sequences:\n  let i = 0;\n  while (i < data.length) {\n    if ((data[i] & 0x80) === 0x00) {\n      i++;\n    } else if ((data[i] & 0xE0) === 0xC0) {\n      if (i + 1 >= data.length || (data[i + 1] & 0xC0) !== 0x80) return false;\n      i += 2;\n    } else if ((data[i] & 0xF0) === 0xE0) {\n      if (i + 2 >= data.length || (data[i + 1] & 0xC0) !== 0x80 || (data[i + 2] & 0xC0) !== 0x80) return false;\n      i += 3\n    } else if ((data[i] & 0xF8) === 0xF0) {\n      if (i + 3 >= data.length || (data[i + 1] & 0xC0) !== 0x80 || (data[i + 2] & 0xC0) !== 0x80 || (data[i + 3] & 0xC0) !== 0x80) return false;\n      i += 4;\n    } else {\n      return false;\n    }\n  }\n  // if it didn't fail above, fine - but still defer to isValidUtf8.  it CAN throw (and catch) an error,\n  // but the above checks are much likelier to return false with NO caught error.\n  return isValidUtf8(data);\n}\n\nexport {colors} from \"./colors.js\"","import { bytesToHex } from \"@helios-lang/codec-utils\";\nimport { encodeBech32 } from \"@helios-lang/crypto\";\nimport { type Address, type AssetClass } from \"@helios-lang/ledger\";\nimport { type MintingPolicyHash } from \"@helios-lang/ledger\";\nimport { bytesToText } from \"../HeliosPromotedTypes.js\";\nimport {\n    txOutputIdAsString,\n    valueAsString,\n    assetsAsString,\n    policyIdAsString,\n    displayTokenName,\n} from \"../diagnostics.js\";\nimport type { ByteArrayData, IntData } from \"@helios-lang/uplc\";\nimport { checkValidUTF8 } from \"../utils.js\";\n\n/**\n * toJSON adapter for delegate links\n * @remarks\n * used for on-chain serialization of contract config details\n * @internal\n **/\nexport function delegateLinkSerializer(key: string, value: any) {\n    if (typeof value === \"bigint\") {\n        return value.toString();\n    } else if (\"bytes\" == key && Array.isArray(value)) {\n        return bytesToHex(value);\n    } else if (value?.kind == \"Address\") {\n        return value.toString();\n    } else if (\"tn\" == key && Array.isArray(value)) {\n        return bytesToText(value);\n    }\n    if (\"capo\" == key) return undefined;\n    if (\"uh\" == key) return '\"‹utxo helper›\"';\n    if (\"capoBundle\" == key) return '\"‹capo bundle›\"';\n\n    return value; // return everything else unchanged\n}\n\n/**\n *  this is NOT a jsonifier, but it emits nice-looking info onscreen when used with JSON.stringify (in arg2)\n * @public\n */\nexport function uplcDataSerializer(key: string, value: any, depth = 0) {\n    const indent = \"    \".repeat(depth);\n    const outdent = \"    \".repeat(Math.max(0, depth - 1));\n\n    if (typeof value === \"bigint\") {\n        return `big‹${value.toString()}n›`;\n    } else if (\"bytes\" == key && Array.isArray(value)) {\n        // return `‹bytes‹${value.length}›=${bytesToHex(value)}›`;\n        return abbreviatedDetailBytes(`bytes‹${value.length}›`, value, 40);\n    } else if (\"string\" == typeof value) {\n        return `'${value}'`; // JSON.stringify(value, null, 4);\n    } else if (value === null) {\n        return `‹null›`;\n    } else if (\"undefined\" == typeof value) {\n        return `‹und›`;\n    } else if (value.kind == \"Address\") {\n        const a = value as Address;\n        const cbor = a.toCbor();\n        // const b = decodeAddress(cbor)\n        return (\n            `‹${abbrevAddress(value)}› = ` +\n            abbreviatedDetailBytes(`cbor‹${cbor.length}›:`, cbor, 99)\n        );\n    } else if (value.kind == \"ValidatorHash\") {\n        return abbreviatedDetailBytes(\n            `script‹${value.bytes.length}›`,\n            value.bytes\n        );\n    } else if (value.kind == \"MintingPolicyHash\") {\n        const v: MintingPolicyHash = value;\n        return `mph‹${policyIdAsString(v)}›`;\n        // .toHex())}›`;\n    } else if (value.kind == \"TxOutputId\") {\n        return `‹txoid:${txOutputIdAsString(value, 8)}›`;\n    }\n    if (value.rawData) {\n        return uplcDataSerializer(key, value.rawData, Math.max(depth, 3));\n    }\n    if (value.kind == \"int\") {\n        const v: IntData = value;\n        return `IntData‹${v.value}›`;\n    }\n    if (value.kind == \"bytes\") {\n        const v = value as ByteArrayData;\n        return abbreviatedDetailBytes(\n            `ByteArray‹${v.bytes.length}›`,\n            v.bytes,\n            40\n        );\n    }\n    if (value.kind == \"Value\") {\n        return valueAsString(value);\n    }\n    if (value.kind == \"Assets\") {\n        return `assets:‹${assetsAsString(value)}›`;\n    }\n    if (value.kind == \"AssetClass\") {\n        const ac = value as AssetClass;\n        return `assetClass:‹${policyIdAsString(ac.mph)} ${displayTokenName(\n            ac.tokenName\n        )}}›`;\n    }\n    if (value.kind)\n        console.log(\"info: no special handling for KIND = \", value.kind);\n\n    if (\"tn\" == key && Array.isArray(value)) {\n        return bytesToText(value);\n    } else if (\"number\" == typeof value) {\n        return value.toString();\n    } else if (value instanceof Map) {\n        return `map‹${value.size}›: { ${uplcDataSerializer(\n            \"\",\n            Object.fromEntries(value.entries()),\n            Math.max(depth, 3)\n        )}    }`;\n    } else if (Array.isArray(value) && value.length == 0) {\n        return \"[]\";\n    } else if (\n        Array.isArray(value) &&\n        value.every((v) => typeof v === \"number\")\n    ) {\n        return `${abbreviatedDetailBytes(`bytes‹${value.length}›`, value, 40)}`;\n        // } else if (value.toString) {\n        //     return value.toString();\n    } else if (Array.isArray(value)) {\n        const inner = value.map((v) =>\n            uplcDataSerializer(\"\", v, Math.max(depth + 1, 3))\n        );\n        let extraNewLine = \"\";\n        let usesOutdent = \"\";\n        const multiLine = inner\n            .map((s) => {\n                const hasNewline = s.trim().includes(\"\\n\");\n                if (s.length > 40) {\n                    extraNewLine = \"\\n\";\n                    usesOutdent = outdent;\n                    return `${indent}${s}`;\n                } else {\n                    // console.log(\"length, hasNewline = \", s.length, hasNewline)\n                }\n                return s;\n            })\n            .join(`, ${extraNewLine}`);\n        // console.log(\"array uses newline/outdent\", {extraNewLine, usesOutdent});\n\n        return `[ ${extraNewLine}${multiLine}${extraNewLine}${usesOutdent} ]`;\n    }\n\n    if (!value) {\n        return JSON.stringify(value);\n    }\n    const keys = Object.keys(value);\n    if (keys.length == 0) {\n        return key ? \"\" : \"{}\";\n    }\n    if (keys.length == 1) {\n        const singleKey = keys[0];\n        const thisValue = value[singleKey];\n        let inner = uplcDataSerializer(\"\", thisValue, Math.max(depth, 3)) || \"\";\n        if (Array.isArray(thisValue)) {\n            if (!inner.length) {\n                inner = \"[ ‹empty list› ]\";\n            }\n        } else {\n            if (inner.length) inner = `{ ${inner} }`;\n        }\n        let s = `${singleKey}: ${inner}`;\n        // if (key) return `**1k** ${key}: ${s}`\n        return s;\n    }\n    let extraNewLine = \"\";\n    let usesOutdent = \"\";\n    let s = keys.map(\n        (k) =>\n            `${indent}${k}: ${\n                uplcDataSerializer(k, value[k], Math.max(depth + 1, 2))\n                //    JSON.stringify(value[k], datumSerializer, 4)\n                // }`).join(`,\\nz${indent}`);\n            }`\n    );\n    const multiLineItems = s.map((s) => {\n        if (s.length < 40 && !s.includes(\"\\n\")) {\n            return `${s}`;\n        } else {\n            extraNewLine = \"\\n\";\n            usesOutdent = outdent;\n            return `${s}`;\n        }\n        return s;\n    });\n    const multiLine = multiLineItems.join(`, ${extraNewLine}`);\n    s = `${multiLine}${extraNewLine}${usesOutdent}`;\n\n    if (key) return `{${extraNewLine}${s}}`;\n    return `\\n${s}`;\n}\n/**\n * short version of address for compact display\n * @public\n */\nexport function abbrevAddress(address: Address) {\n    return abbreviatedDetail(address.toString(), 12, false);\n}\n\n/**\n * short representation of bytes for compact display\n * @public\n */\nexport function abbreviatedDetailBytes(\n    prefix: string,\n    value: number[],\n    initLength = 8\n) {\n    const hext = bytesToHex(value);\n    const Len = value.length;\n    const text = checkValidUTF8(value)\n        ? ` ‹\"${abbreviatedDetail(bytesToText(value), initLength)}\"›`\n        : ``;\n\n    if (value.length <= initLength) return `${prefix}${hext}${text}`;\n    const checksumString = encodeBech32(\"_\", value).slice(-4);\n    return `${prefix}${hext.slice(0, initLength)}… ‹${checksumString}›${text}`;\n}\n\n/**\n * short version of hex string for compact display\n * @internal\n */\nexport function abbreviatedDetail(\n    hext: string,\n    initLength = 8,\n    countOmitted: boolean = false\n) {\n    if (process?.env?.EXPAND_DETAIL) {\n        return hext;\n    } else {\n        if (hext.length <= initLength) return hext;\n        const omittedCount = countOmitted ? hext.length - initLength - 4 : 0;\n        let omittedString = countOmitted ? `‹…${omittedCount}…›` : \"…\";\n        if (countOmitted && omittedCount < omittedString.length) {\n            omittedString = hext.slice(initLength, -4);\n        }\n        return `${hext.slice(0, initLength)}${omittedString}${hext.slice(-4)}`;\n    }\n}\n","import type { ErrorMap } from \"./delegation/RolesAndDelegates.js\";\nimport { StellarTxnContext } from \"./StellarTxnContext.js\";\nimport {\n    makeByteArrayData,\n    type ByteArrayData,\n    type UplcProgramV2,\n} from \"@helios-lang/uplc\";\nimport {\n    uplcDataSerializer,\n    abbreviatedDetail,\n    abbreviatedDetailBytes,\n} from \"./delegation/jsonSerializers.js\";\nimport {\n    type Value,\n    type Address,\n    type Tx,\n    type TxId,\n    type TxInput,\n    type TxOutput,\n    type TxOutputId,\n    type NetworkParams,\n    type Assets,\n    type MintingPolicyHash,\n    type TxRedeemer,\n    type TxOutputDatum,\n    makeAddress,\n    makeNetworkParamsHelper,\n} from \"@helios-lang/ledger\";\nimport { bytesToHex } from \"@helios-lang/codec-utils\";\nimport {\n    bytesToText,\n    textToBytes,\n    type InlineDatum,\n} from \"./HeliosPromotedTypes.js\";\nimport type { UtxoDisplayCache } from \"./StellarContract.js\";\n\n/**\n * converts a hex string to a printable alternative, with no assumptions about the underlying data\n * @remarks\n *\n * Unlike Helios' bytesToText, hexToPrintable() simply changes printable characters to characters,\n * and represents non-printable characters in '‹XX›' format.\n * @param hexStr - hex input\n * @public\n **/\nexport function hexToPrintableString(hexStr: string) {\n    let result = \"\";\n    for (let i = 0; i < hexStr.length; i += 2) {\n        let hexChar = hexStr.substring(i, i + 2);\n        let charCode = parseInt(hexChar, 16);\n\n        // ASCII printable characters are in the range 32 (space) to 126 (~)\n        if (charCode >= 32 && charCode <= 126) {\n            result += String.fromCharCode(charCode);\n        } else {\n            result += `‹${hexChar}›`;\n        }\n\n        // todo decode utf8 parts using bytesToText(...substring...)\n        // int         required_len;\n        // if (key[0] >> 7 == 0)\n        //     required_len = 1;\n        // else if (key[0] >> 5 == 0x6)\n        //     required_len = 2;\n        // else if (key[0] >> 4 == 0xE)\n        //     required_len = 3;\n        // else if (key[0] >> 5 == 0x1E)\n        //     required_len = 4;\n        // else\n        //     return (0);\n        // return (strlen(key) == required_len && chars_are_folow_uni(key + 1));\n    }\n    return result;\n}\n\n/**\n * Displays a token name in a human-readable form\n * @remarks\n * Recognizes CIP-68 token names and displays them in a special format.\n * @param nameBytesOrString - the token name, as a string or byte array\n * @public\n */\nexport function displayTokenName(nameBytesOrString: string | number[]) {\n    // check if it is a cip-68 token name by inspecting the first 4 bytes.  If they don't match the cip-68 pattern, display using stringToPrintableString.\n    // if it has a cip-68 tag in the first 4 bytes, show the cip-68 tag as `‹cip68/{tag}›` and append the rest of the token name as a string.\n    // inspect the first 4 bytes by:\n    //  - converting them to hex\n    //  - checking if the first and last nibbles are 0's (if not, then it is not a cip-68 token name)\n    //  - removing the first and last nibbles, shifting the hex string to the left by 1 nibble to get a 2-byte tag and 1 byte of checksum\n    //  - separating the cip-68 tag from the checksum\n    //  - parsing the cip-68 tag as a number (parseInt(numHex, 16))\n\n    let nameString = \"\";\n    let cip68Tag = \"\";\n    let cip68TagHex = \"\";\n    let checksum = \"\";\n    let tagBytes = \"\";\n    let nameBytesHex = \"\";\n    let nameBytesString = \"\";\n    let isCip68 = false;\n    if (typeof nameBytesOrString === \"string\") {\n        // convert the bytes of the string to hex\n        nameBytesHex = Buffer.from(textToBytes(nameBytesOrString)).toString(\n            \"hex\"\n        );\n        nameString = nameBytesOrString;\n    } else {\n        nameBytesHex = Buffer.from(nameBytesOrString).toString(\"hex\");\n        nameString = stringToPrintableString(nameBytesOrString);\n    }\n    // check if the first 4 bytes are a cip-68 token name\n    if (nameBytesHex.length >= 8) {\n        // check if the first and last nibbles are 0's\n        if (\n            nameBytesHex.substring(0, 1) === \"0\" &&\n            nameBytesHex.substring(7, 8) === \"0\"\n        ) {\n            // remove the first and last nibbles\n            cip68TagHex = nameBytesHex.substring(1, 5);\n            checksum = nameBytesHex.substring(5, 7);\n\n            // separate the cip-68 tag from the checksum\n            cip68Tag = parseInt(cip68TagHex, 16).toString();\n            nameString = stringToPrintableString(nameBytesOrString.slice(4));\n\n            // TODO: check the crc-8 checksum of the tag\n            isCip68 = true;\n        }\n    }\n    if (isCip68) {\n        nameString = `‹cip68/${cip68Tag}›${nameString}`;\n    } else {\n        nameString = stringToPrintableString(nameBytesOrString);\n    }\n    return nameString;\n}\n\n/**\n * Presents a string in printable form, even if it contains non-printable characters\n *\n * @remarks\n * Non-printable characters are shown in '‹XX›' format.\n * @public\n */\nexport function stringToPrintableString(str: string | number[]) {\n    if (\"string\" != typeof str) {\n        // use a TextEncoder to identify if it is a utf8 string\n        try {\n            return new TextDecoder(\"utf-8\", { fatal: true }).decode(\n                new Uint8Array(str as number[])\n            );\n        } catch (e) {\n            // if it is not a utf8 string, fall back to printing what's printable and showing hex for other bytes\n            str = Buffer.from(str as number[]).toString(\"hex\");\n        }\n    }\n    let result = \"\";\n    for (let i = 0; i < str.length; i++) {\n        let charCode = str.charCodeAt(i);\n\n        // ASCII printable characters are in the range 32 (space) to 126 (~)\n        if (charCode >= 32 && charCode <= 126) {\n            result += str[i];\n        } else {\n            result += `‹${charCode.toString(16)}›`;\n        }\n    }\n    return result;\n}\n\n/**\n * Converts an array of [ policyId, ‹tokens› ] tuples for on-screen presentation\n * @remarks\n *\n * Presents policy-ids with shortened identifiers, and shows a readable & printable\n * representation of token names even if they're not UTF-8 encoded.\n * @public\n **/\nexport function assetsAsString(\n    a: Assets,\n    joiner = \"\\n    \",\n    showNegativeAsBurn?: \"withBURN\",\n    mintRedeemers?: Record<number, string>\n) {\n    const assets = a.assets;\n    return (\n        assets?.map(([policyId, tokenEntries], index) => {\n            let redeemerInfo = mintRedeemers?.[index] || \"\";\n            if (redeemerInfo) {\n                redeemerInfo = `\\n        r = ${redeemerInfo} `;\n            }\n            const tokenString = tokenEntries\n                .map(([nameBytes, count]: [number[], bigint]) => {\n                    // const nameString =  hexToPrintableString(nameBytes.hex);\n                    const nameString = displayTokenName(nameBytes);\n\n                    const negWarning =\n                        count < 1n\n                            ? showNegativeAsBurn\n                                ? \"🔥 \"\n                                : \" ⚠️ NEGATIVE⚠️\"\n                            : \"\";\n                    const burned =\n                        count < 1\n                            ? showNegativeAsBurn\n                                ? \"- BURN 🔥 \"\n                                : \"\"\n                            : \"\";\n                    return `${negWarning} ${count}×💴 ${nameString} ${burned}`;\n                })\n                .join(\"+\");\n            return `⦑${policyIdAsString(\n                policyId\n            )} ${tokenString} ${redeemerInfo}⦒`;\n        }) || []\n    ).join(joiner);\n}\n\n/**\n * Converts a MintingPolicyHash to a printable form\n * @public\n **/\nexport function policyIdAsString(p: MintingPolicyHash) {\n    const pIdHex = p.toHex();\n    const abbrev = abbreviatedDetail(pIdHex);\n    return `🏦 ${abbrev}`;\n}\n\n/**\n * Converts lovelace to approximate ADA, in consumable 3-decimal form\n * @public\n **/\nexport function lovelaceToAdaOld(l: bigint | number) {\n    const asNum = parseInt(l.toString());\n    const ada =\n        (asNum && `${(Math.round(asNum / 1000) / 1000).toFixed(3)} ADA`) || \"\";\n    return ada;\n}\n\n/**\n * Converts lovelace to approximate ADA, in consumable 3-decimal form\n * @public\n */\nexport function lovelaceToAda(lovelace: bigint | number): string {\n    const asNum = parseInt(lovelace.toString());\n    // input: 6004000 should output 6_004.000\n    // input: 700396001000 should output 700_396.001\n    // input: 400202 should output 0.400_202\n    const whole = Math.floor(asNum / 1_000_000).toFixed(0);\n    let fraction = (asNum % 1_000_000).toFixed(0); // \"\"\n    fraction = fraction.padStart(6, \"0\");\n    const wholeWithSeparators = whole.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \"_\");\n    let fractionWithSeparators = fraction\n        .replace(/(\\d{3})(?=\\d)/g, \"$1_\")\n        .replace(/^-/, \"\"); // remove leading - if any\n    return `${wholeWithSeparators}.${fractionWithSeparators} ADA`;\n}\n\n/**\n * Converts a bigint or number to a string with commas as thousands separators\n * @public\n */\nexport function intWithGrouping(i : bigint | number) {\n    const whole = Math.floor(Number(i)).toFixed(0);\n    const fraction = Math.abs(Number(i) - Math.floor(Number(i))).toFixed(0);\n    const wholeWithSeparators = whole.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \"_\");\n    const fractionWithSeparators = fraction\n        .replace(/(\\d{3})(?=\\d)/g, \"$1_\")\n    return `${wholeWithSeparators}.${fractionWithSeparators}`;\n}\n/**\n * Converts a Value to printable form\n * @public\n **/\nexport function valueAsString(v: Value) {\n    const ada = lovelaceToAda(v.lovelace);\n    const assets = assetsAsString(v.assets);\n    return [ada, assets].filter((x) => !!x).join(\" + \");\n}\n\n/**\n * Converts a Tx to printable form\n * @public\n **/\nexport function txAsString(tx: Tx, networkParams?: NetworkParams): string {\n    const outputOrder = [\n        [\"body\", \"inputs\"],\n        [\"body\", \"minted\"],\n        [\"body\", \"outputs\"],\n        [\"body\", \"refInputs\"],\n        [\"witnesses\", \"redeemers\"],\n        [\"body\", \"signers\"],\n        [\"witnesses\", \"v2refScripts\"],\n        [\"witnesses\", \"v2scripts\"],\n        [\"witnesses\", \"nativeScripts\"],\n        [\"body\", \"collateral\"],\n        [\"body\", \"collateralReturn\"],\n        [\"body\", \"scriptDataHash\"],\n        [\"body\", \"metadataHash\"],\n        [\"witnesses\", \"signatures\"],\n        [\"witnesses\", \"datums\"],\n        [\"body\", \"lastValidSlot\"],\n        [\"body\", \"firstValidSlot\"],\n        [\"body\", \"fee\"],\n    ];\n\n    let details = \"\";\n    if (!networkParams) {\n        console.warn(\n            new Error(`dumpAny: no networkParams; can't show txn size info!?!`)\n        );\n    }\n\n    const networkParamsHelper = networkParams\n        ? makeNetworkParamsHelper(networkParams)\n        : undefined;\n\n    // const d = tx.dump();\n    const seenRedeemers = new Set();\n\n    const allRedeemers = tx.witnesses.redeemers as any;\n    let hasIndeterminate = false;\n    const inputRedeemers: Record<\n        string | number,\n        { r?: TxRedeemer; display: string }\n    > = Object.fromEntries(\n        allRedeemers\n            .map((x: TxRedeemer, index: number) => {\n                // debugger;\n                if (x.kind != \"TxSpendingRedeemer\") return undefined;\n                // if (!(\"inputIndex\" in x)) return undefined;\n                const { inputIndex } = x;\n                const isIndeterminate = inputIndex == -1;\n                if (isIndeterminate) hasIndeterminate = true;\n                const inpIndex = isIndeterminate ? `‹unk${index}›` : inputIndex;\n                if (!x.data) debugger;\n                const showData = x.data.rawData\n                    ? uplcDataSerializer(\"\", x.data.rawData)\n                    : x.data?.toString() || \"‹no data›\";\n                return [inpIndex, { r: x, display: showData }];\n            })\n            .filter((x) => !!x)\n    );\n    if (hasIndeterminate)\n        inputRedeemers[\"hasIndeterminate\"] = {\n            r: undefined,\n            display: \"‹unk›\",\n        };\n\n    const mintRedeemers = Object.fromEntries(\n        allRedeemers\n            .map((x) => {\n                if (\"TxMintingRedeemer\" != x.kind) return undefined;\n                if (\"number\" != typeof x.policyIndex) {\n                    debugger;\n                    throw new Error(`non-mint redeemer here not yet supported`);\n                }\n                if (!x.data) debugger;\n\n                const showData =\n                    (x.data.rawData\n                        ? uplcDataSerializer(\"\", x.data.rawData)\n                        : x.data?.toString() || \"‹no data›\") +\n                    \"\\n\" +\n                    bytesToHex(x.data.toCbor());\n\n                return [x.policyIndex, showData];\n            })\n            .filter((x) => !!x)\n    );\n\n    //!!! todo: improve interface of tx so useful things have a non-private api\n    //!!! todo: get back to type-safety in this diagnostic suite\n    for (const [where, x] of outputOrder) {\n        let item = tx[where][x];\n        let skipLabel = false;\n        if (Array.isArray(item) && !item.length) continue;\n\n        if (!item) continue;\n        if (\"inputs\" == x) {\n            item = `\\n  ${item\n                .map((x: TxInput, i) => {\n                    const { r, display } =\n                        inputRedeemers[i] ||\n                        inputRedeemers[\"hasIndeterminate\"] ||\n                        {};\n                    if (!display && x.datum?.data) debugger;\n                    tx;\n                    if (r) seenRedeemers.add(r);\n                    return txInputAsString(\n                        x,\n                        /* unicode blue arrow right -> */ \"➡️  \" + `@${1 + i} `,\n                        i,\n                        display // || \"‹failed to find redeemer info›\"\n                    );\n                })\n                .join(\"\\n  \")}`;\n        }\n        if (\"refInputs\" == x) {\n            item = `\\n  ${item\n                .map((x) => txInputAsString(x, \"ℹ️  \"))\n                .join(\"\\n  \")}`;\n        }\n        if (\"collateral\" == x) {\n            //!!! todo: group collateral with inputs and reflect it being spent either way,\n            //     IFF it is also a tx `input`\n            //!!! todo: move collateral to bottom with collateralReturn,\n            //     IFF it is not part of the tx `inputs`\n            item = item.map((x) => txInputAsString(x, \"🔪\")).join(\"\\n    \");\n        }\n        if (\"minted\" == x) {\n            if (!item.assets.length) {\n                continue;\n            }\n            item = `\\n   ❇️  ${assetsAsString(\n                item,\n                \"\\n   ❇️  \",\n                \"withBURN\",\n                mintRedeemers\n            )}`;\n        }\n        if (\"outputs\" == x) {\n            item = `\\n  ${item\n                .map((x, i) =>\n                    txOutputAsString(\n                        x,\n                        \"🔹\" /* <-- unicode blue bullet */ + `${i} <-`\n                    )\n                )\n                .join(\"\\n  \")}`;\n        }\n        if (\"firstValidSlot\" == x || \"lastValidSlot\" == x) {\n            if (networkParamsHelper) {\n                const slotTime = new Date(networkParamsHelper.slotToTime(item));\n                const timeDiff = (slotTime.getTime() - Date.now()) / 1000;\n                // format timeDiff with explicit plus or minus sign:\n                const sign = timeDiff > 0 ? \"+\" : \"-\";\n                const timeDiffString =\n                    sign + Math.abs(timeDiff).toFixed(1) + \"s\";\n\n                item = `${item} ${slotTime.toLocaleDateString()} ${slotTime.toLocaleTimeString()} (now ${timeDiffString})`;\n            }\n        }\n\n        if (\"signers\" == x) {\n            item = item.map((x) => {\n                const hex = x.toHex();\n                return `🔑#${hex.slice(0, 6)}…${hex.slice(-4)}`;\n            });\n        }\n\n        if (\"fee\" == x) {\n            item = lovelaceToAda(item);\n\n            // tx.profileReport.split(\"\\n\")[0];\n            // todo: find profile info and restore it here\n        }\n\n        if (\"collateralReturn\" == x) {\n            skipLabel = true;\n            item = `  ${txOutputAsString(\n                item,\n                `0  <- ❓`\n            )} conditional: collateral change (returned in case of txn failure)`;\n        }\n        if (\"scriptDataHash\" == x) {\n            item = bytesToHex(item);\n        }\n\n        if (\"datums\" == x && !Object.entries(item || {}).length) continue;\n        if (\"signatures\" == x) {\n            if (!item) continue;\n            item = item.map((s) => {\n                const addr = makeAddress(true, s.pubKeyHash);\n                const hashHex = s.pubKeyHash.toHex();\n                return `🖊️ ${addrAsString(addr)} = 🔑…${hashHex.slice(-4)}`;\n            });\n            if (item.length > 1) item.unshift(\"\");\n            item = item.join(\"\\n    \");\n        }\n        if (\"redeemers\" == x) {\n            if (!item) continue;\n\n            //!!! todo: augment with mph when that's available from the Activity.\n            item = item.map((x) => {\n                // console.log(\"redeemer keys\", ...[ ...Object.keys(x2) ], x2.dump());\n                // const isIndeterminate = x.inputIndex == -1;\n                // if (isIndeterminate) indeterminateRedeemerDetails = true;\n                // debugger\n                // const indexInfo = isIndeterminate\n                //     ? `spend txin #‹tbd›`\n                // if (x.kind == \"TxSpendingRedeemer\") {\n                //     debugger\n                // }\n                const indexInfo =\n                    x.kind == \"TxMintingRedeemer\"\n                        ? `minting policy ${x.policyIndex}`\n                        : `spend txin ➡️  @${1 + x.inputIndex}`;\n\n                const showData = seenRedeemers.has(x)\n                    ? \"(see above)\"\n                    : x.data.fromData\n                    ? uplcDataSerializer(\"\", x.data.fromData)\n                    : x.data.toString();\n                return `🏧  ${indexInfo} ${showData}`;\n            });\n            if (item.length > 1) item.unshift(\"\");\n            item = item.join(\"\\n    \");\n        }\n        if (\"v2Scripts\" == x) {\n            if (!item) continue;\n            item = item.map((s) => {\n                try {\n                    const mph = s.mintingPolicyHash.toHex();\n                    // debugger\n                    return `🏦 ${mph.slice(0, 8)}…${mph.slice(-4)} (minting): ${\n                        s.serializeBytes().length\n                    } bytes`;\n                } catch (e) {\n                    const vh = s.validatorHash;\n\n                    const vhh = vh.toHex();\n                    const addr = makeAddress(true, vh);\n                    // debugger\n                    return `📜 ${vhh.slice(0, 8)}…${vhh.slice(\n                        -4\n                    )} (validator at ${addrAsString(addr)}): ${\n                        s.serializeBytes().length\n                    } bytes`;\n                }\n            });\n            if (item.length > 1) item.unshift(\"\");\n            item = item.join(\"\\n    \");\n        }\n        if (\"v2RefScripts\" == x) {\n            item = `${item.length} - see refInputs`;\n            // todo: @helios give us refScripts outside of dump(), which only shows us hex.\n        }\n\n        if (!item) continue;\n        details += `${skipLabel ? \"\" : \"  \" + x + \": \"}${item}\\n`;\n    }\n    try {\n        details += `  txId: ${tx.id().toHex()}`;\n        if (networkParams) details += `  \\n\\nsize: ${tx.toCbor().length} bytes`;\n    } catch (e) {\n        details = details + `(Tx not yet finalized!)`;\n        if (networkParams) details += `\\n  - NOTE: can't determine txn size\\n`;\n    }\n    return details;\n}\n\n/**\n * Converts a TxInput to printable form\n * @remarks\n *\n * Shortens address and output-id for visual simplicity; doesn't include datum info\n * @public\n **/\nexport function txInputAsString(\n    x: TxInput,\n    prefix = \"-> \",\n    index?: number,\n    redeemer?: string\n): string {\n    const { output: oo } = x;\n    const redeemerInfo = redeemer ? `\\n    r = ${redeemer}` : \" ‹no redeemer›\";\n    const datumInfo =\n        oo.datum?.kind == \"InlineTxOutputDatum\" ? datumSummary(oo.datum) : \"\";\n\n    return `${prefix}${addrAsString(x.address)}${showRefScript(\n        oo.refScript as any\n    )} ${valueAsString(x.value)} ${datumInfo} = 📖 ${txOutputIdAsString(\n        x.id\n    )}${redeemerInfo}`;\n}\n\n/**\n * Converts a list of UTxOs to printable form\n * @remarks\n *\n * ... using {@link utxoAsString}\n * @public\n **/\nexport function utxosAsString(\n    utxos: TxInput[],\n    joiner = \"\\n\",\n    utxoDCache?: UtxoDisplayCache\n): string {\n    return utxos.map((u) => utxoAsString(u, \" 💵\", utxoDCache)).join(joiner);\n}\n/**\n * Converts a TxOutputId to printable form\n * @public\n */\nexport function txOutputIdAsString(x: TxOutputId, length = 8): string {\n    return (\n        txidAsString(x.txId, length) +\n        \"🔹\" /* <-- unicode blue bullet */ +\n        `#${x.index}`\n    );\n}\n\n/**\n * Converts a TxId to printable form\n * @remarks\n *\n * ... showing only the first 6 and last 4 characters of the hex\n * @public\n **/\nexport function txidAsString(x: TxId, length = 8): string {\n    const tid = x.toHex();\n    return `${tid.slice(0, length)}…${tid.slice(-4)}`;\n}\n\n/**\n * converts a utxo to printable form\n * @remarks\n *\n * shows shortened output-id and the value being output, plus its datum\n * @internal\n **/\nexport function utxoAsString(\n    x: TxInput,\n    prefix = \"💵\",\n    utxoDCache?: UtxoDisplayCache\n): string {\n    return ` 📖 ${txOutputIdAsString(x.id)}: ${txOutputAsString(\n        x.output,\n        prefix,\n        utxoDCache,\n        x.id\n    )}`;\n}\n\n/**\n * converts a Datum to a printable summary\n * @remarks\n *\n * using shortening techniques for the datumHash\n * @public\n **/\nexport function datumSummary(d: TxOutputDatum | null | undefined): string {\n    if (!d) return \"\"; //\"‹no datum›\";\n\n    // debugger\n    const dh = d.hash.toHex();\n    const dhss = `${dh.slice(0, 8)}…${dh.slice(-4)}`;\n    if (d.kind == \"InlineTxOutputDatum\") {\n        const attachedData = d.data.rawData;\n        if (attachedData) {\n            return `\\n    d‹inline:${dhss} - ${\n                uplcDataSerializer(\"\", attachedData) //.slice(1,-1)\n            }=${d.toCbor().length} bytes›`;\n        } else {\n            return `d‹inline:${dhss} - ${d.toCbor().length} bytes›`;\n        }\n    }\n    return `d‹hash:${dhss}…›`;\n}\n// /**\n//  * @internal\n//  */\n// export function datumExpanded(d: Datum | null | undefined): string {\n//     if (!d) return \"\";\n//     if (!d.isInline()) return \"\";\n//     const data = bytesToHex(d.data?.toCbor());\n//     return `\\n    d = ${data}`;\n// }\n\n/**\n * Displays a short summary of any provided reference script\n * @remarks\n *\n * detailed remarks\n * @param ‹pName› - descr\n * @typeParam ‹pName› - descr (for generic types)\n * @public\n **/\nexport function showRefScript(rs?: UplcProgramV2 | null) {\n    if (!rs) return \"\";\n    const hash = rs.hash();\n    const hh = bytesToHex(hash);\n    const size = rs.toCbor().length;\n    const rshInfo = `${hh.slice(0, 8)}…${hh.slice(-4)}`;\n    return ` ‹📀 refScript📜 ${rshInfo}: ${size} bytes› +`;\n}\n\n/**\n * Converts a txOutput to printable form\n * @remarks\n *\n * including all its values, and shortened Address.\n * @public\n **/\nexport function txOutputAsString(\n    x: TxOutput,\n    prefix = \"<-\",\n    utxoDCache?: UtxoDisplayCache,\n    txoid?: TxOutputId\n): string {\n    if (utxoDCache && !txoid) {\n        throw new Error(\n            `txOutputAsString: must provide txoid when using cache`\n        );\n    }\n    let cache = utxoDCache?.get(txoid!);\n    if (cache) {\n        return `♻️ ${cache} (same as above)`;\n    }\n    cache = `${prefix} ${addrAsString(x.address)}${showRefScript(\n        x.refScript as any\n    )} ${valueAsString(x.value)}`;\n    utxoDCache?.set(txoid!, cache);\n\n    return `${cache} ${datumSummary(x.datum)}`;\n}\n\n/**\n * Renders an address in shortened bech32 form, with prefix and part of the bech32 suffix\n * @remarks\n * @param address - address\n * @public\n **/\nexport function addrAsString(address: Address): string {\n    const bech32 = address.toString();\n    // const uplc = address.toUplcData?.();\n    // const hex = bytesToHex(uplc.toCbor());\n    return `${bech32.slice(0, 14)}…${bech32.slice(-4)}`;\n    // + ` = `+abbreviatedDetailBytes(\"‹cbor:\", uplc.toCbor(), 99)+\"›\"\n}\n\n/**\n * Converts an Errors object to a string for onscreen presentation\n * @public\n **/\nexport function errorMapAsString(em: ErrorMap, prefix = \"  \") {\n    return Object.keys(em)\n        .map((k) => `in field ${prefix}${k}: ${JSON.stringify(em[k])}`)\n        .join(\"\\n\");\n}\n\n/**\n * Converts a list of ByteArrays to printable form\n * @remarks\n *\n * ... using {@link hexToPrintableString}\n * @public\n **/\nexport function byteArrayListAsString(\n    items: ByteArrayData[],\n    joiner = \"\\n  \"\n): string {\n    return (\n        \"[\\n  \" +\n        items.map((ba) => byteArrayAsString(ba)).join(joiner) +\n        \"\\n]\\n\"\n    );\n}\n\n/**\n * Renders a byteArray in printable form, assuming it contains (mostly) text\n * @remarks\n *\n * Because it uses {@link hexToPrintableString | hexToPrintableString()}, it will render any non-printable\n * characters using ‹hex› notation.\n * @param ba - the byte array\n * @public\n **/\nexport function byteArrayAsString(ba: ByteArrayData): string {\n    return hexToPrintableString(ba.toHex());\n}\n\n/**\n * Converts any (supported) input arg to string\n * @remarks\n *\n * more types to be supported TODO\n * @public\n **/\nexport function dumpAny(\n    x:\n        | undefined\n        | Tx\n        | StellarTxnContext\n        | Address\n        | MintingPolicyHash\n        | Value\n        | Assets\n        | TxOutputId\n        | TxOutput\n        | TxOutput[]\n        | TxInput\n        | TxInput[]\n        | TxId\n        | number[]\n        | ByteArrayData\n        | ByteArrayData[],\n    networkParams?: NetworkParams,\n    forJson = false\n) {\n    if (\"undefined\" == typeof x) return \"‹undefined›\";\n    //@ts-expect-error probing type \n    if (x?.kind == \"Assets\") {\n        return `assets: ${assetsAsString(x as Assets)}`;\n    }\n    if (Array.isArray(x)) {\n        if (!x.length) return \"‹empty array›\";\n\n        const firstItem = x[0];\n        if (\"number\" == typeof firstItem) {\n            return (\n                \"num array: \" +\n                byteArrayListAsString([makeByteArrayData(x as number[])])\n            );\n        }\n        if (firstItem.kind == \"TxOutput\") {\n            return (\n                \"tx outputs: \\n\" +\n                (x as TxOutput[]).map((txo: TxOutput) => txOutputAsString(txo)).join(\"\\n\")\n            );\n        }\n\n        if (firstItem.kind == \"TxInput\") {\n            return \"utxos: \\n\" + utxosAsString(x as TxInput[]);\n        }\n\n        //@ts-expect-error on this type probe\n        if (firstItem.kind == \"ByteArrayData\") {\n            return (\n                \"byte array:\\n\" + byteArrayListAsString(x as ByteArrayData[])\n            );\n        }\n\n        if (\"object\" == typeof firstItem) {\n            // debugger;\n            if (firstItem instanceof Uint8Array) {\n                return \"byte array: \" + byteArrayAsString(firstItem);\n            }\n            return (\n                `[` +\n                x\n                    .map((item) => JSON.stringify(item, betterJsonSerializer))\n                    .join(\", \") +\n                `]`\n            );\n        }\n\n        console.log(\"firstItem\", firstItem);\n        throw new Error(\n            `dumpAny(): unsupported array type: ${typeof firstItem}`\n        );\n    }\n\n    if (\"bigint\" == typeof x) {\n        return (x as bigint).toString();\n    }\n    if (x instanceof StellarTxnContext) {\n        debugger;\n        throw new Error(`use await build() and dump the result instead.`);\n    }\n\n    const xx = x;\n\n    if (x.kind == \"TxOutput\") {\n        return txOutputAsString(x as TxOutput);\n    }\n\n    if (xx.kind == \"Tx\") {\n        return txAsString(xx, networkParams);\n    }\n\n    if (xx.kind == \"TxOutputId\") {\n        return txOutputIdAsString(xx);\n    }\n\n    if (xx.kind == \"TxId\") {\n        return txidAsString(xx);\n    }\n\n    if (xx.kind == \"TxInput\") {\n        return utxoAsString(xx);\n    }\n    if (xx.kind == \"Value\") {\n        return valueAsString(xx);\n    }\n    if (xx.kind == \"Address\") {\n        return addrAsString(xx);\n    }\n    if (xx.kind == \"MintingPolicyHash\") {\n        return policyIdAsString(xx);\n    }\n    if (forJson) return xx;\n\n    if (\"object\" == typeof x) {\n        return `{${Object.entries(x)\n            .map(([k, v]) => `${k}: ${dumpAny(v as any, networkParams)}`)\n            .join(\",\\n\")}}`;\n    }\n    debugger;\n    return \"dumpAny(): unsupported type or library mismatch\";\n}\n\n/**\n * @public\n */\nexport const betterJsonSerializer = (key, value) => {\n    return dumpAny(value, undefined, true);\n};\n\nif (\"undefined\" == typeof window) {\n    globalThis.peek = dumpAny;\n} else {\n    //@ts-expect-error\n    window.peek = dumpAny;\n}\n","import type { Site } from \"@helios-lang/compiler-utils\";\nimport type { UplcLogger } from \"@helios-lang/uplc\";\n\nexport class UplcConsoleLogger implements UplcLogger {\n    didStart: boolean = false;\n    lines: string[] = [];\n    lastMessage: string = \"\";\n    lastReason?: \"build\" | \"validate\";\n    history: string[] = [];\n\n    constructor() {\n        this.logPrint = this.logPrint.bind(this);\n        // this.printlnFunction = this.printlnFunction.bind(this);\n        this.reset = this.reset.bind(this);\n    }\n    reset(reason: \"build\" | \"validate\") {\n        this.lastMessage = \"\";\n        this.lastReason = reason;\n        // console.log(\"    ---- resetting printer due to \" + reason);\n        // this.didStart = false;\n        if (reason == \"build\") {\n            // throw new Error(`unexpected`)\n            this.lines = [];\n            return;\n        }\n        if (reason == \"validate\") {\n            this.flush();\n            return;\n        }\n    }\n    // log(...msgs: string[]) {\n    //     return this.logPrint(...msgs);\n    // }\n    // error(...msgs: string[]) {\n    //     return this.logError(...msgs, \"\\n\");\n    // }\n\n    // logPrintLn(...msgs: string[]) {\n    //     return this.logPrint(...msgs, \"\\n\");\n    // }\n\n    logPrint(message: string, site?: Site) {\n        // if ( global.validating) debugger\n        // if (msg == \"no\") { debugger }\n        // if (this.lastReason && this.lastReason == \"validate\") {\n        //     debugger\n        // }\n        \n        if (\"string\" != typeof message) {\n            console.log(\"wtf\");\n        }\n        if (message && message.at(-1) != \"\\n\") {\n            message += \"\\n\";\n        }\n        this.lastMessage = message;\n        this.lines.push(message);\n        return this;\n    }\n    logError(message: string, stack? : Site) {\n        this.logPrint(\"\\n\");\n        this.logPrint(\n            \"-\".repeat((process?.stdout?.columns || 65) - 8)\n        );\n        this.logPrint(\"--- ⚠️  ERROR: \" + message.trimStart() + \"\\n\");\n        this.logPrint(\n            \"-\".repeat((process?.stdout?.columns || 65) - 8) + \"\\n\"\n        );\n        // return this;\n    }\n    // printlnFunction(msg) {\n    //     console.log(\"                              ---- println\")\n    //     this.lines.push(msg);\n    //     this.lines.push(\"\\n\");\n    //     this.flushLines();\n    // }\n    toggler = 0;\n    toggleDots() {\n        this.toggler = 1 - this.toggler;\n    }\n    get isMine() {\n        return true;\n    }\n    resetDots() {\n        this.toggler = 0;\n    }\n    showDot() {\n        // ◌ or ●\n        const s = this.toggler ? \"│   ┊ \" : \"│ ● ┊ \";\n        this.toggleDots();\n        return s;\n    }\n\n    fullHistory() {\n        return this.history.join(\"\\n\");\n    }\n    formattedHistory: string[] = [];\n    fullFormattedHistory() {\n        return this.formattedHistory.join(\"\\n\")\n    }\n\n\n    flushLines(footerString?: string) {\n        // this.lines.push(this.accumulator.join(\"\"))\n        let content: string[] = [];\n        // get terminal width if available:\n        const terminalWidth = process?.stdout?.columns || 65;\n        const thisBatch = this.lines.join(\"\").trimEnd();\n        this.history.push(thisBatch);\n        if (!this.didStart) {\n            this.didStart = true;\n            content.push(\"╭┈┈┈┬\" + \"┈\".repeat(terminalWidth - 5));\n            this.resetDots();\n        } else if (this.lines.length) {\n            content.push(\"├┈┈┈┼\" + \"┈\".repeat(terminalWidth - 5));\n            this.resetDots();\n        }\n        for (const line of thisBatch.split(\"\\n\")) {\n            //\"│\" or \"┊\" or \"┆\" or \"┇\" // unicode tiny  circle \"·\"\n            content.push(`${this.showDot()}${line}`);\n        }\n        // adds a little extra space before the footer\n        content.push(this.showDot());\n        // feed extra space if needed for the dots to look consistent\n        if (!this.toggler) {\n            content.push(this.showDot());\n        }\n        if (footerString) {\n            // if (!this.toggler && abortMarker) {\n            //     content.push(this.showDot());\n            // }\n            content.push(footerString);\n            // if (abortMarker) {\n            //     content.push(abortMarker);\n            // }\n        }\n        const joined = content.join(\"\\n\");\n        this.formattedHistory.push(joined);\n        console.log(joined);\n        this.lines = [];\n    }\n    finish() {\n        this.flushLines(\n            \"╰┈┈┈┴\" + \"┈\".repeat((process?.stdout?.columns || 65) - 5)\n        );\n        return this;\n    }\n    flush() {\n        if (this.lines.length) {\n            // console.log(\"    ---- flushing lines\");\n            if (this.lastMessage.at(-1) != \"\\n\") {\n                this.lines.push(\"\\n\");\n            }\n            this.flushLines();\n            //     \"╰,\"┈\"\n            // );\n        }\n        // console.log(\"╰ // ──────\n        return this;\n    }\n    flushError(message: string = \"\") {\n        // if (this.lastMsg == message) {\n        //     this.lines.pop();\n        // }\n        if (this.lastMessage.at(-1) != \"\\n\") {\n            this.lines.push(\"\\n\");\n        }\n        if (message.at(-1) == \"\\n\") {\n            message = message.slice(0, -1);\n        }\n        const terminalWidth = process?.stdout?.columns || 65;\n        if (message) this.logError(message);\n        if (this.lines.length) {\n            this.flushLines(\n                \"⎽⎼⎻⎺⎻⎺⎼⎼⎻⎺⎻⎽⎼⎺⎻⎻⎺⎼⎼⎻⎺\".repeat((terminalWidth - 2) / 21)\n            );\n        }\n        // this.didStart = false;\n        return this;\n    }\n}\n","import {\n    dumpAny,\n    intWithGrouping,\n    lovelaceToAda,\n    txAsString,\n    utxosAsString,\n} from \"./diagnostics.js\";\nimport type { hasUutContext } from \"./CapoTypes.js\";\nimport { UutName } from \"./delegation/UutName.js\";\nimport type { ActorContext, SetupInfo } from \"./StellarContract.js\";\nimport { delegateLinkSerializer } from \"./delegation/jsonSerializers.js\";\nimport type { Cost, UplcData, UplcProgramV2 } from \"@helios-lang/uplc\";\nimport { UplcConsoleLogger } from \"./UplcConsoleLogger.js\";\nimport type { isActivity, SeedAttrs } from \"./ActivityTypes.js\";\nimport {\n    type TxBuilder,\n    type WalletHelper,\n    type Wallet,\n    makeTxBuilder,\n    makeWalletHelper,\n    makeTxChainBuilder,\n} from \"@helios-lang/tx-utils\";\nimport {\n    decodeTx,\n    makeAssets,\n    makeNetworkParamsHelper,\n    makePubKey,\n    makeTx,\n    makeTxBody,\n    makeTxCertifyingRedeemer,\n    makeTxMintingRedeemer,\n    makeTxRewardingRedeemer,\n    makeTxSpendingRedeemer,\n    makeTxWitnesses,\n    makeValue,\n    type Address,\n    type NetworkParams,\n    type PubKeyHash,\n    type Tx,\n    type TxId,\n    type TxInput,\n    type TxOutput,\n    type Value,\n} from \"@helios-lang/ledger\";\nimport { bytesToHex } from \"@helios-lang/codec-utils\";\nimport type { UtxoHelper } from \"./UtxoHelper.js\";\nimport type { IF_ISANY } from \"./helios/typeUtils.js\";\nimport type { Expand } from \"./helios/typeUtils.js\";\nimport { customAlphabet } from \"nanoid\";\nconst nanoid = customAlphabet(\"0123456789abcdefghjkmnpqrstvwxyz\", 12);\nimport { TxNotNeededError } from \"./utils.js\";\n\n/**\n * A txn context having a seedUtxo in its state\n * @public\n **/\nexport type hasSeedUtxo = StellarTxnContext<\n    anyState & {\n        seedUtxo: TxInput;\n    }\n>;\n\nexport type txBuiltOrSubmitted =\n    | \"built\"\n    | \"alreadyPresent\"\n    | \"signed\"\n    | \"submitted\";\nexport type resolvedOrBetter = \"resolved\" | txBuiltOrSubmitted;\n/**\n * @public\n */\nexport type TxDescription<\n    T extends StellarTxnContext,\n    PROGRESS extends\n        | \"buildLater!\"\n        | \"resolved\"\n        | \"alreadyPresent\"\n        | \"built\"\n        | \"signed\"\n        | \"submitted\",\n    TCX extends StellarTxnContext = IF_ISANY<T, StellarTxnContext<anyState>, T>,\n    otherProps extends Record<string, unknown> = {}\n> = {\n    description: string;\n    id: string;\n    parentId?: string;\n    depth: number;\n    moreInfo?: string;\n    optional?: boolean;\n    txName?: string;\n    tcx?: TCX | TxNotNeededError;\n    tx?: Tx;\n    stats?: BuiltTcxStats;\n    txCborHex?: string;\n    signedTxCborHex?: string;\n} & otherProps &\n    (PROGRESS extends \"alreadyPresent}\"\n        ? {\n              mkTcx: (() => TCX) | (() => Promise<TCX>);\n              tcx: TCX & { alreadyPresent: TxNotNeededError };\n          }\n        : PROGRESS extends resolvedOrBetter\n        ? {\n              mkTcx?: (() => TCX) | (() => Promise<TCX>) | undefined;\n              tcx: TCX;\n          }\n        : {\n              mkTcx: (() => TCX) | (() => Promise<TCX>);\n              tcx?: undefined;\n          }) &\n    (PROGRESS extends txBuiltOrSubmitted\n        ? {\n              tx: Tx;\n              txId?: TxId;\n              stats: BuiltTcxStats;\n              options: SubmitOptions;\n              txCborHex: string;\n          }\n        : {}) &\n    (PROGRESS extends \"signed\" | \"submitted\"\n        ? {\n              txId: TxId;\n              txCborHex: string;\n              signedTxCborHex: string;\n              walletTxId: TxId;\n          }\n        : {});\n\n/**\n * @public\n */\nexport type MultiTxnCallback<\n    T extends undefined | StellarTxnContext<any> = StellarTxnContext<any>,\n    TXINFO extends TxDescription<any, resolvedOrBetter, any> = TxDescription<\n        any,\n        \"resolved\"\n    >\n> =\n    | ((txd: TXINFO) => void)\n    | ((txd: TXINFO) => Promise<void>)\n    | ((txd: TXINFO) => T | false)\n    | ((txd: TXINFO) => Promise<T | false>);\n\n/**\n * A transaction context that includes additional transactions in its state for later execution\n * @remarks\n *\n * During the course of creating a transaction, the transaction-building functions for a contract\n * suite may suggest or require further transactions, which may not be executable until after the\n * current transaction is executed.  This type allows the transaction context to include such\n * future transactions in its state, so that they can be executed later.\n *\n * The future transactions can be executed using the {@link StellarTxnContext.queueAddlTxns}\n * helper method.\n * @public\n **/\nexport type hasAddlTxns<\n    TCX extends StellarTxnContext<anyState>,\n    existingStateType extends anyState = TCX[\"state\"]\n> = StellarTxnContext<\n    existingStateType & {\n        addlTxns: Record<string, TxDescription<any, \"buildLater!\">>;\n    }\n>;\n\nexport type otherAddlTxnNames<TCX extends StellarTxnContext<any>> = string &\n    TCX extends { state: { addlTxns: infer aTNs } }\n    ? keyof aTNs\n    : never;\n\n// type combinedAddlTxns<\n//     extraTxnName extends string,\n//     stateType extends anyState,\n//     existingTxns = stateType extends {addlTxns: any} ? stateType[\"addlTxns\"] : never,\n//     existingTxnNames extends string = string & keyof existingTxns\n// > = {\n//     addlTxns: {\n//         //prettier-ignore\n//         [txnName in (\n//             | extraTxnName\n//             | existingTxnNames\n//         )]: AddlTxInfo<any>\n//     }\n// } & stateType;\n\n//!!! if we could access the inputs and outputs in a building Tx,\n//  this might  not be necessary (unless it becomes a\n//   bigger-picture contextual container that serves various Stellar\n//   contract scripts with non-txn context for building a Tx)\n\n/**\n * A base state for a transaction context\n * @public\n **/\nexport interface anyState {\n    uuts: uutMap;\n}\n\n/**\n * A base state for a transaction context\n * @public\n **/\n// export type anyState = emptyState;\nexport type uutMap = Record<string, unknown>;\nexport const emptyUuts: uutMap = Object.freeze({});\n\n// type addInputArgs = Parameters<TxBuilder[\"spend\"]>;\ntype addRefInputArgs = Parameters<TxBuilder[\"refer\"]>;\n\ntype RedeemerArg = {\n    redeemer?: UplcData;\n};\n\nexport type TxDescriptionWithError = TxDescription<\n    any,\n    \"built\",\n    any,\n    {\n        error: string;\n    }\n>;\n\n/**\n * @public\n */\nexport type SubmitOptions = TxPipelineOptions & {\n    /**\n     * indicates additional signers expected for the transaction\n     */\n    signers?: Address[];\n    addlTxInfo?: Partial<\n        Omit<TxDescription<any, \"submitted\">, \"description\">\n    > & { description: string };\n    paramsOverride?: Partial<NetworkParams>;\n    /**\n     * useful most for test environment, so that a txn failure can be me marked\n     * as \"failing as expected\".  Not normally needed for production code.\n     */\n    expectError?: true;\n    /**\n     * Called when there is a detected error, before logging.  Probably only needed in test.\n     */\n    beforeError?: MultiTxnCallback<any, TxDescriptionWithError>;\n    /**\n     * Passed into the Helios TxBuilder's build()/buildUnsafe()\n     */\n    beforeValidate?: (tx: Tx) => MultiTxnCallback<any>;\n};\n\ntype MintUnsafeParams = Parameters<TxBuilder[\"mintPolicyTokensUnsafe\"]>;\ntype MintTokensParams = [\n    MintUnsafeParams[0],\n    MintUnsafeParams[1],\n    { redeemer: MintUnsafeParams[2] }\n];\n/**\n * Provides notifications for various stages of transaction submission\n */\ntype TxPipelineOptions = Expand<\n    TxSubmitCallbacks & {\n        fixupBeforeSubmit?: MultiTxnCallback;\n        whenBuilt?: MultiTxnCallback<any, TxDescription<any, \"built\">>;\n    }\n>;\n\nexport type TxSubmitCallbacks = {\n    onSubmitError?: MultiTxnCallback<\n        any,\n        TxDescription<any, \"built\", any, { error: string }>\n    >;\n    onSubmitted?: MultiTxnCallback<any, TxDescription<any, \"submitted\">>;\n};\n\ntype BuiltTcx = {\n    tx: Tx;\n} & BuiltTcxStats;\n\ntype BuiltTcxStats = {\n    willSign: PubKeyHash[];\n    walletMustSign: boolean;\n    wallet: Wallet;\n    wHelper: WalletHelper<any>;\n    costs: {\n        total: Cost;\n        [key: string]: Cost;\n    };\n};\n\nexport type FacadeTxnContext<S extends anyState = anyState> = hasAddlTxns<\n    StellarTxnContext<S>\n> & {\n    isFacade: true;\n};\n\n/**\n * Transaction-building context for Stellar Contract transactions\n * @remarks\n *\n * Uses same essential facade as Helios Tx.\n *\n * Adds a transaction-state container with strong typing of its contents,\n * enabling transaction-building code to use type-sensitive auto-complete\n * and allowing Stellar Contracts library code to require transaction contexts\n * having known states.\n *\n * Retains reflection capabilities to allow utxo-finding utilities to exclude\n * utxo's already included in the contract.\n *\n * @typeParam S - type of the context's `state` prop\n * @public\n **/\nexport class StellarTxnContext<S extends anyState = anyState> {\n    id: string = nanoid(5);\n    inputs: TxInput[] = [];\n    collateral?: TxInput;\n    outputs: TxOutput[] = [];\n    feeLimit?: bigint;\n    state: S;\n    allNeededWitnesses: (Address | PubKeyHash)[] = [];\n    otherPartySigners: PubKeyHash[] = [];\n    parentTcx?: StellarTxnContext<any>;\n    childReservedUtxos: TxInput[] = [];\n    parentId: string = \"\";\n    alreadyPresent: TxNotNeededError | undefined = undefined;\n    depth = 0;\n    declare setup: SetupInfo;\n    // submitOptions?: SubmitOptions\n    txb: TxBuilder;\n    txnName: string = \"\";\n    withName(name: string) {\n        this.txnName = name;\n        return this;\n    }\n\n    get wallet() {\n        return this.setup.actorContext.wallet!;\n    }\n\n    get uh(): UtxoHelper {\n        return this.setup.uh!;\n    }\n\n    get networkParams(): NetworkParams {\n        return this.setup.networkParams;\n    }\n\n    get actorContext(): ActorContext<any> {\n        return this.setup.actorContext;\n    }\n    /**\n     * Provides a lightweight, NOT complete, serialization for presenting the transaction context\n     * @remarks\n     * Serves rendering of the transaction context in vitest\n     * @internal\n     */\n    toJSON() {\n        return {\n            kind: \"StellarTxnContext\",\n            state: !!this.state\n                ? `{${Object.keys(this.state).join(\", \")}}`\n                : undefined,\n            inputs: `[${this.inputs.length} inputs]`,\n            outputs: `[${this.outputs.length} outputs]`,\n            isBuilt: !!this._builtTx,\n            hasParent: !!this.parentTcx,\n            //@ts-expect-error\n            addlTxns: this.state.addlTxns\n                ? [\n                      //@ts-expect-error\n                      ...Object.keys(this.state.addlTxns || {}),\n                  ]\n                : undefined,\n        };\n    }\n\n    logger = new UplcConsoleLogger();\n    constructor(\n        setup: SetupInfo,\n        state: Partial<S> = {},\n        parentTcx?: StellarTxnContext<any>\n    ) {\n        if (parentTcx) {\n            console.warn(\n                \"Deprecated use of 'parentTcx' - use includeAddlTxn() instead\" +\n                    \"\\n  ... setup.txBatcher.current holds an in-progress utxo set for all 'parent' transactions\"\n            );\n            throw new Error(`parentTcx used where? `);\n        }\n        Object.defineProperty(this, \"setup\", {\n            enumerable: false,\n            value: setup,\n        });\n        Object.defineProperty(this, \"_builtTx\", {\n            enumerable: false,\n            writable: true,\n        });\n\n        const isMainnet = setup.isMainnet;\n        this.isFacade = undefined;\n\n        if (\"undefined\" == typeof isMainnet) {\n            throw new Error(\n                \"StellarTxnContext: setup.isMainnet must be defined\"\n            );\n        }\n        this.txb = makeTxBuilder({\n            isMainnet,\n        });\n        // const { uuts = { ...emptyUuts }, ...moreState } = state;\n        //@ts-expect-error\n        this.state = {\n            ...state,\n            uuts: state.uuts || { ...emptyUuts },\n        };\n\n        const currentBatch = this.currentBatch;\n        const hasOpenBatch = currentBatch?.isOpen;\n        if (!currentBatch || currentBatch.isConfirmationComplete) {\n            this.setup.txBatcher.rotate(this.setup.chainBuilder);\n        }\n\n        if (!this.setup.isTest && !this.setup.chainBuilder) {\n            if (currentBatch.chainBuilder) {\n                // backfills the chainbuilder from the one auto-populated\n                // during `get TxBatcher.current()`\n                this.setup.chainBuilder = currentBatch.chainBuilder;\n            } else {\n                this.setup.chainBuilder = makeTxChainBuilder(\n                    this.setup.network\n                );\n            }\n        }\n\n        if (parentTcx) {\n            debugger;\n            throw new Error(`parentTcx used where? `);\n        }\n        this.parentTcx = parentTcx;\n    }\n\n    isFacade: true | false | undefined;\n    facade(this: StellarTxnContext): hasAddlTxns<this> & { isFacade: true } {\n        if (this.isFacade === false)\n            throw new Error(`this tcx already has txn material`);\n        if (this.parentTcx)\n            throw new Error(`no parentTcx allowed for tcx facade`);\n\n        const t: hasAddlTxns<this> = this as any;\n        t.state.addlTxns = t.state.addlTxns || {};\n        t.isFacade = true;\n        return this as any;\n    }\n    noFacade(situation: string) {\n        if (this.isFacade)\n            throw new Error(\n                `${situation}: ${\n                    this.txnName || \"this tcx\"\n                } is a facade for nested multi-tx`\n            );\n        this.isFacade = false;\n    }\n\n    withParent(tcx: StellarTxnContext<any>) {\n        this.noFacade(\"withParent\");\n        this.parentTcx = tcx;\n        return this;\n    }\n\n    get actorWallet() {\n        return this.actorContext.wallet;\n    }\n\n    dump(tx?: Tx): string;\n    dump(): Promise<string>;\n    dump(tx?: Tx): string | Promise<string> {\n        const t = tx || this.builtTx;\n        if (t instanceof Promise) {\n            return t.then((tx) => {\n                return txAsString(tx, this.setup.networkParams);\n            });\n        }\n        return txAsString(t, this.setup.networkParams);\n    }\n\n    includeAddlTxn<\n        TCX extends StellarTxnContext<anyState>,\n        RETURNS extends hasAddlTxns<TCX> = TCX extends hasAddlTxns<any>\n            ? TCX\n            : hasAddlTxns<TCX>\n    >(\n        this: TCX,\n        txnName: string,\n        txInfoIn: Omit<\n            TxDescription<any, \"buildLater!\">,\n            \"id\" | \"depth\" | \"parentId\"\n        > & {\n            id?: string;\n        }\n    ): RETURNS {\n        const txInfo: TxDescription<any, \"buildLater!\"> = {\n            ...(txInfoIn as any),\n        };\n        if (!txInfo.id)\n            txInfo.id =\n                //@ts-expect-error - the tcx is never there,\n                // but including the fallback assignment here for\n                // consistency about the policy of syncing to it.\n                txInfo.tcx?.id || nanoid(5);\n\n        txInfo.parentId = this.id;\n\n        txInfo.depth = (this.depth || 0) + 1;\n        const thisWithMoreType: RETURNS = this as any;\n        if (\"undefined\" == typeof this.isFacade) {\n            throw new Error(\n                `to include additional txns on a tcx with no txn details, call facade() first.\\n` +\n                    `   ... otherwise, add txn details first or set isFacade to false`\n            );\n        }\n        // if (thisWithMoreType.state.addlTxns?.[txnName]) {\n        //     debugger\n        //     throw new Error(\n        //         `addlTxns['${txnName}'] already included in this transaction:\\n` +\n        //             Object.keys(thisWithMoreType.state.addlTxns).map(\n        //                 (k) => ` • ${k}`\n        //             ).join(\"\\n\")\n        //     );\n        // }\n        thisWithMoreType.state.addlTxns = {\n            ...(thisWithMoreType.state.addlTxns || {}),\n            [txInfo.id]: txInfo,\n        };\n        return thisWithMoreType;\n    }\n\n    /**\n     * @public\n     */\n    get addlTxns(): Record<string, TxDescription<any, \"buildLater!\">> {\n        //@ts-expect-error\n        return this.state.addlTxns || {};\n    }\n\n    mintTokens(...args: MintTokensParams): StellarTxnContext<S> {\n        this.noFacade(\"mintTokens\");\n        const [policy, tokens, r = { redeemer: undefined }] = args;\n        const { redeemer } = r;\n        if (this.txb.mintPolicyTokensUnsafe) {\n            this.txb.mintPolicyTokensUnsafe(policy, tokens, redeemer);\n        } else {\n            //@ts-expect-error\n            this.txb.mintTokens(policy, tokens, redeemer);\n        }\n\n        return this;\n    }\n\n    getSeedAttrs<TCX extends hasSeedUtxo>(this: TCX): SeedAttrs {\n        this.noFacade(\"getSeedAttrs\");\n        // const { seedUtxo } = this.state;  // bad api-extractor!\n        const seedUtxo = this.state.seedUtxo;\n        // const { txId, utxoIdx: seedIndex } = seedUtxo.id; // ugh, api-extractor!\n        return { txId: seedUtxo.id.txId, idx: BigInt(seedUtxo.id.index) };\n    }\n\n    reservedUtxos(): TxInput[] {\n        this.noFacade(\"reservedUtxos\");\n        return this.parentTcx\n            ? this.parentTcx.reservedUtxos()\n            : ([\n                  ...this.inputs,\n                  this.collateral,\n                  ...this.childReservedUtxos,\n              ].filter((x) => !!x) as TxInput[]);\n    }\n\n    utxoNotReserved(u: TxInput): TxInput | undefined {\n        if (this.collateral?.isEqual(u)) return undefined;\n        if (this.inputs.find((i) => i.isEqual(u))) return undefined;\n        return u;\n    }\n\n    addUut<T extends string, TCX extends StellarTxnContext>(\n        this: TCX,\n        //!!! todo: type this more strongly by adding strong typing to the UutName itself?\n        uutName: UutName,\n        ...names: T[]\n    ): hasUutContext<T> & TCX {\n        this.noFacade(\"addUut\");\n        this.state.uuts = this.state.uuts || {};\n\n        for (const name of names) {\n            this.state.uuts[name] = uutName;\n        }\n\n        return this as hasUutContext<T> & TCX;\n    }\n\n    addState<TCX extends StellarTxnContext, K extends string, V>(\n        this: TCX,\n        key: K,\n        value: V\n    ): StellarTxnContext<{ [keyName in K]: V } & anyState> & TCX {\n        this.noFacade(\"addState\");\n        //@ts-expect-error\n        this.state[key] = value;\n        return this as StellarTxnContext<{ [keyName in K]: V } & anyState> &\n            TCX;\n    }\n\n    addCollateral(collateral: TxInput) {\n        this.noFacade(\"addCollateral\");\n        console.warn(\"explicit addCollateral() should be unnecessary unless a babel payer is covering it\")\n        \n        if (!collateral.value.assets.isZero()) {\n            throw new Error(\n                `invalid attempt to add non-pure-ADA utxo as collateral`\n            );\n        }\n        this.collateral = collateral;\n\n        this.txb.addCollateral(collateral);\n        return this;\n    }\n    getSeedUtxoDetails(this: hasSeedUtxo): SeedAttrs {\n        this.noFacade(\"getSeedUtxoDetails\");\n        const seedUtxo = this.state.seedUtxo;\n        return {\n            txId: seedUtxo.id.txId,\n            idx: BigInt(seedUtxo.id.index),\n        };\n    }\n\n    _txnTime?: Date;\n    /**\n     * Sets a future date for the transaction to be executed, returning the transaction context.  Call this before calling validFor().\n     *\n     * @remarks Returns the txn context.\n     * Throws an error if the transaction already has a txnTime set.\n     *\n     * This method does not itself set the txn's validity interval.  You MUST combine it with\n     * a call to validFor(), to set the txn's validity period.  The resulting transaction will\n     * be valid from the moment set here until the end of the validity period set by validFor().\n     *\n     * This can be used anytime to construct a transaction valid in the future.  This is particularly useful\n     * during test scenarios to verify time-sensitive behaviors.\n     *\n     * In the test environment, the network wil normally be advanced to this date\n     * before executing the transaction, unless a different execution time is indicated.\n     * Use the test helper's `submitTxnWithBlock(txn, {futureDate})` or `advanceNetworkTimeForTx()` methods, or args to\n     * use-case-specific functions that those methods.\n     */\n    futureDate<TCX extends StellarTxnContext<S>>(this: TCX, date: Date) {\n        this.noFacade(\"futureDate\");\n        if (this._txnTime) {\n            throw new Error(\n                \"txnTime already set; cannot set futureDate() after txnTime\"\n            );\n        }\n\n        const d = new Date(\n            Number(this.slotToTime(this.timeToSlot(BigInt(date.getTime()))))\n        );\n        // time emoji: ⏰\n        console.log(\"  ⏰⏰ setting txnTime to \", d.toString());\n        this._txnTime = d;\n        return this;\n    }\n\n    assertNumber(obj, msg = \"expected a number\") {\n        if (obj === undefined || obj === null) {\n            throw new Error(msg);\n        } else if (typeof obj == \"number\") {\n            return obj;\n        } else {\n            throw new Error(msg);\n        }\n    }\n\n    /**\n     * Calculates the time (in milliseconds in 01/01/1970) associated with a given slot number.\n     * @param slot - Slot number\n     */\n    slotToTime(slot: bigint): bigint {\n        let secondsPerSlot = this.assertNumber(\n            this.networkParams.secondsPerSlot\n        );\n\n        let lastSlot = BigInt(this.assertNumber(this.networkParams.refTipSlot));\n        let lastTime = BigInt(this.assertNumber(this.networkParams.refTipTime));\n\n        let slotDiff = slot - lastSlot;\n\n        return lastTime + slotDiff * BigInt(secondsPerSlot * 1000);\n    }\n\n    /**\n     * Calculates the slot number associated with a given time.\n     * @param time - Milliseconds since 1970\n     */\n    timeToSlot(time: bigint): bigint {\n        let secondsPerSlot = this.assertNumber(\n            this.networkParams.secondsPerSlot\n        );\n\n        let lastSlot = BigInt(this.assertNumber(this.networkParams.refTipSlot));\n        let lastTime = BigInt(this.assertNumber(this.networkParams.refTipTime));\n\n        let timeDiff = time - lastTime;\n\n        return (\n            lastSlot +\n            BigInt(Math.round(Number(timeDiff) / (1000 * secondsPerSlot)))\n        );\n    }\n\n    /**\n     * Identifies the time at which the current transaction is expected to be executed.\n     * Use this attribute in any transaction-building code that sets date/time values\n     * for the transaction.\n     * Honors any futureDate() setting or uses the current time if none has been set.\n     */\n    get txnTime() {\n        if (this._txnTime) return this._txnTime;\n        const now = Date.now();\n        const recent = now - 180_000;\n        const d = new Date(\n            Number(this.slotToTime(this.timeToSlot(BigInt(recent))))\n        );\n        // time emoji: ⏰\n        console.log(\"⏰⏰setting txnTime to \", d.toString());\n        return (this._txnTime = d);\n    }\n\n    _txnEndTime?: Date;\n    get txnEndTime() {\n        if (this._txnEndTime) return this._txnEndTime;\n        throw new Error(\"call [optional: futureDate() and] validFor(durationMs) before fetching the txnEndTime\")\n    }\n        \n   /**\n     * Sets an on-chain validity period for the transaction, in miilliseconds\n     *\n     * @remarks if futureDate() has been set on the transaction, that\n     * date will be used as the starting point for the validity period.\n     *\n     * Returns the transaction context for chaining.\n     *\n     * @param durationMs - the total validity duration for the transaction.  On-chain\n     *  checks using CapoCtx `now(granularity)` can enforce this duration\n     */\n    validFor<TCX extends StellarTxnContext<S>>(\n        this: TCX,\n        durationMs: number\n    ): TCX {\n        this.noFacade(\"validFor\");\n        const startMoment = this.txnTime.getTime();\n\n        // if the desired duration is greater  the current validity period,\n        //   DO NOT constraint the validity period further.\n        // If the current validity period is greater than the desired duration,\n        //   we SHOULD constrain the tx validity to this more restrictive duration.\n        this._validityPeriodSet = true;\n        this.txb\n            .validFromTime(new Date(startMoment))\n            .validToTime(new Date(startMoment + durationMs));\n\n        return this;\n    }\n    _validityPeriodSet = false;\n    txRefInputs: TxInput[] = [];\n    /**\n     * adds a reference input to the transaction context\n     * @remarks\n     *\n     * idempotent version of helios addRefInput()\n     *\n     * @public\n     **/\n    addRefInput<TCX extends StellarTxnContext<S>>(\n        this: TCX,\n        input: TxInput<any>,\n        refScript?: UplcProgramV2\n    ) {\n        this.noFacade(\"addRefInput\");\n        if (!input) throw new Error(`missing required input for addRefInput()`);\n\n        if (this.txRefInputs.find((v) => v.id.isEqual(input.id))) {\n            console.warn(\"suppressing second add of refInput\");\n            return this;\n        }\n        if (this.inputs.find((v) => v.id.isEqual(input.id))) {\n            console.warn(\n                \"suppressing add of refInput that is already an input\"\n            );\n            return this;\n        }\n        this.txRefInputs.push(input);\n\n        //@ts-expect-error private field\n        const v2sBefore = this.txb.v2Scripts;\n        if (refScript) {\n            //@ts-expect-error on private method\n            this.txb.addV2RefScript(refScript);\n        }\n\n        this.txb.refer(input);\n        //@ts-expect-error private field\n        const v2sAfter = this.txb.v2Scripts;\n\n        // const t2 = this.txb.witnesses.scripts.length;\n        // if (t2 > t) {\n        if (v2sAfter.length > v2sBefore.length) {\n            console.log(\"       --- addRefInput added a script to tx.scripts\");\n        }\n\n        return this;\n    }\n\n    /**\n     * @deprecated - use addRefInput() instead.\n     */\n    addRefInputs<TCX extends StellarTxnContext<S>>(\n        this: TCX,\n        ...args: addRefInputArgs\n    ) {\n        throw new Error(`deprecated`);\n    }\n\n    addInput<TCX extends StellarTxnContext<S>>(\n        this: TCX,\n        input: TxInput,\n        r?: isActivity\n    ): TCX {\n        this.noFacade(\"addInput\");\n        if (r && !r.redeemer) {\n            console.log(\"activity without redeemer tag: \", r);\n            throw new Error(\n                `addInput() redeemer must match the isActivity type {redeemer: ‹activity›}\\n`\n                // JSON.stringify(r, delegateLinkSerializer)\n            );\n        }\n\n        //@ts-expect-error probing for pubKeyHash\n        if (input.address.pubKeyHash)\n            this.allNeededWitnesses.push(input.address);\n        this.inputs.push(input);\n        if (this.parentTcx) {\n            this.parentTcx.childReservedUtxos.push(input);\n        }\n        try {\n            this.txb.spendUnsafe(input, r?.redeemer);\n        } catch (e: any) {\n            // console.log(\"failed adding input to txn: \", dumpAny(this));\n            debugger;\n            throw new Error(\n                `addInput: ${e.message}` +\n                    \"\\n   ...TODO: dump partial txn from txb above.  Failed TxInput:\\n\" +\n                    dumpAny(input)\n            );\n        }\n\n        return this;\n    }\n\n    addOutput<TCX extends StellarTxnContext<S>>(\n        this: TCX,\n        output: TxOutput\n    ): TCX {\n        this.noFacade(\"addOutput\");\n        try {\n            this.txb.addOutput(output);\n            this.outputs.push(output);\n        } catch (e: any) {\n            console.log(\n                \"Error adding output to txn: \\n\" +\n                    \"  | inputs:\\n  | \" +\n                    utxosAsString(this.inputs, \"\\n  | \") +\n                    \"\\n  | \" +\n                    (dumpAny(this.outputs) as string)\n                        .split(\"\\n\")\n                        .join(\"\\n  |   \") +\n                    \"\\n... in context of partial tx above: failed adding output: \\n  |  \",\n                dumpAny(output),\n                \"\\n\" + e.message,\n                \"\\n   (see thrown stack trace below)\"\n            );\n            e.message =\n                `addOutput: ${e.message}` + \"\\n   ...see logged details above\";\n            throw e;\n        }\n\n        return this;\n    }\n\n    attachScript(...args: Parameters<TxBuilder[\"attachUplcProgram\"]>) {\n        throw new Error(\n            `use addScriptProgram(), increasing the txn size, if you don't have a referenceScript.\\n` +\n                `Use <capo>.txnAttachScriptOrRefScript() to use a referenceScript when available.`\n        );\n    }\n\n    /**\n     * Adds a UPLC program to the transaction context, increasing the transaction size.\n     * @remarks\n     * Use the Capo's `txnAttachScriptOrRefScript()` method to use a referenceScript\n     * when available. That method uses a fallback approach adding the script to the\n     * transaction if needed.\n     */\n    addScriptProgram(...args: Parameters<TxBuilder[\"attachUplcProgram\"]>) {\n        this.noFacade(\"addScriptProgram\");\n        this.txb.attachUplcProgram(...args);\n\n        return this;\n    }\n\n    wasModified() {\n        //@ts-expect-error private method\n        this.txb.wasModified();\n    }\n\n    _builtTx?: Tx | Promise<Tx>;\n    get builtTx() {\n        this.noFacade(\"builtTx\");\n        if (!this._builtTx) {\n            throw new Error(`can't go building the tx willy-nilly`);\n            return (this._builtTx = this.build().then(({ tx }) => {\n                return (this._builtTx = tx);\n            }));\n        }\n        return this._builtTx;\n    }\n\n    async addSignature(wallet: Wallet) {\n        this.noFacade(\"addSignature\");\n        const builtTx = await this.builtTx;\n        const sig = await wallet.signTx(builtTx);\n\n        builtTx.addSignature(sig[0]);\n    }\n\n    hasAuthorityToken(authorityValue: Value) {\n        return this.inputs.some(i => i.value.isGreaterOrEqual(authorityValue))\n    }\n\n    async findAnySpareUtxos(): Promise<TxInput[] | never> {\n        this.noFacade(\"findAnySpareUtxos\");\n        const mightNeedFees = 3_500_000n; // lovelace this.ADA(3.5);\n\n        const toSortInfo = this.uh.mkUtxoSortInfo(mightNeedFees);\n        const notReserved =\n            this.utxoNotReserved.bind(this) || ((u: TxInput) => u);\n\n        const uh = this.uh;\n        return uh\n            .findActorUtxo(\n                \"spares for tx balancing\",\n                notReserved,\n                {\n                    wallet: this.wallet,\n                    dumpDetail: \"onFail\",\n                },\n                \"multiple\"\n            )\n            .then(async (utxos) => {\n                if (!utxos) {\n                    throw new Error(\n                        `no utxos found for spares for tx balancing.  We can ask the user to send a series of 10, 11, 12, ... ADA to themselves or do it automatically`\n                    );\n                }\n\n                const allSpares = utxos\n                    .map(toSortInfo)\n                    .filter(uh.utxoIsSufficient)\n                    .sort(uh.utxoSortSmallerAndPureADA);\n\n                if (allSpares.reduce(uh.reduceUtxosCountAdaOnly, 0) > 0) {\n                    return allSpares\n                        .filter(uh.utxoIsPureADA)\n                        .map(uh.sortInfoBackToUtxo);\n                }\n                return allSpares.map(uh.sortInfoBackToUtxo);\n            });\n    }\n\n    async findChangeAddr(): Promise<Address> {\n        this.noFacade(\"findChangeAddr\");\n        // const {\n        //     actorContext: { wallet },\n        // } = this; // ugh, api-extractor!\n        const wallet = this.actorContext.wallet;\n        if (!wallet) {\n            throw new Error(\n                `⚠️  ${this.constructor.name}: no this.actorContext.wallet; can't get required change address!`\n            );\n        }\n        let unused = (await wallet.unusedAddresses).at(0);\n        if (!unused) unused = (await wallet.usedAddresses).at(-1);\n        if (!unused)\n            throw new Error(\n                `⚠️  ${this.constructor.name}: can't find a good change address!`\n            );\n        return unused;\n    }\n\n    /**\n     * Adds required signers to the transaction context\n     * @remarks\n     * Before a transaction can be submitted, signatures from each of its signers must be included.\n     * \n     * Any inputs from the wallet are automatically added as signers, so addSigners() is not needed\n     * for those.\n     */\n    async addSigners(...signers: PubKeyHash[]) {\n        this.noFacade(\"addSigners\");\n        \n        this.allNeededWitnesses.push(...signers);\n    }\n\n    async build(\n        this: StellarTxnContext<any>,\n        {\n            signers = [],\n            addlTxInfo = {\n                description: this.txnName ? \": \" + this.txnName : \"\",\n            },\n            beforeValidate,\n            paramsOverride,\n            expectError,\n        }: {\n            signers?: Address[];\n            addlTxInfo?: Pick<TxDescription<any, \"buildLater!\">, \"description\">;\n            beforeValidate?: (tx: Tx) => Promise<any> | any;\n            paramsOverride?: Partial<NetworkParams>;\n            expectError?: boolean;\n        } = {}\n    ): Promise<BuiltTcx> {\n        this.noFacade(\"build\");\n        console.timeStamp?.(`submit() txn ${this.txnName}`);\n        console.log(\"tcx build() @top\");\n\n        if (!this._validityPeriodSet) {\n            this.validFor(12 * 60 * 1000); // 12 minutes\n            // this.validFor(12 * 60 * 1000 * 60 * 24); // 12 days\n        }\n        let { description } = addlTxInfo;\n        if (description && !description.match(/^:/)) {\n            description = \": \" + description;\n        }\n        const {\n            actorContext: { wallet },\n        } = this;\n\n        let walletMustSign = false;\n        let tx: Tx;\n\n        const logger = this.logger;\n        if (wallet || signers.length) {\n            console.timeStamp?.(`submit(): findChangeAddr()`);\n            const changeAddress = await this.findChangeAddr();\n\n            console.timeStamp?.(`submit(): findAnySpareUtxos()`);\n            const spares = await this.findAnySpareUtxos();\n\n            const willSign = [...signers, ...this.allNeededWitnesses]\n                .map((addrOrPkh) => {\n                    if (addrOrPkh.kind == \"PubKeyHash\") {\n                        return addrOrPkh;\n                    } else if (addrOrPkh.kind == \"Address\") {\n                        if (addrOrPkh.era == \"Shelley\") {\n                            return addrOrPkh.spendingCredential.kind == \"PubKeyHash\"\n                                ? addrOrPkh.spendingCredential\n                                : undefined;\n                        } else {\n                            return undefined;\n                        }\n                    } else {\n                        return undefined;\n                    }\n                })\n                .filter((pkh) => !!pkh)\n                .flat(1) as PubKeyHash[];\n            console.timeStamp?.(`submit(): addSIgners()`);\n            this.txb.addSigners(...willSign);\n            const wHelper = wallet && makeWalletHelper(wallet);\n            const othersMustSign: PubKeyHash[] = [];\n            // determine whether we need to request signing from wallet.\n            // may involve adding signers to the txn\n            if (wallet && wHelper) {\n                for (const a of willSign) {\n                    if (await wHelper.isOwnAddress(a)) {\n                        walletMustSign = true;\n                    } else {\n                        othersMustSign.push(a);\n                    }\n                }\n                this.otherPartySigners = othersMustSign;\n                // if any inputs from the wallet were added as part of finalizing,\n                // add the wallet's signature to the txn\n                const inputs = this.txb.inputs;\n                if (!inputs) throw new Error(`no inputs in txn`);\n                for (const input of inputs) {\n                    if (!(await wHelper.isOwnAddress(input.address))) continue;\n                    this.allNeededWitnesses.push(input.address);\n                    walletMustSign = true;\n\n                    //@ts-expect-error on type-probe\n                    const pubKeyHash = input.address.pubKeyHash;\n\n                    if (pubKeyHash) {\n                        this.txb.addSigners(pubKeyHash);\n                    } else {\n                        //!!! todo: deal with \"native-script\" by traversing its\n                        //  struct and seeking the pubKeyHashes (or? other witnesses)\n                        //  that may be needed for signing.  That, or include the\n                        //  native-script information alongside the otherPartySigners,\n                        //  maybe as otherPartyScriptSigners or something.  The\n                        //  batch-submit-controller could take over the responsibility\n                        //  for finding signatures satisfactory for those.\n                    }\n                }\n            } else {\n                console.warn(\n                    \"txn build: no wallet/helper available for txn signining (debugging breakpoint available)\"\n                );\n                debugger; // eslint-disable-line no-debugger - keep for downstream troubleshooting\n            }\n            let capturedCosts: {\n                total: Cost;\n                [key: string]: Cost;\n            } = {\n                total: { cpu: 0n, mem: 0n },\n                slush: { cpu: 0n, mem: 0n },\n            };\n\n            const inputValues = this.inputs\n                .map((i) => i.value.assets)\n                .reduce((a, b) => a.add(b), makeAssets());\n            const outputValues = this.outputs\n                .map((o) => o.value.assets)\n                .reduce((a, b) => a.add(b), makeAssets());\n            const mintValues = this.txb.mintedTokens;\n            const netTxAssets = inputValues\n                .add(mintValues)\n                .subtract(outputValues);\n            if (!netTxAssets.isZero()) {\n                console.log(\n                    \"tx imbalance=\" + dumpAny(netTxAssets, this.networkParams)\n                );\n            }\n            try {\n                // the transaction can fail validation without throwing an error\n                tx = await this.txb.buildUnsafe({\n                    changeAddress,\n                    spareUtxos: spares,\n                    networkParams: {\n                        ...this.networkParams,\n                        ...paramsOverride,\n                    },\n                    logOptions: logger,\n                    beforeValidate,\n                    modifyExBudget: (txi, purpose, index, costs) => {\n                        capturedCosts[`${purpose} @${1 + index}`] = {\n                            ...costs,\n                        };\n\n                        // todo: use Ogmios API to just get the exact costs\n                        //   ... and report here when there is a diff.\n                        // Meanwhile, add a small amount (0.05 ADA) of padding\n                        //   ... to the computed costs, per involved script\n\n                        // temp? - + ~0.06 ada = 1.2x 0.05\n                        // const cpuSlush = 0n // BigInt(350_000_000n); // ~25k lovelace\n                        // const memSlush = 0n // BigInt(430_000n); // ~25k lovelace\n\n                        // without this, we **sometimes** get problems having enough\n                        // exBudget to cover the way the haskell node computes the\n                        // per-script execution costs.  Prevents \"out of budget\" errors\n                        // during script execution:\n                        const cpuSlush = BigInt(350_000_000n); // ~25k lovelace\n                        const memSlush = BigInt(430_000n); // ~25k lovelace\n\n                        //... but doesn't suffice to just add per-script slush:\n                        // this approach leads to escalating \"expected/actual fee\" messaging\n                        // const cpuSlush = BigInt( 350_000_000n * 13n / 10n); // ~25k lovelace/0.025 ADA\n                        // const memSlush = BigInt(430_000n * 13n / 10n); // ~25k lovelace/0.025 ADA\n\n                        capturedCosts.slush.cpu += cpuSlush;\n                        capturedCosts.slush.mem += memSlush;\n                        costs.cpu += cpuSlush;\n                        costs.mem += memSlush;\n\n                        capturedCosts.total.cpu += costs.cpu;\n                        capturedCosts.total.mem += costs.mem;\n                        if (\"minting\" == purpose) purpose = \"minting \";\n                        return costs;\n                    },\n                });\n                this._builtTx = tx;\n\n                this.txb.validToTime;\n\n                //!!! todo: come back to this later.  Blockfrost's endpoint for this\n                // seems to have some issues.  Ogmios itself seems to be fine.\n                //\n                // //@ts-expect-error on type-probe\n                // if (this.setup.network.evalTx) {\n                //     const partialTx = undoFeesFrom(tx)\n                //     console.log(bytesToHex(partialTx.toCbor()))\n                //     //@ts-expect-error on type-probe\n                //     const evalResult = await this.setup.network.evalTx(\n                //         partialTx\n                //     );\n                //     debugger\n                // }\n            } catch (e: any) {\n                // buildUnsafe shouldn't throw errors.\n\n                e.message +=\n                    \"; txn build failed (debugging breakpoint available)\\n\" +\n                    (netTxAssets.isZero()\n                        ? \"\"\n                        : \"tx imbalance=\" +\n                          dumpAny(netTxAssets, this.networkParams)) +\n                    `  inputs: ${dumpAny(this.inputs)}\\n` +\n                    `  outputs: ${dumpAny(this.outputs)}\\n` +\n                    `  mint: ${dumpAny(this.txb.mintedTokens)}\\n` +\n                    `  refInputs: ${dumpAny(this.txRefInputs)}\\n`;\n\n                logger.logError(`txn build failed: ${e.message}`);\n                if (tx!) logger.logPrint(dumpAny(tx!) as string);\n\n                logger.logError(\n                    `  (it shouldn't be possible for buildUnsafe to be throwing errors!)`\n                );\n                logger.flushError();\n\n                throw e;\n            }\n\n            if (tx.hasValidationError) {\n                const e = tx.hasValidationError;\n\n                //@ts-expect-error accessing the stack of something that might be a string instead\n                let heliosStack = e.stack?.split(\"\\n\") || undefined;\n                // locate the first TxImpl line in the stack trace.\n                // include it but remove remaining trace lines.\n                // heliosStack = heliosStack?.slice(\n                //     0, heliosStack.findIndex(l => l.match(/TxImpl/)) + 2\n                // ) || \"\"\n                // locate any lines like \"<helios>@at <anonymous>, [mkTv=<fn>, tvCharter=<fn>, mustFindInputRedeemer=<fn>, fromCip68Wrapper=<fn>, RelativeDelegateLink::tvAuthorityToken=<fn>, RelativeDelegateLink::acAuthorityToken=<fn>, RelativeDelegateLink::validatesUpdatedSettings=<fn>, RelativeDelegateLink::hasDelegateInput=<fn>, RelativeDelegateLink::hasValidOutput=<fn>, DelegateInput::genericDelegateActivity=<fn>], src/CapoHelpers.hl:761:9:0\"\n                // and transform it to a multi-line, indented function trace with the\n                // square-bracketed items indented to indicate the scope of the function they're provided to\n                heliosStack = heliosStack?.map((line: string) => {\n                    if (line.match(/<helios>@at/)) {\n                        line = line\n                            .replace(\n                                /<helios>@at /,\n                                \"   ... in helios function \"\n                            )\n                            .replace(\n                                /, \\[(.*)\\],/,\n                                (_, bracketed) => ``\n                                // ` with scope [\\n        ${\n                                //     bracketed.replace(/, /g, \",\\n        \")\n                                // }\\n      ]`\n                            );\n                    }\n                    return line;\n                });\n                debugger; // eslint-disable-line no-debugger - keep for downstream troubleshooting\n                const scriptContext =\n                    \"string\" == typeof e ? undefined : e.scriptContext;\n                logger.logError(\n                    `tx validation failure: \\n  ❌ ${\n                        //@ts-expect-error\n                        tx.hasValidationError.message || tx.hasValidationError\n                    }\\n` + (heliosStack?.join(\"\\n\") || \"\")\n                );\n                logger.flush();\n                // TODO: notify the currentBatch and let it reveal the script-context\n                // and tx-cbor.  KEEP THE console LOGGING for now ALSO.\n\n                const ctxCbor = scriptContext?.toCbor();\n                const cborHex = ctxCbor ? bytesToHex(ctxCbor) : \"\";\n                if (!expectError) {\n                    console.log(\n                        cborHex\n                            ? \"------------------- failed ScriptContext as cbor-hex -------------------\\n\" +\n                                  cborHex +\n                                  \"\\n\"\n                            : \"\",\n                        \"------------------- failed tx as cbor-hex -------------------\\n\" +\n                            bytesToHex(tx.toCbor()),\n                        \"\\n------------------^ failed tx details ^------------------\\n\" +\n                            \"(debugging breakpoint available)\"\n                    );\n                }\n            }\n\n            // tx.body.fee = tx.body.fee + BigInt(250_000n); // 25k lovelace\n            return {\n                tx,\n                willSign,\n                walletMustSign,\n                wallet,\n                wHelper,\n                costs: capturedCosts,\n            };\n        } else {\n            throw new Error(\"no 'actorContext.wallet'; can't make  a txn\");\n        }\n    }\n    log(...msgs: string[]) {\n        if (msgs.length > 1) {\n            debugger;\n            throw new Error(`no multi-arg log() calls`);\n        }\n        this.logger.logPrint(msgs[0]);\n        return this;\n    }\n    flush() {\n        this.logger.flush();\n        return this;\n    }\n    finish() {\n        this.logger.finish();\n        return this;\n    }\n\n    /**\n     * Submits the current transaction and any additional transactions in the context.\n     * @remarks\n     * To submit only the current transaction, use the `submit()` method.\n     *\n     * Uses the TxBatcher to create a new batch of transactions.  This new batch\n     * overlays a TxChainBuilder on the current network-client, using that facade\n     * to provide utxos for chained transactions in the batch.\n     *\n     * The signers array can be used to add additional signers to the transaction, and\n     * is passed through to the submit() for the current txn only; it is not used for\n     * any additional transactions.\n     *\n     * The beforeSubmit, onSubmitted callbacks are used for each additional transaction.\n     *\n     * beforeSubmit can be used to notify the user of the transaction about to be submitted,\n     * and can also be used to add additional signers to the transaction or otherwise modify\n     * it (by returning the modified transaction).\n     *\n     * onSubmitted can be used to notify the user that the transaction has been submitted,\n     * or for logging or any other post-submission processing.\n     */\n    async submitAll(this: StellarTxnContext<any>, options: SubmitOptions = {}) {\n        const currentBatch = this.currentBatch;\n        const hasOpenBatch = currentBatch?.isOpen;\n        // if (hasOpenBatch) {\n        //     console.warn(\n        //         `⚠️  submitAll(): detected overlapping txn batches... \\n` +\n        //             `  ... that MIGHT be a developer error on our part.\\n` +\n        //             `  ... or, you might need to add your transaction to an existing batch \\n` +\n        //             `      (use otherTcx.includeAddlTxn(...))\\n` +\n        //             `  ... or, you might need to ensure you're waiting for an existing batch \\n` +\n        //             `      to finish (monitor setup.txBatcher.current for batch:confirmed)\\n` +\n        //             `\\nFinally, you might have an advanced use-case for building multiple \\n` +\n        //             `independent batches of transactions that don't need tx chaining between them. \\n\\n` +\n        //             `Please be welcome to log an issue with the project's support desk, \\n` +\n        //             `... and we'll see what we can do to help.`\n        //         );\n        //     throw new Error(`can't submitAll() with an existing open tx batch (wait for the existing batch to finish first`);\n        // }\n\n        //!!! remove because it's already done in the constructor?\n        // debugger\n        // if (!currentBatch || currentBatch.isConfirmationComplete) {\n        //     this.setup.txBatcher.rotate(this.setup.chainBuilder);\n        // }\n\n        // if (!this.setup.isTest && !this.setup.chainBuilder) {\n        //     if (currentBatch.chainBuilder) {\n        //         // backfills the chainbuilder from the one auto-populated\n        //         // during `get TxBatcher.current()`\n        //         this.setup.chainBuilder = currentBatch.chainBuilder;\n        //     } else {\n        //         this.setup.chainBuilder = makeTxChainBuilder(\n        //             this.setup.network\n        //         );\n        //     }\n        // }\n        //!!! ^^^ remove?\n\n        return this.buildAndQueueAll(options).then((batch) => {\n            return batch;\n            //            return currentBatch.$signAndSubmitAll().then(() => true);\n        });\n    }\n\n    /**\n     * augments a transaction context with a type indicator\n     * that it has additional transactions to be submitted.\n     * @public\n     * @remarks\n     * The optional argument can also be used to include additional\n     * transactions to be chained after the current transaction.\n     */\n    withAddlTxns<TCX extends StellarTxnContext<anyState>>(\n        this: TCX,\n        addlTxns: Record<string, TxDescription<any, \"buildLater!\">> = {}\n    ): hasAddlTxns<TCX> {\n        //@ts-expect-error\n        this.state.addlTxns = this.state.addlTxns || {};\n\n        for (const [name, txn] of Object.entries(addlTxns)) {\n            this.includeAddlTxn(name, txn);\n        }\n        return this as any;\n    }\n\n    async buildAndQueueAll(\n        this: StellarTxnContext<any>,\n        options: SubmitOptions = {}\n    ) {\n        const {\n            addlTxInfo = {\n                description: this.txnName\n                    ? this.txnName\n                    : \"‹unnamed tx›\",\n                id: this.id,\n                tcx: this,\n            },\n            ...generalSubmitOptions\n        } = options;\n        if (options.paramsOverride) {\n            console.warn(\n                \"⚠️  paramsOverride can be useful for extreme cases \\n\" +\n                    \"of troubleshooting tx execution by submitting an oversized tx \\n\" +\n                    \"with unoptimized contract scripts having diagnostic print/trace calls\\n\" +\n                    \"to a custom preprod node having overloaded network params, thus allowing \\n\" +\n                    \"such a transaction to be evaluated end-to-end by the Haskell evaluator using \\n\" +\n                    \"the cardano-node's script-budgeting mini-protocol.\\n\\n\" +\n                    \"This will cause problems for regular transactions (such as requiring very large collateral)\" +\n                    \"Be sure to remove any params override if you're not dealing with \\n\" +\n                    \"one of those very special situations. \\n\"\n            );\n            debugger;\n        }\n\n        if (this.isFacade == false) {\n            return this.buildAndQueue({\n                ...generalSubmitOptions,\n                addlTxInfo,\n            }).then(() => {\n                if (this.state.addlTxns) {\n                    // this gives early registration of nested txns from top-level txns\n                    console.log(\n                        `🎄⛄🎁 ${this.id}   -- B&QA - registering addl txns`\n                    );\n                    return this.queueAddlTxns(options).then(() => {\n                        return this.currentBatch;\n                    });\n\n                    // .then((x) => {\n                    //     return this.currentBatch.$signAndSubmitAll()\n                    //     // this.setup.chainBuilder = undefined;\n                    //     // return x;\n                    // });\n                }\n                return this.currentBatch\n            });\n        } else if (this.state.addlTxns) {\n            if (this.isFacade) {\n                this.currentBatch.$txInfo(this.id)?.transition(\"isFacade\");\n            }\n\n            // this gives early registration of nested txns from top-level txns\n            console.log(\n                `🎄⛄🎁 ${this.id}   -- B&QA - registering txns in facade`\n            );\n            return this.queueAddlTxns(generalSubmitOptions).then(() => {\n                return this.currentBatch;\n            });\n        }\n        console.warn(`⚠️  submitAll(): no txns to queue/submit`, this);\n        throw new Error(\n            `unreachable? -- nothing to do for submitting this tcx`\n        );\n    }\n\n    get currentBatch() {\n        return this.setup.txBatcher.current;\n    }\n\n    /**\n     * Submits only the current transaction.\n     * @remarks\n     * To also submit additional transactions, use the `submitAll()` method.\n     */\n    async buildAndQueue(\n        this: StellarTxnContext<any>,\n        submitOptions: SubmitOptions = {}\n    ) {\n        let {\n            signers = [],\n            addlTxInfo,\n            paramsOverride,\n            expectError,\n            beforeError,\n            beforeValidate,\n            whenBuilt,\n            fixupBeforeSubmit,\n            onSubmitError,\n            onSubmitted,\n        } = submitOptions;\n\n        // console.log(\"buildAndQueue with setup\", this.setup);\n        this.noFacade(\"submit\");\n        if (!addlTxInfo) {\n            debugger;\n            throw new Error(`expecting addlTxInfo to be passed`);\n            addlTxInfo = {\n                description: this.txnName\n                    ? \": \" + this.txnName\n                    : \"‹unnamed tx›\",\n                id: nanoid(5),\n                tcx: this,\n            };\n        }\n        const {\n            logger,\n            setup: { network },\n        } = this;\n        const {\n            tx,\n            willSign,\n            walletMustSign,\n            wallet,\n            wHelper,\n            costs = {\n                total: { cpu: 0n, mem: 0n },\n            },\n        } = await this.build({\n            signers,\n            paramsOverride,\n            addlTxInfo,\n            beforeValidate,\n            expectError,\n        });\n        let { description, id } = addlTxInfo;\n        if (!id) {\n            id = addlTxInfo.id = this.id;\n        }\n        const addlTxInfo2: TxDescription<any, \"buildLater!\"> = {\n            ...addlTxInfo,\n        } as any;\n\n        const txStats = {\n            costs: costs,\n            wallet: wallet,\n            walletMustSign,\n            wHelper,\n            willSign,\n        };\n        const errMsg =\n            tx.hasValidationError && tx.hasValidationError.toString();\n        if (errMsg) {\n            // console.log(`submit(): FAILED tx.validate(): ${errMsg}`);\n            // console.profileEnd?.(\"tx.validate()\");\n            // @ts-ignore\n            // if (console.profileEnd) {\n            //     debugger;\n            // }\n\n            logger.logPrint(`⚠️  txn validation failed: ${errMsg}\\n`);\n            logger.logPrint(this.dump(tx));\n            this.emitCostDetails(tx, costs);\n            logger.flush();\n            logger.logError(`FAILED submitting tx: ${description}`);\n            logger.logPrint(errMsg);\n            if (expectError) {\n                logger.logPrint(\n                    `\\n\\n💣🎉 💣🎉 🎉 🎉 transaction failed (as expected)`\n                );\n            }\n\n            const txErrorDescription: TxDescriptionWithError = {\n                ...addlTxInfo2,\n                tcx: this,\n                error: errMsg,\n                tx,\n                stats: txStats,\n                options: submitOptions,\n                txCborHex: bytesToHex(tx.toCbor()),\n            };\n            this.currentBatch.txError(txErrorDescription);\n\n            let errorHandled;\n            if (beforeError) {\n                errorHandled = await beforeError(txErrorDescription);\n            }\n            logger.flushError();\n            if (\n                errMsg.match(\n                    /multi:Minting: only dgData activities ok in mintDgt/\n                )\n            ) {\n                console.log(\n                    `⚠️  mint delegate for multiple activities should be given delegated-data activities, not the activities of the delegate`\n                );\n            }\n            if (!errorHandled) {\n                debugger;\n                throw new Error(errMsg);\n            }\n        }\n        // const elapsed = t2 - t1;\n        // console.log(\n        //     // stopwatch emoji: ⏱\n        //     `          :::::::::: ⏱ tx validation time: ${elapsed}ms ⏱`\n        // );\n        // result: validations for non-trivial txns can take ~800+ ms\n        //  - validations with simplify:true, ~250ms - but ...`\n        //    ... with elided error messages that don't support negative-testing very well\n        for (const pkh of willSign) {\n            if (!pkh) continue;\n            if (tx.body.signers.find((s) => pkh.isEqual(s))) continue;\n            throw new Error(\n                `incontheeivable! all signers should have been added to the builder above`\n            );\n        }\n\n        const txDescr: TxDescription<any, \"built\"> = {\n            ...addlTxInfo2,\n            tcx: this,\n            tx,\n            txId: tx.id(),\n            options: submitOptions,\n            stats: txStats,\n            txCborHex: bytesToHex(tx.toCbor()),\n        };\n        const { currentBatch } = this;\n        const txState = currentBatch.$txStates[id];\n\n        logger.logPrint(`tx transcript: ${description}\\n`);\n        logger.logPrint(this.dump(tx));\n        this.emitCostDetails(tx, costs);\n        logger.flush();\n\n        // hands off wallet signing & tx-completion to the batcher.\n        console.timeStamp?.(`tx: add to current-tx-batch`);\n        currentBatch.$addTxns(txDescr);\n        this.setup.chainBuilder?.with(txDescr.tx);\n        await whenBuilt?.(txDescr);\n    }\n    emitCostDetails(tx: Tx, costs: { total: Cost; [key: string]: Cost }) {\n        const { logger } = this;\n        const {\n            maxTxExCpu,\n            maxTxExMem,\n            maxTxSize,\n            //@ts-expect-error on our synthetic attributes\n            origMaxTxSize = maxTxSize,\n            //@ts-expect-error on our synthetic attributes\n            origMaxTxExMem = maxTxExMem,\n            //@ts-expect-error on our synthetic attributes\n            origMaxTxExCpu = maxTxExCpu,\n            exCpuFeePerUnit,\n            exMemFeePerUnit,\n            txFeePerByte,\n            txFeeFixed,\n        } = this.networkParams;\n        const oMaxSize: number = origMaxTxSize;\n        const oMaxMem: number = origMaxTxExMem;\n        const oMaxCpu: number = origMaxTxExCpu;\n\n        const { total, ...otherCosts } = costs;\n        const txSize = tx.calcSize();\n        const txFeeCalc = Number(tx.calcMinFee(this.networkParams));\n        const txFee = tx.body.fee;\n\n        const cpuFee = BigInt((Number(total.cpu) * exCpuFeePerUnit).toFixed(0));\n        const memFee = BigInt((Number(total.mem) * exMemFeePerUnit).toFixed(0));\n        const sizeFee = BigInt(txSize * txFeePerByte);\n        const nCpu = Number(total.cpu);\n        const nMem = Number(total.mem);\n        let refScriptSize = 0;\n        for (const anyInput of [...tx.body.inputs, ...tx.body.refInputs]) {\n            const refScript = anyInput.output.refScript;\n            if (refScript) {\n                const scriptSize = refScript.toCbor().length;\n                refScriptSize += scriptSize;\n            }\n        }\n        let multiplier = 1.0;\n        let refScriptsFee = 0n;\n        let refScriptsFeePerByte = this.networkParams.refScriptsFeePerByte;\n        let refScriptCostDetails: string[] = [];\n        const tierSize = 25600;\n        let alreadyConsumed = 0;\n        for (\n            let tier = 0;\n            tier * tierSize < refScriptSize;\n            tier += 1, multiplier *= 1.2\n        ) {\n            const topOfThisTier = (1 + tier) * tierSize;\n            const consumedThisTier = Math.min(\n                tierSize,\n                refScriptSize - alreadyConsumed\n            );\n            alreadyConsumed += consumedThisTier;\n            const feeThisTier = Math.round(\n                consumedThisTier * multiplier * refScriptsFeePerByte\n            );\n            refScriptsFee += BigInt(feeThisTier);\n            refScriptCostDetails.push(\n                `\\n      -- refScript tier${\n                    1 + tier\n                } (${consumedThisTier} × ${multiplier}) ×${refScriptsFeePerByte} = ${lovelaceToAda(\n                    feeThisTier\n                )}`\n            );\n        }\n\n        // for (let i = 0; i < refScriptSize; i += 25600, multiplier *= 1.2) {\n        //     const chunkSize = Math.min(25600, refScriptSize - i)\n        //     const feeThisChunk = chunkSize * multiplier * refScriptsFeePerByte\n        //     refScriptsFee += BigInt(feeThisChunk)\n        //     refScriptCostDetails.push(\n        //         `\\n      -- refScript tier${i} (${chunkSize} bytes) × ${multiplier} = ${lovelaceToAda(feeThisChunk)}`\n        //     )\n        // }\n        const fixedTxFeeBigInt = BigInt(txFeeFixed);\n\n        const remainderUnaccounted =\n            txFee -\n            cpuFee -\n            memFee -\n            sizeFee -\n            fixedTxFeeBigInt -\n            refScriptsFee;\n\n        if (nCpu > oMaxCpu || nMem > oMaxMem || txSize > oMaxSize) {\n            logger.logPrint(\n                \"🔥🔥🔥🔥  THIS TX EXCEEDS default (overridden in test env) limits on network params  🔥🔥🔥🔥\\n\" +\n                    `  -- cpu ${intWithGrouping(nCpu)} = ${(\n                        (100 * nCpu) /\n                        oMaxCpu\n                    ).toFixed(1)}% of ${intWithGrouping(\n                        oMaxCpu\n                    )} (patched to ${intWithGrouping(maxTxExCpu)})\\n` +\n                    `  -- mem ${nMem} = ${((100 * nMem) / oMaxMem).toFixed(\n                        1\n                    )}% of ${intWithGrouping(\n                        oMaxMem\n                    )} (patched to ${intWithGrouping(maxTxExMem)})\\n` +\n                    `  -- tx size ${intWithGrouping(txSize)} = ${(\n                        (100 * txSize) /\n                        oMaxSize\n                    ).toFixed(1)}% of ${intWithGrouping(\n                        oMaxSize\n                    )} (patched to ${intWithGrouping(maxTxSize)})\\n`\n            );\n        }\n        const scriptBreakdown =\n            Object.keys(otherCosts).length > 0\n                ? `\\n    -- per script (with % blame for actual costs):` +\n                  Object.entries(otherCosts)\n                      .map(\n                          ([key, { cpu, mem }]) =>\n                              `\\n      -- ${key}: cpu ${lovelaceToAda(\n                                  Number(cpu) * exCpuFeePerUnit\n                              )} = ${(\n                                  (Number(cpu) / Number(total.cpu)) *\n                                  100\n                              ).toFixed(1)}%, mem ${lovelaceToAda(\n                                  Number(mem) * exMemFeePerUnit\n                              )} = ${(\n                                  (Number(mem) / Number(total.mem)) *\n                                  100\n                              ).toFixed(1)}%`\n                      )\n                      .join(\"\")\n                : \"\";\n\n        logger.logPrint(\n            `costs: ${lovelaceToAda(txFee)}` +\n                `\\n  -- fixed fee = ${lovelaceToAda(txFeeFixed)}` +\n                `\\n  -- tx size fee = ${lovelaceToAda(sizeFee)}` +\n                ` (${intWithGrouping(txSize)} bytes = ${(\n                    Number((1000 * txSize) / oMaxSize) / 10\n                ).toFixed(1)}% of tx size limit)` +\n                `\\n  -- refScripts fee = ${lovelaceToAda(refScriptsFee)}` +\n                refScriptCostDetails.join(\"\") +\n                `\\n  -- scripting costs` +\n                `\\n    -- cpu units ${intWithGrouping(total.cpu)}` +\n                ` = ${lovelaceToAda(cpuFee)}` +\n                ` (${(\n                    Number((1000n * total.cpu) / BigInt(oMaxCpu)) / 10\n                ).toFixed(1)}% of cpu limit/tx)` +\n                `\\n    -- memory units ${intWithGrouping(total.mem)}` +\n                ` = ${lovelaceToAda(memFee)}` +\n                ` (${(\n                    Number((1000n * total.mem) / BigInt(oMaxMem)) / 10\n                ).toFixed(1)}% of mem limit/tx)` +\n                scriptBreakdown +\n                `\\n  -- remainder ${lovelaceToAda(\n                    remainderUnaccounted\n                )} unaccounted-for`\n        );\n    }\n\n    /**\n     * Executes additional transactions indicated by an existing transaction\n     * @remarks\n     *\n     * During the off-chain txn-creation process, additional transactions may be\n     * queued for execution.  This method is used to register those transactions,\n     * along with any chained transactions THEY may trigger.\n     *\n     * The TxBatcher and batch-controller classes handle wallet-signing\n     * and submission of the transactions for execution.\n     * @public\n     **/\n    async queueAddlTxns(\n        this: hasAddlTxns<any>,\n        pipelineOptions?: TxPipelineOptions\n    ) {\n        const { addlTxns } = this.state;\n        if (!addlTxns) return;\n\n        // return this.submitTxns(Object.values(addlTxns), callback);\n        return this.submitTxnChain({\n            ...pipelineOptions,\n            txns: Object.values(addlTxns),\n        });\n    }\n\n    /**\n     * Resolves a list of tx descriptions to full tcx's, without handing any of their\n     * any chained/nested txns.\n     * @remarks\n     * if submitEach is provided, each txn will be submitted as it is resolved.\n     * If submitEach is not provided, then the network must be capable of tx-chaining\n     * use submitTxnChain() to submit a list of txns with chaining\n     */\n    async resolveMultipleTxns(\n        txns: TxDescription<any, \"buildLater!\">[],\n        pipelineOptions?: TxPipelineOptions\n    ) {\n        //         as [\n        //         string,\n        //         TxDescription<any, \"buildLater!\">\n        //     ][]\n\n        for (const [txName, addlTxInfo] of Object.entries(txns)) {\n            const { id } = addlTxInfo;\n            let txTracker = this.currentBatch.$txInfo(id);\n            if (!txTracker) {\n                this.currentBatch.$addTxns(addlTxInfo);\n                txTracker = this.currentBatch.$txInfo(id);\n            }\n        }\n        /* yield to allow rendering */\n        await new Promise((res) => setTimeout(res, 5));\n\n        for (const [txName, addlTxInfo] of Object.entries(txns)) {\n            const { id, depth, parentId } = addlTxInfo;\n            let txTracker = this.currentBatch.$txInfo(id);\n\n            txTracker.$transition(\"building\");\n            /* yield to allow rendering */\n            await new Promise((res) => setTimeout(res, 5));\n\n            // IS resolving.  WILL BE resolved\n            const txInfoResolved: TxDescription<any, \"resolved\"> =\n                addlTxInfo as any;\n            const { txName, description } = txInfoResolved;\n            let alreadyPresent: TxNotNeededError | undefined = undefined;\n            console.log(\"  -- before: \" + description);\n            const tcx = (\n                \"function\" == typeof addlTxInfo.mkTcx\n                    ? await (async () => {\n                          console.log(\n                              \"  creating TCX just in time for: \" + description\n                          );\n\n                          const tcx = await addlTxInfo.mkTcx();\n                          tcx.parentId = parentId || \"\";\n                          tcx.depth = depth;\n                          if (id) {\n                              this.currentBatch.changeTxId(id, tcx.id);\n                              txInfoResolved.id = tcx.id;\n                          } else {\n                              addlTxInfo.id = tcx.id;\n                              console.warn(\n                                  `expected id to be set on addlTxInfo; falling back to JIT-generated id in new tcx`\n                              );\n                          }\n                          return tcx;\n                      })().catch((e) => {\n                          if (e instanceof TxNotNeededError) {\n                              alreadyPresent = e;\n                              const tcx = new StellarTxnContext(\n                                  this.setup\n                              ).withName(\n                                  `addlTxInfo already present: ${description}`\n                              );\n                              tcx.alreadyPresent = alreadyPresent;\n                              return tcx;\n                          }\n                          throw e;\n                      })\n                    : (() => {\n                          console.log(\n                              \"  ---------------- warning!!!! addlTxInfo is already built!\"\n                          );\n                          debugger;\n                          throw new Error(\" unreachable - right?\");\n                          return addlTxInfo.tcx;\n                      })()\n            ) as StellarTxnContext;\n            if (\"undefined\" == typeof tcx) {\n                throw new Error(\n                    `no txn provided for addlTx ${txName || description}`\n                );\n            }\n            txInfoResolved.tcx = tcx;\n            if (tcx.alreadyPresent) {\n                console.log(\n                    \"  -- tx effects are already present; skipping: \" +\n                        txName || description\n                );\n                this.currentBatch.$addTxns(txInfoResolved);\n                continue;\n            }\n\n            const replacementTcx =\n                (pipelineOptions?.fixupBeforeSubmit &&\n                    ((await pipelineOptions.fixupBeforeSubmit(\n                        txInfoResolved\n                    )) as typeof replacementTcx | boolean)) ||\n                tcx;\n            if (false === replacementTcx) {\n                console.log(\"callback cancelled txn: \", txName);\n                continue;\n            }\n            if (replacementTcx !== true && replacementTcx !== tcx) {\n                console.log(\n                    `callback replaced txn ${txName} with a different txn: `,\n                    dumpAny(replacementTcx)\n                );\n            }\n\n            // if the callback returns true or void, we execute the txn as already resolved.\n            // if it returns an alternative txn, we use that instead.\n            const effectiveTcx: StellarTxnContext =\n                true === replacementTcx ? tcx : replacementTcx || tcx;\n            // console.log(\"   -- submitTxns: -> txn: \", txName, description);\n            // console.log(\"   ----> effective tx\", effectiveTcx);\n\n            txInfoResolved.tcx = effectiveTcx;\n\n            //!!! was just buildAndQueue, but that was executing\n            // in \"breadth-first\" order (good for registration)\n            //    (i.e. in consecutive layers of discovered txns)\n            // ... instead of executing depth-first (good for tx-chaining).\n            // We want all txns to be registered as soon as they're\n            //   known to be a tx to be made.  But for each such tx,\n            //   we want its chained txns to be executed BEFORE moving on\n            //   to build any of those other registered txns.\n\n            // //@ts-expect-error\n            // if (this.setup.stopped) return;\n            // if (description == \"+ on-chain refScript: minter\") {\n            //     //@ts-expect-error\n            //     this.setup.stopped = true\n            //     break\n            // }\n            await effectiveTcx.buildAndQueueAll({\n                ...pipelineOptions,\n                addlTxInfo: txInfoResolved,\n            });\n            // console.log(\"   -- submitTxns: <- txn: \", txName, description);\n            // m oved into submit()\n            // if (callbacks?.onSubmitted) {\n            // console.log(\"   -- submitTxns: triggering onSubmit callback\");\n            // await callbacks.onSubmitted(txInfoResolved);\n            // console.log(\"   -- submitTxns: onSubmitted callback completed\");\n            // }\n        }\n    }\n\n    /**\n     * To add a script to the transaction context, use `attachScript`\n     *\n     * @deprecated - invalid method name; use `addScriptProgram()` or capo's `txnAttachScriptOrRefScript()` method\n     **/\n    addScript() {}\n\n    async submitTxnChain(\n        options: {\n            txns?: TxDescription<any, \"buildLater!\">[];\n        } & TxPipelineOptions = {\n            //@ts-expect-error because the type of this context doesn't\n            //   guarantee the presence of addlTxns.  But it might be there!\n            txns: this.state.addlTxns || [],\n        }\n    ) {\n        //@ts-expect-error on probing for a maybe-undefined entry:\n        const addlTxns = this.state.addlTxns;\n\n        const { txns, onSubmitError } = options;\n        const newTxns: TxDescription<any, \"buildLater!\">[] =\n            txns || addlTxns || [];\n        let chainedTxns: TxDescription<any, \"buildLater!\">[] = [];\n\n        const txChainSubmitOptions: TxPipelineOptions = {\n            onSubmitError,\n            // txns,  // see newTxns\n            fixupBeforeSubmit: (txinfo) => {\n                //   ... in regular execution environment, this is a no-op by default\n                options.fixupBeforeSubmit?.(txinfo);\n            },\n            whenBuilt: async (txinfo) => {\n                const { id: parentId, tx } = txinfo;\n                const stackedPromise = options.whenBuilt?.(txinfo);\n                const more: Record<string, TxDescription<any, \"buildLater!\">> =\n                    //@ts-expect-error on optional prop\n                    txinfo.tcx.state.addlTxns || {};\n                console.log(\"  ✅ \" + txinfo.description);\n                const moreTxns = Object.values(more);\n\n                for (const nested of moreTxns) {\n                    nested.parentId = parentId;\n                }\n                console.log(\n                    `🎄⛄🎁 ${parentId}   -- registering nested txns ASAP`\n                );\n                this.currentBatch.$addTxns(moreTxns);\n\n                /* yield to allow rendering */\n                await new Promise((res) => setTimeout(res, 5));\n\n                // if (moreTxns.length) {\n                //     // gathers the next layer of txns to be resolved & built\n                //     chainedTxns.push(...moreTxns);\n                //     console.log(\n                //         \" + chained txns: \\n\" +\n                //             moreTxns\n                //                 .map((t) => `   🟩 ${t.description}\\n`)\n                //                 .join(\"\")\n                //     );\n                // }\n                return stackedPromise;\n            },\n            onSubmitted: (txinfo) => {\n                //@ts-expect-error triggering the test-network-emulator's tick\n                //   ... in regular execution environment, this is a no-op by default\n                this.setup.network.tick?.(1);\n            },\n        };\n        let chainDepth = 0;\n        const isolatedTcx = new StellarTxnContext(this.setup);\n        console.log(\"🐝😾🐻🦀\");\n        isolatedTcx.id = this.id;\n        console.log(\n            \"at d=0: submitting addl txns: \\n\" +\n                newTxns.map((t) => `  🟩 ${t.description}\\n`).join(\"\")\n        );\n\n        const t = isolatedTcx.resolveMultipleTxns(\n            newTxns,\n            txChainSubmitOptions\n        );\n\n        const allPromises = [] as Promise<any>[];\n        chainDepth = 0;\n        allPromises.push(t);\n\n        await t;\n        return;\n        while (chainedTxns.length) {\n            const nextChain: typeof chainedTxns = [];\n            chainDepth++;\n\n            for (const { tcx } of chainedTxns) {\n                // if (tcx.state) {\n                //     debugger\n                // } else {\n                //     const { addlTxns: nestedAddlTxns } = (tcx.state || {}) as {\n                //         addlTxns?: Record<\n                //             string,\n                //             TxDescription<any, \"buildLater!\">\n                //         >;\n                //     };\n                //     if (!nestedAddlTxns) continue;\n                //     nextChain.push(...Object.values(nestedAddlTxns));\n                // }\n            }\n            console.log(\n                ` 🐞🐞🐞🐞 submitting ${chainedTxns.length} transactions at depth ${chainDepth}`\n            );\n            console.log(\n                chainedTxns.map((t) => `  🟩 ${t.description}\\n`).join(\"\")\n            );\n            const thisBatch = chainedTxns;\n            chainedTxns = [];\n\n            const isolatedTcx = new StellarTxnContext(this.setup);\n            isolatedTcx.id = this.id;\n\n            const t = isolatedTcx.resolveMultipleTxns(\n                thisBatch,\n                txChainSubmitOptions\n            );\n            allPromises.push(t);\n            await t;\n            console.log(\n                \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\nSubmitted transactions at depth \" +\n                    chainDepth\n            );\n            chainedTxns = nextChain;\n        }\n        return Promise.all(allPromises);\n    }\n}\n\n// /**\n//  * Given a fully built transaction, returns a new transaction with the fees removed\n//  * @remarks\n//  * The result is suitable for submission to Ogmios' tx-evaluation endpoint\n//  * that uses Haskell's CEK interpreter to give us the costs for the transaction.\n//  *\n//  * TODO: use this to cross-check Helios' CEK budgeting and ensure we\n//  * make a txn that will be accepted by the network\n//  */\n// export function undoFeesFrom(\n//     t: Tx,\n//     { isValid: validity = true }: { isValid?: boolean } = {}\n// ): Tx {\n//     const tb = t.body;\n//     const pTxB = makeTxBody({\n//         dcerts: tb.dcerts,\n//         fee: BigInt(0),\n//         minted: tb.minted,\n//         refInputs: tb.refInputs,\n//         inputs: tb.inputs,\n//         outputs: tb.outputs,\n//         signers: tb.signers,\n//         withdrawals: tb.withdrawals,\n//         collateral: tb.collateral,\n//         collateralReturn: tb.collateralReturn,\n//         firstValidSlot: tb.firstValidSlot,\n//         lastValidSlot: tb.lastValidSlot,\n//         metadataHash: tb.metadataHash,\n//         scriptDataHash: tb.scriptDataHash,\n//         totalCollateral: tb.totalCollateral,\n//     });\n\n//     const txW = makeTxWitnesses({\n//         ...t.witnesses,\n//         redeemers: t.witnesses.redeemers.map((r) => {\n//             switch (r.kind) {\n//                 case \"TxCertifyingRedeemer\":\n//                     return makeTxCertifyingRedeemer(r.dcertIndex, r.data);\n//                 case \"TxMintingRedeemer\":\n//                     return makeTxMintingRedeemer(r.policyIndex, r.data);\n//                 case \"TxSpendingRedeemer\":\n//                     return makeTxSpendingRedeemer(r.inputIndex, r.data);\n//                 case \"TxRewardingRedeemer\":\n//                     return makeTxRewardingRedeemer(r.withdrawalIndex, r.data);\n//             }\n//         }),\n//     });\n//     return makeTx(pTxB, txW, validity, t.metadata);\n// }\n","import { equalsBytes, type BytesLike } from \"@helios-lang/codec-utils\";\nimport {\n    selectLargestFirst,\n    type SimpleWallet,\n    type Wallet,\n} from \"@helios-lang/tx-utils\";\nimport {\n    type Address,\n    type AssetClass,\n    type Assets,\n    type MintingPolicyHash,\n    type TxInput,\n    type TxOutput,\n    type Value,\n    type NetworkParams,\n    makeTxOutput,\n    makeValue,\n    makeAssetClass,\n    makeAddress,\n    makeDummyAddress,\n    type ScriptHash,\n} from \"@helios-lang/ledger\";\n\nimport { StellarTxnContext } from \"./StellarTxnContext.js\";\n// import type { SimpleWallet_stellar } from \"./testing/StellarNetworkEmulator.js\";\nimport { dumpAny, utxosAsString } from \"./diagnostics.js\";\nimport { UutName } from \"./delegation/UutName.js\";\nimport type { SetupInfo, StellarContract } from \"./StellarContract.js\";\nimport { textToBytes } from \"./HeliosPromotedTypes.js\";\n\nexport type utxoSortInfo = {\n    u: TxInput;\n    sufficient: boolean;\n    free: bigint;\n    minAdaAmount: bigint;\n};\n\nexport type canHaveToken = TxInput | TxOutput | Assets;\nexport type tokenPredicate<tokenBearer extends canHaveToken> = ((\n    something: tokenBearer\n) => tokenBearer | undefined) & { predicateValue: Value };\n\n/**\n * a function that can filter txInputs for coin-selection\n * @remarks\n *\n * short form: \"returns truthy\" if the input is matchy for the context\n * @public\n **/\nexport type utxoPredicate = (\n    | ((u: TxInput) => TxInput | undefined)\n    | ((u: TxInput) => boolean)\n    | ((u: TxInput) => boolean | undefined)\n) & {\n    predicateValue?: Value;\n};\n\nexport type UtxoSearchScope = {\n    /**\n     * provides pre-resolved utxos for the indicated address-or-wallet\n     */\n    utxos?: TxInput[];\n    /**\n     * searches in a specific address (e.g. a smart contract address)\n     */\n    address?: Address;\n    /**\n     * searches in this wallet rather than the address\n     */\n    wallet?: Wallet | SimpleWallet; //| SimpleWallet_stellar;\n    /**\n     * @deprecated - ??? use txBatcher's chainBuilder and includeAddlTxns instead\n     * NOTE: if we're only using this to reference our OWN tcx, then\n     *   either make that automatic, or retract the deprecation.\n     */\n    exceptInTcx?: StellarTxnContext;\n    /**\n     * by default it, only dumps detail if global.utxoDump is set to true\n     * @remarks\n     * - use \"onFail\" to log candidate utxos if the search fails\n     * - use \"always\" to log candidate utxos for a single search,\n     *   regardless of success or failure\n     */\n    dumpDetail?: \"onFail\" | \"always\";\n    // utxos : TxInput[]\n};\n\nexport type UtxoSearchScopeWithUtxos = UtxoSearchScope & {\n    utxos: TxInput[];\n    required?: true;\n};\n\ntype CoinSelector = (utxos: TxInput[], amount: Value) => [TxInput[], TxInput[]];\n\n/**\n * A helper class for managing UTXOs in a Stellar contract\n * @remarks\n * Using the provided setup details, this helper provides methods for finding,\n * filtering and selecting UTXOs for inclusion in transactions, and for creating\n * related values and predicate-functions for matching UTXOs.\n * @public\n */\nexport class UtxoHelper {\n    strella?: StellarContract<any>;\n    setup: SetupInfo;\n\n    constructor(setup: SetupInfo, strella?: StellarContract<any>) {\n        this.setup = setup;\n        // console.log(\"UtxoHelper created with setup: \", setup);\n        if (!setup.uxtoDisplayCache) {\n            setup.uxtoDisplayCache = new Map();\n        }\n        this.strella = strella;\n    }\n\n    get networkParams(): NetworkParams {\n        return this.setup.networkParams;\n    }\n\n    get wallet() {\n        return this.setup.actorContext.wallet!;\n    }\n\n    get network() {\n        return this.setup.chainBuilder || this.setup.network;\n    }\n\n    /**\n     * Filters out utxos having non-ada tokens\n     * @internal\n     */\n    hasOnlyAda(value: Value, tcx: StellarTxnContext | undefined, u: TxInput) {\n        const toSortInfo = this.mkUtxoSortInfo(value.lovelace);\n\n        const found = [u]\n            .map(toSortInfo)\n            .filter(this.utxoIsSufficient)\n            .filter(this.utxoIsPureADA)\n            .map(this.sortInfoBackToUtxo)\n            .at(0);\n\n        return found;\n    }\n\n    /**\n     * Sorts utxos by size, with pure-ADA utxos preferred over others.\n     * @internal\n     */\n    utxoSortSmallerAndPureADA(\n        { free: free1, minAdaAmount: r1 }: utxoSortInfo,\n        { free: free2, minAdaAmount: r2 }: utxoSortInfo\n    ) {\n        {\n            //! primary: treats pure-ada utxos as always better\n            if (!r1 && r2) {\n                return -1;\n            }\n            if (r1 && !r2) {\n                return 1; //\n            }\n        }\n        //! secondary: smaller utxos are more preferred than larger ones\n        if (free2 > free1) return -1;\n        if (free2 < free1) return 1;\n        return 0;\n    }\n\n    /**\n     * Filters out utxos that are not sufficient to cover the minimum ADA amount established in\n     * the utxo sort info in {@link UtxoHelper.mkUtxoSortInfo | mkUtxoSortInfo(min, max?)}.  Use in a filter() call.\n     * @internal\n     */\n    utxoIsSufficient({ sufficient }: utxoSortInfo) {\n        return !!sufficient;\n    }\n\n    /**\n     * Filters out utxos that have non-ADA tokens, given a utxo sort info object.  Use in a filter() call.\n     * @internal\n     */\n    utxoIsPureADA({ u }: utxoSortInfo) {\n        return u.value.assets.isZero() ? u : undefined;\n    }\n\n    /**\n     * transforms utxo sort info back to just the utxo.\n     * @internal\n     */\n    sortInfoBackToUtxo({ u }: utxoSortInfo) {\n        return u;\n    }\n\n    /**\n     * Creates a function that creates sort-info details for a utxo, given a minimum ADA amount\n     * and an optional maximum ADA amount.\n     * @internal\n     **/\n    mkUtxoSortInfo(min: bigint, max?: bigint) {\n        return (u: TxInput): utxoSortInfo => {\n            const minAdaAmount = u.value.assets.isZero()\n                ? BigInt(0)\n                : (() => {\n                      const dummy = makeTxOutput(\n                          u.output.address,\n                          makeValue(0, u.output.value.assets)\n                      );\n                      dummy.correctLovelace(this.networkParams);\n                      return dummy.value.lovelace;\n                  })();\n            const free = u.value.lovelace - minAdaAmount;\n            const sufficient = free > min && (max ? free < max : true);\n            const t = { u, sufficient, free, minAdaAmount };\n            // console.log(t, utxoAsString(u))\n            return t;\n        };\n    }\n    /**\n     * accumulates the count of utxos, but only if the utxo is ADA-only.  Use in a reduce() call.\n     **/\n    reduceUtxosCountAdaOnly(c: number, { minAdaAmount }: utxoSortInfo): number {\n        return c + (minAdaAmount ? 0 : 1);\n    }\n\n    hasToken<tokenBearer extends canHaveToken>(\n        something: tokenBearer,\n        value: Value,\n        tokenName?: string,\n        quantity?: bigint\n    ): tokenBearer | undefined {\n        if (something.kind == \"TxOutput\")\n            return (\n                (this.outputHasToken(\n                    something as TxOutput,\n                    value,\n                    tokenName,\n                    quantity\n                ) &&\n                    something) ||\n                undefined\n            );\n\n        if (something.kind == \"TxInput\")\n            return (\n                (this.utxoHasToken(\n                    something as TxInput,\n                    value,\n                    tokenName,\n                    quantity\n                ) &&\n                    something) ||\n                undefined\n            );\n\n        if (something.kind == \"Assets\")\n            return (\n                (this.assetsHasToken(\n                    something as Assets,\n                    value,\n                    tokenName,\n                    quantity\n                ) &&\n                    something) ||\n                undefined\n            );\n\n        throw new Error(\"unexpected\");\n        // //!!! todo: more explicit match for TxInput, which seems to be a type but not an 'instanceof'-testable thing.\n        // return (\n        //     (this.inputHasToken(something, value, tokenName, quantity) &&\n        //         something) ||\n        //     undefined\n        // );\n    }\n\n    utxoHasToken(\n        u: TxInput,\n        value: Value,\n        tokenName?: string,\n        quantity?: bigint\n    ) {\n        return this.outputHasToken(u.output, value, tokenName, quantity) && u;\n    }\n\n    inputHasToken(\n        i: TxInput,\n        value: Value,\n        tokenName?: string,\n        quantity?: bigint\n    ) {\n        return this.outputHasToken(i.output, value, tokenName, quantity) && i;\n    }\n\n    assetsHasToken(\n        a: Assets,\n        vOrMph: Value | MintingPolicyHash,\n        tokenName?: string,\n        quantity?: bigint\n    ) {\n        const v =\n            vOrMph.kind == \"MintingPolicyHash\"\n                ? this.mkAssetValue(vOrMph, tokenName!, quantity!)\n                : vOrMph;\n\n        return a.isGreaterOrEqual(v.assets);\n    }\n\n    outputHasToken(\n        o: TxOutput,\n        vOrMph: Value | MintingPolicyHash,\n        tokenName?: string,\n        quantity?: bigint\n    ) {\n        const isValue = vOrMph.kind == \"Value\";\n        if (!isValue) {\n            if (!tokenName || !quantity) {\n                throw new Error(\n                    `missing required tokenName/quantity (or use a Value in arg2`\n                );\n            }\n        }\n\n        const v = isValue ? vOrMph : makeValue(vOrMph, tokenName!, quantity!);\n\n        return o.value.isGreaterOrEqual(v);\n    }\n\n    /**\n     * @deprecated - use helios `makeValue()` instead\n     */\n    mkAssetValue(\n        mph: MintingPolicyHash,\n        tokenName: BytesLike,\n        count: bigint = 1n\n    ) {\n        // const TL  = [ tokenName, count ] as [ ByteArrayLike, bigint ];\n        // const oneAssetLike = [ mph, [\n        //     TL\n        //  ] ] as [ MintingPolicyHash, [ ByteArrayLike, bigint ][] ];\n        //  const v1 = new Value(undefined, [\n        //     oneAssetLike\n        // ]);\n        // const v2 = new Value(undefined, [\n        //     [ mph, [ TL ] ]\n        // ]);\n        const v = makeValue(\n            mph,\n            tokenName,\n            count\n            // ...other mph / token-map pairs\n        );\n        return v;\n    }\n\n    findSmallestUnusedUtxo(\n        lovelace: bigint,\n        utxos: TxInput[],\n        tcx?: StellarTxnContext\n    ): TxInput | undefined {\n        const value = makeValue(lovelace);\n        const toSortInfo = this.mkUtxoSortInfo(value.lovelace);\n\n        const found = utxos\n            .map(toSortInfo)\n            .filter(this.utxoIsPureADA)\n            .filter(this.utxoIsSufficient)\n            .filter((uInfo: utxoSortInfo) => {\n                if (!tcx) return true;\n                return !!tcx?.utxoNotReserved(uInfo.u);\n            })\n            .sort(this.utxoSortSmallerAndPureADA)\n            .map(this.sortInfoBackToUtxo);\n        console.log(\"smallest utxos: \", utxosAsString(found));\n        const chosen = found.at(0);\n\n        return chosen;\n    }\n\n    /**\n     * creates a filtering function, currently for TxInput-filtering only.\n     * with the optional tcx argument, utxo's already reserved\n     *  ... in that transaction context will be skipped.\n     * @public\n     */\n    mkValuePredicate(\n        lovelace: bigint,\n        tcx?: StellarTxnContext\n    ): tokenPredicate<TxInput> {\n        const value = makeValue(lovelace);\n        const predicate = _adaPredicate.bind(this, tcx) as tokenPredicate<any>;\n        predicate.predicateValue = value;\n        return predicate;\n\n        function _adaPredicate(\n            this: UtxoHelper,\n            tcx: StellarTxnContext | undefined,\n            utxo: TxInput\n        ): TxInput | undefined {\n            return this.hasOnlyAda(value, tcx, utxo);\n        }\n    }\n\n    mkRefScriptPredicate(expectedScriptHash: number[]): utxoPredicate {\n        return (txin: TxInput) => {\n            const refScript = txin.output.refScript;\n            if (!refScript) return false;\n\n            const foundHash = refScript.hash();\n            return equalsBytes(foundHash, expectedScriptHash);\n        };\n    }\n\n    /**\n     * Creates an asset class for the given token name, for the indicated minting policy\n     */\n    acAuthorityToken(\n        tokenName: string | number[],\n        mph?: MintingPolicyHash\n    ): AssetClass {\n        let ourMph = mph;\n        if (!ourMph) {\n            if (!this.strella) {\n                throw new Error(\n                    `no contract available for resolving minting policy hash; provide to acAuthorityToken or use a UtxoHelper having a strella prop`\n                );\n            }\n            ourMph = this.strella.mintingPolicyHash;\n        }\n        if (!ourMph) {\n            throw new Error(`no minting policy hash available`);\n        }\n        return makeAssetClass(ourMph, tokenName);\n    }\n\n    /**\n     * Creates a Value object representing a token with a minimum lovelace amount\n     * making it valid for output in a utxo.\n     * @public\n     */\n    mkMinTv(\n        mph: MintingPolicyHash,\n        tokenName: string | UutName | number[],\n        count: bigint = 1n\n    ) {\n        const tnBytes = Array.isArray(tokenName)\n            ? tokenName\n            : textToBytes(tokenName.toString());\n\n        return this.mkMinAssetValue(mph, tnBytes, count);\n    }\n\n    mkMinAssetValue(\n        mph: MintingPolicyHash,\n        tokenName: BytesLike,\n        count: bigint = 1n\n    ) {\n        const v = makeValue(mph, tokenName, count);\n        // uses a dummy address so it can be used even during bootstrap\n        const dummyAddr = makeDummyAddress(false);\n        const txo = makeTxOutput(dummyAddr, v);\n        txo.correctLovelace(this.networkParams);\n        return txo.value;\n    }\n\n    tokenAsValue(\n        tokenName: string | number[] | UutName,\n        count: bigint = 1n\n    ): Value {\n        throw new Error(`only implemented by Capo`);\n    }\n\n    /**\n     * Creates a token predicate suitable for mustFindActorUtxo or mustFindMyUtxo\n     * @remarks\n     * This variant takes just a token-name / quantity, working only on Capo instances,\n     * and seeks a token created by the Capo's minting policy.\n     *\n     * Choose from one of the other variants to make a more specific token predicate.\n     * @public\n     */\n    mkTokenPredicate(\n        tokenName: UutName | number[] | string,\n        quantity?: bigint\n    ): tokenPredicate<any>;\n    /**\n     * Creates a token predicate suitable for mustFindActorUtxo or mustFindMyUtxo\n     * @remarks\n     * This variant uses a Value for filtering - each matched item must have the ENTIRE value.\n     * @public\n     */\n    mkTokenPredicate(val: Value): tokenPredicate<any>;\n    /**\n     * Creates a token predicate suitable for mustFindActorUtxo or mustFindMyUtxo\n     * @remarks\n     * This variant uses an explicit combination of policy/token-name/quantity\n     * @public\n     */\n    mkTokenPredicate(\n        mph: MintingPolicyHash,\n        tokenName: string,\n        quantity?: bigint\n    ): tokenPredicate<any>;\n    /**\n     * Creates a token predicate suitable for mustFindActorUtxo or mustFindMyUtxo\n     * @remarks\n     * This variant uses an AssetClass(policy/token-name) and quantity\n     * @public\n     */\n    mkTokenPredicate(\n        mphAndTokenName: AssetClass,\n        quantity?: bigint\n    ): tokenPredicate<any>;\n    mkTokenPredicate(\n        specifier:\n            | Value\n            | MintingPolicyHash\n            | AssetClass\n            | UutName\n            | number[]\n            | string,\n        quantOrTokenName?: string | bigint,\n        quantity?: bigint\n    ): tokenPredicate<any> {\n        let v: Value;\n        let mph: MintingPolicyHash;\n        let tokenName: string;\n        //!!! todo: support (AssetClass, quantity) input form\n        if (!specifier)\n            throw new Error(\n                `missing required Value or MintingPolicyHash or UutName (or uut-name as byte-array) in arg1`\n            );\n        const predicate = _tokenPredicate.bind(this) as tokenPredicate<any>;\n\n        //@ts-expect-error\n        const isValue = specifier.kind == \"Value\";\n\n        const isTokenNameOnly =\n            \"string\" === typeof specifier ||\n            (Array.isArray(specifier) && \"number\" === typeof specifier[0]);\n        const isUut = specifier instanceof UutName;\n        if (isValue) {\n            const v = specifier as Value;\n            // v = predicate.value = specifier;\n            const t = _tokenPredicate.bind(this, v) as tokenPredicate<any>;\n            t.predicateValue = v;\n            return t;\n        } else if (isUut || isTokenNameOnly) {\n            const tn = specifier as UutName | number[] | string;\n            const quant = quantOrTokenName ? BigInt(quantOrTokenName) : 1n;\n            //@ts-expect-error\n            const mph = this.strella.mph;\n            if (!mph) {\n                throw new Error(\n                    `this helper doesn't have a capo contract to resolve minting policy hash; specify the mph explicitly`\n                );\n            }\n            const tnBytes = isUut\n                ? textToBytes(tn.toString())\n                : Array.isArray(tn)\n                ? tn\n                : textToBytes(tn as string);\n            const tv = makeValue(\n                mph,\n                tnBytes,\n                quant // quantity if any\n            );\n            const t = _tokenPredicate.bind(this, tv) as tokenPredicate<any>;\n            t.predicateValue = tv;\n            return t;\n            //@ts-expect-error\n        } else if (specifier.kind == \"MintingPolicyHash\") {\n            mph = specifier as MintingPolicyHash;\n            if (\"string\" !== typeof quantOrTokenName)\n                throw new Error(\n                    `with minting policy hash, token-name must be a string (or ByteArray support is TODO)`\n                );\n            tokenName = quantOrTokenName;\n            quantity = quantity || 1n;\n\n            // v = predicate.value = this.mkTokenValue(tokenName, quantity, mph);\n            // return predicate;\n            const tv = this.mkAssetValue(mph, tokenName, quantity);\n\n            const t = _tokenPredicate.bind(this, tv) as tokenPredicate<any>;\n            t.predicateValue = tv;\n            return t;\n            //@ts-expect-error\n        } else if (specifier.kind == \"AssetClass\") {\n            const s = specifier as AssetClass;\n            mph = s.mph;\n            if (!quantOrTokenName) quantOrTokenName = 1n;\n            if (\"bigint\" !== typeof quantOrTokenName)\n                throw new Error(\n                    `with AssetClass, the second arg must be a bigint like 3n, or omitted`\n                );\n            quantity = quantOrTokenName;\n\n            // v = predicate.value = new Value(0n, [[specifier, quantity]]);\n            // return predicate;\n            const tv = makeValue(0n, [[mph, [[s.tokenName, quantity]]]]);\n            const t = _tokenPredicate.bind(this, tv) as tokenPredicate<any>;\n            t.predicateValue = tv;\n            return t;\n        } else {\n            throw new Error(\n                `wrong token specifier (need Value, MPH+tokenName, or AssetClass`\n            );\n        }\n\n        function _tokenPredicate<tokenBearer extends canHaveToken>(\n            this: UtxoHelper,\n            v: Value,\n            something: tokenBearer\n        ): tokenBearer | undefined {\n            return this.hasToken(something, v);\n        }\n    }\n\n    /**\n     * adds the values of the given TxInputs\n     */\n    totalValue(utxos: TxInput[]): Value {\n        return utxos.reduce((v: Value, u: TxInput) => {\n            return v.add(u.value);\n        }, makeValue(0n));\n    }\n\n    /**\n     * Creates a Value object representing a token with the given name and quantity\n     * @deprecated - Use `helios' makeValue()` instead.\n     * @remarks\n     * This method doesn't include any lovelace in the Value object.\n     * use mkMinAssetValue() to include the minimum lovelace for storing that token in its own utxo\n     * @param tokenName - the name of the token\n     * @param quantity - the quantity of the token\n     * @param mph - the minting policy hash of the token\n     * @public\n     **/\n    mkTokenValue(\n        tokenName: string | number[],\n        quantity: bigint,\n        mph: MintingPolicyHash\n    ): Value {\n        return makeValue(mph, tokenName, quantity);\n    }\n\n    /**\n     * Creates a Value having enough lovelace to store the indicated token\n     * @deprecated - Use {@link UtxoHelper.mkMinAssetValue | mkMinAssetValue(mph, tokenName, quantity)} instead.\n     * @remarks\n     * This is equivalent to mkTokenValue() with an extra min-utxo calculation\n     * @public\n     **/\n    mkMinTokenValue(\n        tokenName: string | number[],\n        quantity: bigint,\n        mph: MintingPolicyHash\n    ) {\n        return this.mkMinAssetValue(mph, tokenName, quantity);\n    }\n\n    /**\n     * finds utxos in the current actor's wallet that have enough ada to cover the given amount\n     * @remarks\n     * This method is useful for finding ADA utxos that can be used to pay for a transaction.\n     * \n     * Other methods in the utxo helper are better for finding individual utxos.\n     * @public\n     */\n    async findSufficientActorUtxos(\n        name: string,\n        amount: Value,\n        options: UtxoSearchScope = {},\n        strategy: CoinSelector | CoinSelector[] = [\n            selectLargestFirst({ allowSelectingUninvolvedAssets: false }),\n            selectLargestFirst({ allowSelectingUninvolvedAssets: true }),\n        ]\n    ) : Promise<TxInput[]> {\n        const wallet = options.wallet ?? this.wallet;\n\n        const addrs = (await wallet.usedAddresses)\n        const utxos: TxInput[] = [];\n        for (const addr of addrs.flat(1)) {\n            if (!addr) continue;\n            const addrUtxos = await this.network.getUtxos(addr);\n            utxos.push(...addrUtxos);\n        }\n\n        const filtered = options.exceptInTcx\n            ? utxos.filter(\n                  options.exceptInTcx.utxoNotReserved.bind(options.exceptInTcx)\n              )\n            : utxos;\n\n        if (!Array.isArray(strategy)) {\n            strategy = [strategy];\n        }\n        for (const s of strategy) {\n            const [selected, others] = s(filtered, amount);\n            if (selected.length > 0) {\n                return selected;\n            }\n        }\n        throw new Error(\n            `no sufficient utxos found using any of ${strategy.length} strategies`\n        );\n    }\n    /**\n     * Locates a utxo in the current actor's wallet that matches the provided token predicate\n     * @remarks\n     * With the mode=\"multiple\" option, it returns an array of matches if any are found, or undefined if none are found.\n     * @public\n     */\n    async findActorUtxo<T extends \"single\" | \"multiple\" = \"single\">(\n        name: string,\n        predicate: (u: TxInput) => TxInput | undefined,\n        options: UtxoSearchScope = {},\n        mode: T = \"single\" as T\n    ) {\n        const wallet = options.wallet ?? this.wallet;\n\n        // doesn't go through the wallet's interface - uses the network client instead,\n        // so that txChainBuilder can take into account the UTxO's already being spent in the tx-chain.\n        const addrs = (await wallet?.usedAddresses) ?? [];\n        const utxos: TxInput[] = [];\n        for (const addr of addrs.flat(1)) {\n            if (!addr) continue;\n            const addrUtxos = await this.network.getUtxos(addr);\n            utxos.push(...addrUtxos);\n        }\n\n        return this.hasUtxo(\n            name,\n            predicate,\n            {\n                ...options,\n                wallet,\n                utxos,\n            },\n            mode\n        );\n    }\n\n    /**\n     * Try finding a utxo matching a predicate\n     * @remarks\n     * Filters the provided list of utxos to find the first one that matches the predicate.\n     *\n     * Skips any utxos that are already being spent in the provided transaction context.\n     * Skips any utxos that are marked as collateral in the wallet.\n     *\n     * With the mode=\"multiple\" option, it returns an array of matches if any are found, or undefined if none are found.\n     * @public\n     **/\n    async hasUtxo<T extends \"single\" | \"multiple\" = \"single\">(\n        semanticName: string,\n        predicate: utxoPredicate,\n        {\n            // address,\n            wallet,\n            exceptInTcx,\n            utxos,\n            required,\n            dumpDetail,\n        }: UtxoSearchScopeWithUtxos,\n        mode: T = \"single\" as T\n    ): Promise<\n        T extends \"single\" ? TxInput | undefined : TxInput[] | undefined\n    > {\n        let notCollateral = await (async () => {\n            let nc = utxos;\n            try {\n                const collateral = ((wallet\n                    ? \"handle\" in wallet\n                        ? await (wallet as any).handle.collateral\n                        : \"collateral\" in wallet\n                        ? wallet.collateral\n                        : undefined\n                    : undefined) ?? [])[0];\n                nc = utxos.filter((u) => !collateral?.isEqual(u));\n            } catch {\n                // ignore\n            }\n            return nc;\n        })();\n\n        const filtered = exceptInTcx\n            ? utxos.filter(exceptInTcx.utxoNotReserved.bind(exceptInTcx))\n            : notCollateral;\n\n        const foundMultiple = filtered.filter(predicate);\n        const foundOne = foundMultiple[0];\n\n        const joiner = \"\\n   🔎  \";\n        const detail = // true ||\n            dumpDetail == \"always\" ||\n            globalThis.utxoDump ||\n            (!foundOne && dumpDetail == \"onFail\")\n                ? \"\\n  from set: \" + joiner + utxosAsString(filtered, joiner)\n                : `(${filtered.length} candidates; show with globalThis.utxoDump or \\`dumpDetail\\` option)`;\n        console.log(\n            `  🔎 finding '${semanticName}' utxo${\n                exceptInTcx ? \" (not already being spent in txn)\" : \"\"\n                // } from set:\\n    🔎 ${detail}`\n            } ${detail}`\n            // ...(exceptInTcx && filterUtxos?.length\n            //     ? [\n            //           \"\\n  ... after filtering out:\\n \",\n            //           utxosAsString(exceptInTcx.reservedUtxos(), \"\\n  \"),\n            //       ]\n            //     : [])\n        );\n\n        if (foundOne) {\n            const multiInfo =\n                mode == \"multiple\"\n                    ? ` ${foundMultiple.length} matches; first: `\n                    : \"\";\n            console.log(\n                \"   🎈found\" +\n                    multiInfo +\n                    utxosAsString(\n                        [foundOne],\n                        undefined,\n                        this.setup.uxtoDisplayCache\n                    )\n            );\n        } else {\n            if (exceptInTcx) {\n                const alreadyInTcx = exceptInTcx.inputs.find(predicate);\n                if (alreadyInTcx) {\n                    console.log(\n                        `\\n  um... value ${dumpAny(\n                            predicate.predicateValue\n                        )} not found. \\n` +\n                            `     ${dumpAny(alreadyInTcx)}\\n` +\n                            `  FYI, it seems this ^^ current txn input already has the target value. \\n` +\n                            \"    NOTE: You may want to adjust your dAPI to create an explicit fail-if-already-present semantic\\n\" +\n                            \"    ... or, alternatively, to allow this token to authenticate multiple transaction elements\\n\" +\n                            \"    ... by using explicitly idempotent 'addOrReuse' semantics, with details stored in tcx.state\\n\\n  ... go with care, and ask the community for help if you're unsure\\n  )\" +\n                            (required\n                                ? \"\\nBTW, here is that txn as of this time: \" +\n                                  (await alreadyInTcx.dump()) +\n                                  \"\\n\\n 👁️   👁️ 👁️ ^^^^^^^ More details about the utxo search failure above ^^^^^^^ 👁️ 👁️   👁️\"\n                                : \"\")\n                    );\n                    return undefined as any;\n                }\n            }\n        }\n        if (mode == \"multiple\") {\n            if (!foundMultiple.length) {\n                return undefined as any;\n            }\n            return foundMultiple as any;\n        }\n\n        return foundOne as any;\n    }\n\n    async mustFindActorUtxo(\n        name: string,\n        options: {\n            predicate: (u: TxInput) => TxInput | undefined;\n            exceptInTcx?: StellarTxnContext<any>;\n            extraErrorHint?: string;\n        }\n    ): Promise<TxInput> {\n        const wallet = this.wallet;\n\n        return this.mustFindUtxo(name, {\n            ...options,\n            wallet,\n        });\n    }\n\n    async mustFindUtxo(\n        semanticName: string,\n        options: UtxoSearchScope & {\n            predicate: utxoPredicate;\n            extraErrorHint?: string;\n        }\n    ): Promise<TxInput> {\n        // workaround for a failure in api-extractor to make this a separate assignment??\n        const {\n            predicate,\n            extraErrorHint = \"\",\n            wallet,\n            address,\n            exceptInTcx,\n        } = options;\n        // const { address, exceptInTcx } = searchScope;\n\n        const addrs = (await wallet?.usedAddresses) ?? [address];\n        const utxos: TxInput[] = [];\n        for (const addr of addrs.flat(1)) {\n            if (!addr) continue;\n            const addrUtxos = await this.network.getUtxos(addr);\n            utxos.push(...addrUtxos);\n        }\n\n        const found = await this.hasUtxo(semanticName, predicate, {\n            address,\n            wallet,\n            exceptInTcx,\n            utxos,\n            required: true,\n        });\n        if (!found) {\n            const walletAddr = wallet\n                ? //@ts-ignore - sorry typescript, address sometimes is present on a SimpleWallet in test environment\n                  wallet.address || (await wallet.usedAddresses)\n                : undefined;\n            if (!globalThis.utxoDump) {\n                console.log(\n                    // warning emoji: \"⚠️\"\n                    \" ⚠️ find failed in candidate utxos (debugging breakpoint available)\\n\",\n                    semanticName,\n                    dumpAny(utxos)\n                );\n            }\n            debugger;\n            // Debuggering?  YOU ARE AWESOME!\n            // need to see more? dig in here:\n            const addrString = address?.toString();\n            const utxos2 = address\n                ? await this.network.getUtxos(address)\n                : await wallet!.utxos;\n            console.log(\n                addrString,\n                wallet,\n                addrs.map((a) => a?.toString())\n            );\n            for (const u of utxos2) {\n                predicate(u);\n            }\n            throw new Error(\n                this.utxoSearchError(\n                    semanticName,\n                    options,\n                    extraErrorHint,\n                    walletAddr\n                )\n            );\n        }\n\n        return found;\n    }\n\n    utxoSearchError(\n        semanticName: string,\n        searchScope: UtxoSearchScope,\n        extraErrorHint?: string,\n        walletAddresses?: Address | Address[]\n    ): string {\n        const where = searchScope.address\n            ? `\\n -- searched in address ${searchScope.address.toString()}`\n            : ``;\n        const wAddrs: Address[] = Array.isArray(walletAddresses)\n            ? walletAddresses\n            : walletAddresses\n            ? [walletAddresses]\n            : [];\n        let more = wAddrs.length\n            ? wAddrs.map((x) => dumpAny(x) + ` = ${x.toString()}`).join(\"\\n\")\n            : \"\";\n        if (wAddrs.length > 1) {\n            more = \"\\n  ... wallet addrs:\\n\";\n        } else {\n            more = wAddrs.length ? `\\n  ... in wallet addr: ${more}` : \"\";\n        }\n        if (extraErrorHint) more += \"\\n\";\n\n        return `${\n            this.constructor.name\n        }: '${semanticName}' utxo not found ${more}  ... ${\n            extraErrorHint || \"sorry, no extra clues available\"\n        }${where}\\n  ... see more details in log`;\n    }\n\n    toUtxoId(u: TxInput) {\n        return `${u.id.txId.toHex()}@${u.id.index}`;\n    }\n}\n","import type { UplcData } from \"@helios-lang/uplc\";\nimport { StellarTxnContext, type hasSeedUtxo } from \"./StellarTxnContext.js\";\nimport type { IFISNEVER, TypeError } from \"./helios/typeUtils.js\";\nimport { makeTxOutputId, type TxId, type TxOutputId, type TxOutputIdLike } from \"@helios-lang/ledger\";\n\n/**\n * @public\n */\nexport type hasSeed = SeedAttrs | hasSeedUtxo | TxOutputIdLike;\n\n/**\n * a type for redeemer/activity-factory functions declared with \\@Activity.redeemer\n *\n * @public\n */\nexport type isActivity = {\n    // redeemer: UplcDataValue | UplcData | T;\n    redeemer: UplcData;\n    details?: string;\n};\n\n/**\n * @public\n */\nexport type SeedAttrs = {\n    txId: TxId;\n    idx: bigint;\n};\n\n/**\n * @public\n */\nexport type seedActivityFunc<\n    ARGS extends [...any] | never,\n    RV extends isActivity | UplcData | TypeError<any>\n> = IFISNEVER<ARGS,\n    (seed: hasSeed) => RV,\n    (seed: hasSeed, ...args: ARGS) => RV\n>\n\ntype seedFunc<\n    F extends ((seed: hasSeed, arg: any) => any ) | ( (seed: hasSeed) => any ),\n    ARG extends (\n        F extends (seed: hasSeed) => any ? never :\n        F extends (seed: hasSeed, arg: infer iArg) => any ? iArg : never\n    ) = \n        F extends (seed: hasSeed) => any ? never :\n        F extends (seed: hasSeed, arg: infer iArg) => any ? iArg : never,\n    RV extends ReturnType<F> = ReturnType<F>\n> = IFISNEVER<ARG, \n    seedActivityFunc<never, RV>,\n    seedActivityFunc<[ARG], RV>\n>\n\n\ntype NeedsSingleArgError =\n    TypeError<\"expected at most one arg for seeded activity func\">;\n\n/**\n * @internal\n */\nexport type SeedActivityArg<\n    SA extends seedFunc<any, any>\n    // ARG extends SA extends seedActivityFunc<[infer ARG, ... infer badArgs], any> ?\n    // [any] extends badArgs ?\n    //     TypeError<\"expected at most one arg for seeded activity func\"> :\n    // ARG : never =\n> = SA extends seedFunc<SA, infer ARG, infer RV> ? ARG : never;\n    // ? [...any] extends badArgs\n    //     ? NeedsSingleArgError\n    //     // : IFISNEVER<ARG, never, ARG>\n    //     : [any] extends [ARG] ? ARG : never\n    // : never;\n// > = ARG;\n\nfunction noArgsFunc(seed: hasSeed) : isActivity{\n    return { redeemer: \"no-args\" as any };\n}\ntype NOARGS_func = typeof noArgsFunc;\ntype noArgsArg = SeedActivityArg<typeof noArgsFunc>\nconst tt : IFISNEVER<SeedActivityArg<typeof noArgsFunc>, true, false> = true;\n\n/**\n * @public\n */\nexport class SeedActivity<\n    FactoryFunc extends seedActivityFunc<any, any>,\n> {\n    arg: SeedActivityArg<FactoryFunc>;\n    constructor(\n        private host: { getSeed(x: hasSeed): TxOutputId },\n        private factoryFunc : FactoryFunc,\n        arg: SeedActivityArg<FactoryFunc>\n    ) {\n        // console.log(\"+ seed activity\" + new Error(\"\").stack);\n        this.arg = arg;\n    }\n\n    mkRedeemer(seedFrom: hasSeed) {\n        // const seed = this.host.getSeed(thing);\n        return this.factoryFunc.call(this.host, seedFrom, this.arg);\n    }\n}\n/**\n * @internal\n */\n//prettier-ignore\nexport type funcWithImpliedSeed<\n    // FACTORY_FUNC extends (...args: [ hasSeed, ... ARGS ]) => any,\n    // ARGS extends [ ... any] =\n    //         FACTORY_FUNC extends (...args: [ hasSeed, ... infer iArgs ]) => any ?\n    //         [ any ] extends iArgs ? never : iArgs : never\n    // > = [ any ] extends ARGS ?\n    // (...args: ARGS) => unknown & SeedActivity<FACTORY_FUNC, ARGS>\n    FACTORY_FUNC extends seedActivityFunc<any, any>,\n    // ARG extends SeedActivityArg<FACTORY_FUNC> = \n    //     SeedActivityArg<FACTORY_FUNC> //extends SeedActivityArg<any, iArg> ? iArg : never,\n\n    // seedActivityFunc<[infer iArg, ... infer oArgs], any> ?\n    // [ any ] extends oArgs ? seedActivityFunc<\n    //     any, TypeError<\"expected at most one arg for seeded activity func\"\n    //     > :\n    // [ any ] extends iArg ? iArg : never : never\n> = IFISNEVER<\n    SeedActivityArg<FACTORY_FUNC>,\n    () => SeedActivity<FACTORY_FUNC>,\n    SeedActivityArg<FACTORY_FUNC> extends NeedsSingleArgError\n        ? never\n        : (fields: SeedActivityArg<FACTORY_FUNC>) => SeedActivity<FACTORY_FUNC>\n>;\n\nconst x: [any] extends [] ? true : false = false;\n\n/**\n * @internal\n */\n//prettier-ignore\nexport function impliedSeedActivityMaker<\n    FACTORY_FUNC extends seedActivityFunc<any, any>,\n    IMPLIED_SEED_FUNC extends funcWithImpliedSeed<FACTORY_FUNC> = \n        funcWithImpliedSeed<FACTORY_FUNC>,\n    ARG extends SeedActivityArg<FACTORY_FUNC> = \n        SeedActivityArg<FACTORY_FUNC>\n    // IMPLIED_SEED_FUNC extends funcWithImpliedSeed<infer iFunc, any> ? iFunc : never,\n    // ISV  extends\n    //     funcWithImpliedSeed<any, infer iArgs> ? iArgs : never\n>(\n    host: { getSeed(x: hasSeed): TxOutputId },\n    factoryFunc: FACTORY_FUNC,\n// ): WithImpliedSeedVariant<FACTORY_FUNC, ARGS> {\n): IMPLIED_SEED_FUNC {\n    const makesActivityWithImplicitSeedAndArgs = ( (arg: ARG) => {\n        const seedActivity = new SeedActivity<FACTORY_FUNC>(host, factoryFunc, arg);\n        return seedActivity;\n    }) as IMPLIED_SEED_FUNC\n    return makesActivityWithImplicitSeedAndArgs\n}\n\n/**\n * extracts a tx output id from a \"has-seed\" type of object, for use in\n * on-chain uniqueness assurances\n * @public\n */\nexport function getSeed(arg: hasSeed | TxOutputId ): TxOutputId {\n    //@ts-expect-error on this type probe\n    if (arg.kind == \"TxOutputId\") return arg;\n\n    if (arg instanceof StellarTxnContext) {\n        const { txId, idx } = arg.getSeedUtxoDetails();\n        return makeTxOutputId(txId, idx);\n    }\n    //@ts-expect-error on this type probe\n    if (arg.idx && arg.txId) {\n        const attr: SeedAttrs = arg as SeedAttrs;\n        return makeTxOutputId(attr.txId, attr.idx);\n    }\n    const txoIdLike = arg as Exclude<typeof arg, SeedAttrs>;\n    return makeTxOutputId(txoIdLike);\n}\n","import type { TypeSchema } from \"@helios-lang/type-utils\";\nimport { type Cast, makeCast } from \"@helios-lang/contract-utils\";\nimport { type TxOutputId } from \"@helios-lang/ledger\";\nimport type { UplcData } from \"@helios-lang/uplc\";\n\nimport type { readsUplcData } from \"../HeliosMetaTypes.js\";\nimport type { EnumBridge } from \"./EnumBridge.js\";\nimport type { readsUplcTo } from \"./BridgeTypes.js\";\nimport { getSeed, type hasSeed, type SeedAttrs } from \"../../ActivityTypes.js\";\n\n// const rawDataMakerProxy = new Proxy(\n//     {},\n//     {\n//         // cases to cover:\n//         // 1. type is an enum, accessor is a tagOnly field\n//         //     -> instantiate the right constrData through the cast(   { variantName:{} )\n//         // 2. type is an enum, accessor is a singletonField\n//         //   2a. nested field is an enum\n//         //      -> returns a proxy for the nested enum type,\n//         //           ... with seed semantics and NO {redeemer: } wrapper\n//         //   2b. nested field not an enum\n//         //     -> returns a function that takes the field value and calls cast ( { variantName: { fieldName: value } } )\n//         // 3. type is an enum, accessor has fields\n//         //    -> returns a function that takes the fields and calls cast ( { variantName: { ...fields } } )\n//         // 4. type is not an enum.\n//         //   -> the apply() trap is called with the arg(s) for filling that data type\n\n//         // if it is an activity, wrap it in a {redeemer: } object\n//         // ... to satisfy the isActivity type\n\n//         get(_, typeName : string | Symbol, THIS : DataBridge) {\n//             // throw new Error(`dataMaker ${DMP.constructor.name}: GET: ${typeName}`)\n//             const {__typeDetails: typeDetails, __schema: schema, __cast: cast} = THIS;\n//             // const {dataType} = typeDetails;\n//             if (\"string\" !== typeof typeName) {\n//                 // if the symbol is a node-inspector symbol, show the type-details\n//                 if (typeName == Symbol.for(\"nodejs.util.inspect.custom\")) {\n//                     debugger\n//                     return undefined // {DataBridgeProxy:{typeDetails}}\n//                 }\n//                 if (typeName == Symbol.for(\"toString\")) {\n//                     return () => `dataMaker ${THIS.constructor.name} for ${THIS.name}`;\n//                 }\n\n//                 // add any special handling for symbols above.\n//                 throw new Error(`dataMaker ${THIS.constructor.name}: GET(${typeName}) -> null`)\n//                 return null\n//             }\n\n//             switch (schema.kind) {\n//                 case \"enum\":\n//                     const enumSchema = schema\n//                     const variant = enumSchema.variantTypes.find(variant => variant.name === typeName);\n//                     // variants[typeName as keyof typeof enumSchema.variants];\n//                     if (variant) {\n//                         if (variant.fieldTypes.length == 0) {\n//                             return cast.toUplcData({[typeName]: {}});\n//                         }\n//                         if (variant.fieldTypes.length === 1) {\n//                             // todo\n//                         }\n//                         // if (variant.accessor === \"singletonField\") {\n//                         //     const nestedType = variant.nestedType;\n//                         //     if (nestedType.kind === \"enum\") {\n//                         //         return new Proxy({}, {\n//                         //             get(_, nestedTypeName: string | Symbol) {\n//                         //                 const nestedVariant = nestedType.variants[nestedTypeName as keyof typeof nestedType.variants];\n//                         //                 if (!nestedVariant) throw new Error(`dataMaker ${THIS.constructor.name}: GET: ${nestedTypeName} not found in ${nestedType.kind}`);\n//                         //                 return (...args: any[]) => cast.toUplcData({[typeName]: { [nestedTypeName]: args[0] }});\n//                         //             }\n//                         //         });\n//                         //     } else {\n//                         //         return (value: any) => cast.toUplcData({[typeName]: { [variant.name]: value }});\n//                         //     }\n//                         // }\n//                         // if (variant.accessor === \"fields\") {\n//                         //     return (...args: any[]) => cast.toUplcData({[typeName]: { ...args }});\n//                         // }\n//                     }\n//                     throw new Error(`dataMaker ${THIS.constructor.name}: GET: ${typeName} not found in ${schema.kind}`);\n//             }\n//             if (THIS.isStruct) {\n//             }\n\n//         },\n//         apply(_,\n//             THIS : DataBridge,\n//             args : any\n//         ) {\n//             debugger\n//             if (args?.length > 1) throw new Error(`dataMaker APPLY: got ${args.length} args, expected 1`)\n//             // throw new Error(`dataMaker ${DMP.constructor.name} APPLY`)\n\n//             // the only case for an apply trap is when the type is not an enum or struct, but is a single value\n//             if (THIS.isEnum) {\n//                 throw new Error(`dataMaker ${THIS.constructor.name} APPLY invalid on enum ${THIS.__typeName}`)\n//             }\n//             if (THIS.isStruct) {\n//                 throw new Error(`dataMaker ${THIS.constructor.name} APPLY invalid on struct ${THIS.__typeName}`)\n//             }\n//             return THIS.toUplc(args[0])\n//         }\n//     }\n// )\n\n/**\n * @internal\n */\nconst rawDataBridgeProxy = new Proxy(\n    {},\n    {\n        apply(_, THIS: DataBridge, [x]: any[]) {\n            // typescript protects against this code-path being allowed by types, but\n            // this serves javascript-based callers and other run-time scenarios where the type-checking\n            // may not be enforced (SWC and vitest, notably)\n            if (!THIS.isCallable)\n                throw new Error(\n                    `dataBridge ${THIS.constructor.name} is not callable`\n                );\n\n            //x@ts-expect-error drilling through the 'protected' attribute - TS can't know about\n            //x  the relationship between this object and the DataBridge class\n            return THIS.ᱺᱺcast.toUplcData(x);\n        },\n    }\n);\n\n/**\n * @internal\n */\nfunction dataBridgeProxyBase() {}\ndataBridgeProxyBase.prototype = rawDataBridgeProxy;\n\n/**\n * @internal\n */\nexport type DataBridgeOptions = {\n    isMainnet: boolean;\n    isActivity?: boolean;\n    isNested?: boolean;\n};\n\n/**\n * @internal\n */\nexport type callWith<ARGS, T extends DataBridge> = T &\n    ((x: ARGS) => ReturnType<T[\"ᱺᱺcast\"][\"toUplcData\"]>);\n\n/**\n * @internal\n */\nexport class DataBridge extends (dataBridgeProxyBase as typeof Object) {\n    /**\n     * @internal\n     */\n    ᱺᱺschema: TypeSchema;\n    /**\n     * @internal\n     */\n    isMainnet: boolean;\n    /**\n     * @internal\n     */\n    isActivity: boolean;\n    /**\n     * @internal\n     */\n    isNested: boolean;\n    /**\n     * @internal\n     */\n    ᱺᱺcast: Cast<any, any>;\n    /**\n     * @internal\n     */\n    isCallable = false;\n\n    mkData: this[\"ᱺᱺcast\"][\"toUplcData\"] = (x: any) =>\n        this.ᱺᱺcast.toUplcData(x);\n    readData: this[\"ᱺᱺcast\"][\"fromUplcData\"] = (x: any) =>\n        this.ᱺᱺcast.fromUplcData(x);\n\n    constructor(options: DataBridgeOptions) {\n        super();\n        // these start undefined, but are always forced into existence immediately\n        // via getTypeSchema().  Any exceptions means this protocol wasn't followed\n        // correctly.\n        // uses U+1c7a - sorts to the end\n        this.ᱺᱺschema = undefined as any;\n        this.ᱺᱺcast = undefined as any;\n\n        const { isMainnet, isActivity, isNested } = options;\n        this.isMainnet = isMainnet;\n        this.isActivity = isActivity || false;\n        this.isNested = isNested || false;\n    }\n\n    //\n    // declare activity: DataBridge | ((...args:any) => UplcData)\n\n    // declare  datum: DataBridge | ((...args:any) => UplcData)\n    // // get datum() {\n    // //     throw new Error(`each dataBridge makes its own datum`)\n    // // }\n\n    getSeed(arg: hasSeed | TxOutputId): TxOutputId {\n        return getSeed(arg);\n    }\n\n    /**\n     * @internal\n     */\n    redirectTo?: (value: any) => void;\n    /**\n     * @internal\n     */\n    mkDataVia(redirectionCallback: (value: any) => void) {\n        if (!this.isNested) {\n            throw new Error(\n                `dataMaker ${this.constructor.name}: redirectTo is only valid for nested enums`\n            );\n        }\n        this.redirectTo = redirectionCallback;\n    }\n\n    /**\n     * @internal\n     */\n    get isEnum() {\n        return \"enum\" === this.ᱺᱺschema!.kind;\n    }\n    /**\n     * @internal\n     */\n    getTypeSchema() {\n        if (!this.ᱺᱺschema) {\n            this.ᱺᱺschema = \"placeholder\" as any; // this.__typeDetails.dataType.toSchema()\n            this.ᱺᱺcast = makeCast(this.ᱺᱺschema, {\n                isMainnet: this.isMainnet,\n                unwrapSingleFieldEnumVariants: true,\n            });\n        }\n        return this.ᱺᱺschema;\n    }\n    // usesRedeemerWrapper : boolean = false\n\n    // toUplc(x: any) {\n    //     return this.ᱺᱺcast.toUplcData(x)\n    // }\n\n    // get __typeName() : string {\n    //     return \"someTypeName\" // this.__typeDetails.dataType.name\n\n    //     // //@ts-expect-error not all schemas have names\n    //     // const {name=\"\"} = this.ᱺᱺschema!\n    //     // if (!name) {\n    //     //     throw new Error(`can't get typeName for unnamed type: ${this.__schema!.kind}`)\n    //     // }\n    //     // return name\n    // }\n}\n\n/**\n * @public\n */\nexport class ContractDataBridge {\n    static isAbstract: true | false = true as const;\n    isAbstract: true | false = true as const;\n    isMainnet: boolean;\n    declare types: Record<string, DataBridge | ((x: any) => UplcData)>;\n    declare reader: DataBridgeReaderClass | undefined;\n    declare datum: DataBridge | undefined;\n    declare activity: DataBridge;\n    declare readDatum: readsUplcData<any> | undefined;\n\n    constructor(isMainnet: boolean) {\n        if (true !== isMainnet && false !== isMainnet)\n            throw new Error(`isMainnet signal must be provided (boolean)`);\n        this.isMainnet = isMainnet;\n    }\n    readData(x: any) {\n        if (!this.datum) throw new Error(`no datum on this dataBridge`);\n\n        return this.datum.readData(x);\n    }\n}\n\n/**\n * @public\n */\nexport class ContractDataBridgeWithEnumDatum extends ContractDataBridge {\n    static isAbstract: true | false = true as const;\n    isAbstract: true | false = true as const;\n    declare datum: EnumBridge;\n    declare readDatum: readsUplcData<unknown>;\n\n    // constructor(isMainnet : boolean) {\n    //     super(isMainnet);\n    // }\n}\n\n/**\n * @public\n */\nexport class ContractDataBridgeWithOtherDatum extends ContractDataBridge {\n    static isAbstract: true | false = true as const;\n    isAbstract: true | false = true as const;\n    // declare datum: (any) => UplcData;\n    // constructor() {\n    //     super();\n    // }\n    declare readDatum: readsUplcData<unknown>;\n}\n// type DataBridgeReader = DataBridgeReaderClass & {\n//     [key: string]: (x : UplcData) => any\n// }\n\n/**\n * @public\n */\nexport class DataBridgeReaderClass {\n    declare datum: readsUplcTo<unknown> | undefined;\n}\n","import {\n    makeAddress,\n    makeTxOutput,\n    makeValidatorHash,\n    type Address,\n    type MintingPolicyHash,\n    type NetworkParams,\n    type TxInput,\n    type ValidatorHash,\n    type Value,\n    makeMintingPolicyHash,\n    makeInlineTxOutputDatum,\n    type TxOutputId,\n} from \"@helios-lang/ledger\";\n\nimport type {\n    CardanoClient,\n    Emulator,\n    TxChainBuilder,\n    Wallet,\n} from \"@helios-lang/tx-utils\";\nimport type { UplcProgramV3, UplcData } from \"@helios-lang/uplc\";\nimport type { DataType, Program, EnumMemberType } from \"@helios-lang/compiler\";\n\nimport {\n    StellarTxnContext,\n    type TxDescription,\n    type hasSeedUtxo,\n} from \"./StellarTxnContext.js\";\nimport { betterJsonSerializer } from \"./diagnostics.js\";\nimport type {\n    anyUplcProgram,\n    InlineDatum,\n    valuesEntry,\n} from \"./HeliosPromotedTypes.js\";\nimport type { Capo } from \"./Capo.js\";\nimport { UtxoHelper, type utxoPredicate } from \"./UtxoHelper.js\";\n// import { CachedHeliosProgram } from \"./helios/CachedHeliosProgram.js\";\n// import { uplcDataSerializer } from \"./delegation/jsonSerializers.js\";\nimport { HeliosScriptBundle } from \"./helios/scriptBundling/HeliosScriptBundle.js\";\nimport { type HeliosBundleClass } from \"./helios/HeliosMetaTypes.js\";\nimport {\n    DataBridge,\n    ContractDataBridge,\n    DataBridgeReaderClass,\n    ContractDataBridgeWithOtherDatum,\n    ContractDataBridgeWithEnumDatum,\n} from \"./helios/dataBridge/DataBridge.js\";\nimport type { possiblyAbstractContractBridgeType } from \"./helios/dataBridge/BridgeTypes.js\";\nimport type { findReadDatumType } from \"./helios/dataBridge/BridgeTypes.js\";\nimport type { mustFindConcreteContractBridgeType } from \"./helios/dataBridge/BridgeTypes.js\";\nimport type { AbstractNew } from \"./helios/typeUtils.js\";\nimport { getSeed, type hasSeed, type SeedAttrs } from \"./ActivityTypes.js\";\nimport { makeCast } from \"@helios-lang/contract-utils\";\nimport type {\n    DeployedProgramBundle,\n    SerializedHeliosCacheEntry,\n} from \"./helios/CachedHeliosProgram.js\";\nimport type { DeployedScriptDetails } from \"./configuration/DeployedScriptConfigs.js\";\nimport type { TxBatcher } from \"./networkClients/TxBatcher.js\";\nimport { bytesToHex } from \"@helios-lang/codec-utils\";\n\ntype NetworkName = \"testnet\" | \"mainnet\";\nlet configuredNetwork: NetworkName | undefined = undefined;\n\n/**\n * @public\n */\nexport function isUplcData(x: any): x is UplcData {\n    return \"kind\" in x && \"toCbor\" in x;\n}\n\n/**\n * @public\n */\ntype WalletsAndAddresses = {\n    wallets: Wallet[];\n    addresses?: Address[];\n};\n/**\n * Type for the Class that constructs to a given type\n * @remarks\n *\n * Type of the matching literal class\n *\n * note: Typescript should make this pattern easier\n *\n * @typeParam S - the type of objects of this class\n * @typeParam CT - inferred type of the constructor args for the class\n * @public\n **/\nexport type stellarSubclass<S extends StellarContract<any>> = (new (\n    setup: SetupInfo\n) => S) & {\n    // & StellarContract<CT>\n    defaultParams: Partial<ConfigFor<S>>;\n    createWith(args: StellarSetupDetails<ConfigFor<S>>): Promise<S>;\n    parseConfig(rawJsonConfig: any): any;\n};\n\n/**\n * Properties for Datum structures for on-chain scripts\n * @public\n **/\nexport type anyDatumProps = Record<string, any>;\n/**\n * Configuration details for StellarContract classes\n * @public\n **/\nexport interface configBaseWithRev {\n    rev: bigint;\n}\n\n/**\n * @public\n */\nexport type UplcRecord<CT extends configBaseWithRev> = {\n    [key in keyof CT]: UplcData;\n};\n\n/**\n * Decorators for on-chain activity (redeemer) factory functions\n * @public\n **/\nexport const Activity = {\n    /**\n     * Decorates a partial-transaction function that spends a contract-locked UTxO using a specific activity (\"redeemer\")\n     * @remarks\n     *\n     * activity-linked transaction-partial functions must follow the txn\\{...\\}\n     * and active-verb (\"ing\") naming conventions.  `txnRetiringDelegation`,\n     * `txnModifyingVote` and `txnWithdrawingStake` would be examples\n     * of function names following this guidance.\n     *\n     * @public\n     **/\n    partialTxn(proto, thingName, descriptor) {\n        needsActiveVerb(thingName);\n        return partialTxn(proto, thingName, descriptor);\n    },\n\n    /**\n     * Decorates a factory-function for creating tagged redeemer data for a specific on-chain activity\n     * @remarks\n     *\n     * The factory function should follow an active-verb convention by including \"ing\" in\n     * the name of the factory function\n     *\n     * Its leading prefix should also match one of 'activity', 'burn', or 'mint'.  These\n     * conventions don't affect the way the activity is verified on-chain, but they\n     * provide guard-rails for naming consistency.\n     * @public\n     **/\n    redeemer(\n        proto,\n        thingName,\n        descriptor\n        // todo: improve this type, so the decorated function is type-checked for returning an isActivity object\n        // : {value: (...args: any[])  => isActivity<any>}\n    ) {\n        const isActivity = thingName.match(/^activity[A-Z]/);\n        const isBurn = thingName.match(/^burn[A-Z]/);\n        const isMint = thingName.match(/^mint[A-Z]/);\n\n        if (!isActivity && !isBurn) {\n            throw new Error(\n                `@Activity.redeemer: ${thingName}: name should start with '(activity|burn|mint)[A-Z]...'`\n            );\n        }\n        needsActiveVerb(thingName, /* show workaround offer */ true);\n        return Activity.redeemerData(proto, thingName, descriptor);\n    },\n    redeemerData(proto, thingName, descriptor) {\n        //!!! todo: registry and cross-checking for missing redeeming methods\n\n        //!!! todo: develop more patterns of \"redeemer uses an input of a certain mph/value\"\n        return descriptor;\n    },\n};\n\nfunction needsActiveVerb(thingName: string, okWorkaround?: boolean) {\n    if (!thingName.match(/ing/)) {\n        const orWorkaround =\n            okWorkaround &&\n            \"(or work around with @Activity.redeemerData instead)\";\n        throw new Error(\n            `Activity: ${thingName}: name should have 'ing' in it ${orWorkaround}`\n        );\n    }\n    if (thingName.match(/^ing/)) {\n        throw new Error(\n            `Activity: ${thingName}: name shouldn't start with 'ing'`\n        );\n    }\n}\n\n/**\n * Decorates datum-building functions\n * @remarks\n *\n * function names must follow the mkDatum... convention.\n *\n * The function should accept a single argument with input type\n * that feels Typescripty, and that can be fit to the on-chain type of\n * the underlying Datum variant of the given name.\n *\n * @public\n **/\nexport function datum(proto, thingName, descriptor) {\n    // console.log(\"+datum\", proto.constructor.name, thingName || \"none\", descriptor.value.name )\n    if (!thingName.match(/^mkDatum/)) {\n        throw new Error(\n            `@datum factory: ${thingName}: name should start with 'mkDatum...'`\n        );\n    }\n    return descriptor;\n}\n\n/**\n * Decorates functions that can construct a new transaction context for a specific use-case\n * @remarks\n *\n * function names must follow the mkTxn... convention.\n * @public\n **/\nexport function txn(proto, thingName, descriptor) {\n    // console.log(\"+datum\", proto.constructor.name, thingName || \"none\", descriptor.value.name )\n    if (!thingName.match(/^mkTxn/)) {\n        throw new Error(\n            `@txn factory: ${thingName}: name should start with 'mkTxn...'`\n        );\n    }\n    return descriptor;\n}\n\n/**\n * decorates functions that increment a transaction by adding needed details for a use-case\n * @remarks\n *\n * Function names must follow the txn\\{...\\} naming convention. Typical partial-transaction names\n * may describe the semantics of how the function augments the transaction.\n * `txnAddSignatures` or `txnReceivePayment` could be example names following\n * this guidance\n *\n * Partial transactions should have a \\<TCX extends StellarTxnContext\\<...\\>\\> type parameter,\n * matched to its first function argument, and should return a type extending that same TCX,\n * possibly with additional StellarTxnContext\\<...\\> type info.\n *\n * The TCX constraint can specify key requirements for an existing transaction context when\n * that's relevant.\n *\n * @public\n **/\nexport function partialTxn(proto, thingName, descriptor) {\n    // console.log(\"+datum\", proto.constructor.name, thingName || \"none\", descriptor.value.name )\n    if (!thingName.match(/^txn[A-Z]/)) {\n        let help = \"\";\n        if (thingName.match(/^mkTxn/)) {\n            help = `\\n  ... or, for transaction initiation with mkTxn, you might try @txn instead. `;\n        }\n        throw new Error(\n            `@partialTxn factory: ${thingName}: should start with 'txn[A-Z]...'${help}`\n        );\n    }\n    return descriptor;\n}\n\n/**\n * @public\n */\nexport async function findInputsInWallets(\n    v: Value,\n    searchIn: WalletsAndAddresses,\n    network: CardanoClient\n): Promise<TxInput<any>> {\n    const { wallets, addresses } = searchIn;\n\n    const lovelaceOnly = v.assets.isZero();\n    console.warn(\"finding inputs\", {\n        lovelaceOnly,\n    });\n\n    for (const w of wallets) {\n        const [a] = await w.usedAddresses;\n        console.log(\"finding funds in wallet\", a.toString().substring(0, 18));\n        const utxos = await w.utxos;\n        for (const u of utxos) {\n            if (lovelaceOnly) {\n                if (u.value.assets.isZero() && u.value.lovelace >= v.lovelace) {\n                    return u as any;\n                }\n                console.log(\"  - too small; skipping \", u.value.dump());\n            } else {\n                if (u.value.isGreaterOrEqual(v)) {\n                    return u as any;\n                }\n            }\n        }\n    }\n    if (lovelaceOnly) {\n        throw new Error(\n            `no ADA is present except those on token bundles.  TODO: findFreeLovelaceWithTokens`\n        );\n        // const spareChange = this.findFreeLovelaceWithTokens(v, w)\n    }\n    //!!! todo: allow getting free ada from a contract address?\n\n    if (addresses) {\n        for (const a of addresses) {\n            const utxos = await network.getUtxos(a);\n            for (const u of utxos) {\n                if (u.value.isGreaterOrEqual(v)) {\n                    return u as any;\n                }\n            }\n        }\n    }\n\n    throw new Error(\n        `None of these wallets${\n            (addresses && \" or addresses\") || \"\"\n        } have the needed tokens`\n    );\n}\n\n/**\n * @public\n */\nexport type HeliosOptimizeOptions = Exclude<\n    Pick<\n        Exclude<Parameters<Program[\"compile\"]>[0], undefined | boolean>,\n        \"optimize\"\n    >[\"optimize\"],\n    undefined | boolean\n>;\n\n/**\n * @public\n */\nexport type UtxoDisplayCache = Map<TxOutputId, string>;\n/**\n * standard setup for any Stellar Contract class\n * @public\n **/\nexport type SetupInfo = {\n    /** access to ledger: utxos, txn-posting; can sometimes be a TxChainBuilder overlay on the real network */\n    network: CardanoClient | Emulator;\n    /** the actual network client; never a TxChainBuilder */\n    chainBuilder?: TxChainBuilder;\n    /** the params for this network */\n    networkParams: NetworkParams;\n    /** collects a batch of transactions, connected with a TxChainBuilder in context */\n    txBatcher: TxBatcher;\n    /** false for any testnet.  todo: how to express L2? */\n    isMainnet: boolean;\n    /** wallet-wrapping envelope, allows wallet-changing without reinitializing anything using that envelope */\n    actorContext: ActorContext;\n    /** testing environment? */\n    isTest?: boolean;\n    /** helper for finding utxos and related utility functions */\n    uh?: UtxoHelper;\n    /** global setting for script-compile optimization, only used when a compilation is triggered, can be overridden per script-bundle  */\n    optimize?: boolean | HeliosOptimizeOptions;\n    /** presentation-cache indicates utxos whose details have already been emitted to the console */\n    uxtoDisplayCache?: UtxoDisplayCache;\n};\n\n/**\n * @public\n * Extracts the config type for a Stellar Contract class\n **/\nexport type ConfigFor<SC extends StellarContract<any>> = configBaseWithRev &\n    SC extends StellarContract<infer inferredConfig>\n    ? inferredConfig\n    : never;\n\n/**\n * Initializes a stellar contract class\n * @remarks\n *\n * Includes network and other standard setup details, and any configuration needed\n * for the specific class.\n * @public\n **/\nexport type StellarSetupDetails<CT extends configBaseWithRev> = {\n    setup: SetupInfo;\n    config?: CT;\n    partialConfig?: Partial<CT>;\n    programBundle?: DeployedProgramBundle;\n    previousOnchainScript?: {\n        validatorHash: number[];\n        uplcProgram: anyUplcProgram;\n    };\n};\n\nexport type SetupOrMainnetSignalForBundle = Partial<\n    Omit<SetupInfo, \"isMainnet\">\n> &\n    Required<Pick<SetupInfo, \"isMainnet\">> & { isPlaceholder?: any };\n\nexport type StellarBundleSetupDetails<CT extends configBaseWithRev> = {\n    setup: SetupOrMainnetSignalForBundle;\n    placeholderAt?: string;\n    previousOnchainScript?: {\n        validatorHash: number[];\n        uplcProgram: anyUplcProgram;\n    };\n    params?: CT;\n    /**\n     * used only for Capo bundles, to initialize them based on\n     * their `.hlDeploy.<network>.json` config file\n     */\n    deployedDetails?: DeployedScriptDetails<CT>;\n    // partialConfig?: Partial<UplcRecord<CT>>;\n    variant?: string;\n};\n\ntype scriptPurpose =\n    | \"testing\"\n    | \"minting\"\n    | \"spending\"\n    | \"staking\"\n    | \"module\"\n    | \"endpoint\"\n    | \"non-script\";\n\ntype ComputedScriptProperties = Partial<{\n    vh: ValidatorHash;\n    addr: Address;\n    mph: MintingPolicyHash;\n    program: Program;\n    identity: string;\n}>;\n\n/**\n * @public\n */\nexport type ActorContext<WTP extends Wallet = Wallet> = {\n    wallet?: WTP;\n};\n/**\n * @public\n */\nexport type NetworkContext<NWT extends CardanoClient = CardanoClient> = {\n    network: NWT;\n};\n\n/**\n * Basic wrapper and off-chain facade for interacting with a single Plutus contract script\n * @remarks\n *\n * This class is normally used only for individual components of a higher-level {@link Capo | Capo or Leader contract},\n * which act as delegates within its application context.  Nonetheless, it is the base class for every Capo as well as\n * simpler contract scripts.\n *\n * The StellarContract class serves as an off-chain facade for transaction-building and interfacing to any on-chain\n * contract script.  Each StellarContract subclass must define a `contractSource()`, which is currently a Helios-language\n * script, compiled in any Javascript environment to an on-chain executable UPLC or \"plutus core\" form.  This enables\n * a static dApp to be self-sovereign, without need for any server (\"application back-end\") environment.\n *\n * @typeParam ConfigType - schema for the configuration needed for creating or reproducing a\n * specific instance of the contract script on-chain.\n *\n * @public\n **/\nexport class StellarContract<\n    // SUB extends StellarContract<any, ParamsType>,\n    ConfigType extends configBaseWithRev\n> {\n    //! it has scriptProgram: a parameterized instance of the contract\n    //  ... with specific `parameters` assigned.\n    // bundle?: HeliosScriptBundle;\n    configIn?: ConfigType;\n    partialConfig?: Partial<ConfigType>;\n    // contractParams?: UplcRecord<ConfigType>;\n    setup: SetupInfo;\n    get network(): CardanoClient | Emulator | TxChainBuilder {\n        return this.setup.chainBuilder || this.setup.network;\n    }\n\n    networkParams: NetworkParams;\n    actorContext: ActorContext<any>;\n    // isTest?: boolean\n    static get defaultParams() {\n        return {};\n    }\n    static parseConfig(rawJsonConfig: any) {\n        throw new Error(\n            `Stellar contract subclasses should define their own static parseConfig where needed to enable connection from a specific dApp to a specific Stellar Contract.`\n        );\n    }\n\n    /** each StellarContracts subclass needs to provide a scriptBundle class.\n     * @remarks\n     * Your script bundle MUST be defined in a separate file using a convention of\n     * `‹scriptName›.hlb.ts`, and exported as a default class.  It should inherit\n     * from HeliosScriptBundle or one of its subclasses.  Stellar Contracts processes\n     * this file, analyzes the on-chain types defined in your Helios sources, and generates\n     * Typescript types and a data-bridging class for your script.\n     *\n     * Once the data-bridge class is generated, you should import it into your contract\n     * module and assign it to your `dataBridgeClass` attribute.\n     */\n    scriptBundle(): HeliosScriptBundle {\n        debugger; // eslint-disable-line no-debugger - keep for downstream troubleshooting\n        throw new Error(\n            `${this.constructor.name}: missing required implementation of scriptBundle()\\n` +\n                `...each Stellar Contract must provide a scriptBundle() method. \\n` +\n                `It should return an instance of a class defined in a *.hlb.ts file.  At minimum:\\n\\n` +\n                `    export default class MyScriptBundle extends HeliosScriptBundle { ... }\\n` +\n                ` or export default CapoDelegateBundle.usingCapoBundleClass(SomeCapoBundleClass) { ... }\\n\\n` +\n                `We'll generate TS types and other utilities for connecting to the data-types in your Helios sources.\\n` +\n                `Your scriptBundle() method can return \\`MyScriptBundle.create();\\``\n        );\n    }\n\n    /**\n     * the dataBridgeClass attribute MUST be defined for any bundle having a datum type\n     *  - this is the bridge class for converting from off-chain data types to on-chain data\n     *  - it provides convenient, type-safe interfaces for doing that\n     *\n     * @remarks\n     * Minters don't have datum, so they don't need to define this attribute.  However,\n     * note that ***mint delegates*** do in fact have datum types. If you are defining\n     * a custom delegate of that kind, you will need to define this attribute.\n     */\n    dataBridgeClass: AbstractNew<ContractDataBridge> | undefined = undefined;\n\n    /**\n     * The `onchain` object provides access to all bridging capabilities for this contract script.\n     * @remarks\n     * Its nested attributes include:\n     *  - `types` - a collection of all the on-chain types defined in the script, with data-creation helpers for each\n     *  - `activity` - a creation helper for the activities/redeemers defined in the script\n     *\n     * Scripts that use datum types (not including minters) will also have:\n     *  - `datum` - a data-creation helper for the datum type of the script\n     *  - `readDatum` - a data-reading helper for the datum type of the script\n     *\n     * ### Low-level type access\n     * For low-level access (it's likely you don't need to use this) for on-chain types, the `reader` attribute (aka `offchain`) exists: .\n     *  - `reader` - a collection of data-reading helpers for the on-chain types, given UPLC data known to be of that type\n     * @public\n     */\n    get onchain(): possiblyAbstractContractBridgeType<this> {\n        return this.getOnchainBridge();\n    }\n\n    /**\n     * The `offchain` object provides access to readers for the on-chain types of this contract script.\n     * @remarks\n     * Its nested attributes include all the on-chain types defined in the script, with data-reading helpers for each.\n     * This is useful for reading on-chain data in off-chain code.\n     *\n     * ### Warning: low-level typed-data access!\n     *\n     * Note that these readers will work properly with UPLC data known to be of the correct type.  If you\n     * encounter errors related to these results, it's likely you are using the wrong reader for the data you\n     * have in hand.\n     *\n     * For the typical use-case of reading the datum type from a UTxO held in the contract, this is not a problem,\n     * and note that the `readDatum` helper provides a shortcut for this most-common use-case.\n     *\n     * If you're not sure what you're doing, it's likely that this is not the right tool for your job.\n     * @public\n     */\n    get offchain(): possiblyAbstractContractBridgeType<this>[\"reader\"] {\n        // ensures the dataBridge is initialized by accessing the 'onchain' getter\n        // accesses its data-reader.\n        return this.getOnchainBridge().reader;\n    }\n\n    get reader(): possiblyAbstractContractBridgeType<this>[\"reader\"] {\n        // ensures the dataBridge is initialized by accessing the 'onchain' getter\n        // accesses its data-reader.\n        return this.getOnchainBridge().reader;\n    }\n\n    get activity(): any {\n        const bridge = this.onchain;\n        return bridge.activity as any;\n    }\n\n    /**\n     * Converts UPLC from an on-chain datum object to a typed off-chain datum object.\n     *\n     * Given a **utxo with a datum of the contract's datum type**, this method will convert the UPLC datum\n     * to a typed off-chain datum object.\n     *\n     * ### Standard WARNING\n     *\n     * If the datum's structure is not of the expected type, this method MAY throw an error, or it might\n     * return data that can cause problems somewhere else in your code.  That won't happen if you're\n     * following the guidance above.\n     */\n    get newReadDatum(): findReadDatumType<this> {\n        const bridge = this.getOnchainBridge();\n        //x@ts-expect-error probing for presence\n        const { readDatum } = bridge;\n        if (!readDatum) {\n            throw new Error(\n                `${\n                    (this as any).constructor.name\n                }: this contract script doesn't use datum`\n            );\n        }\n\n        return readDatum;\n    }\n\n    _bundle: HeliosScriptBundle | undefined;\n    getBundle(): HeliosScriptBundle {\n        if (!this._bundle) {\n            this._bundle = this.scriptBundle();\n            if (\n                this._bundle.preCompiled &&\n                !this._bundle.preCompiled.singleton\n            ) {\n            }\n            if (!this._bundle._didInit) {\n                console.warn(\n                    `NOTE: the scriptBundle() method in ${this.constructor.name} isn't\\n` +\n                        `initialized properly; it should use \\`${this._bundle.constructor.name}.create({...})\\`\\n` +\n                        `... instead of \\`new ${this._bundle.constructor.name}({...})\\` `\n                );\n            }\n            // this._bundle.checkDevReload()\n        }\n\n        return this._bundle;\n    }\n\n    /**\n     * Provides access to the script's activities with type-safe structures needed by the validator script.\n     *\n     * @remarks - the **redeemer** data (needed by the contract script) is defined as one or\n     * more activity-types (e.g. in a struct, or an enum as indicated in the type of the last argument to\n     * the validator function).\n     *   - See below for more about ***setup & type-generation*** if your editor doesn't  provide auto-complete for\n     *    the activities.\n     *\n     * ### A terminology note: Activities and Redeemers\n     *\n     * Although the conventional terminology of \"redeemer\" is universally well-known\n     * in the Cardano developer community, we find that defining one or more **activities**,\n     * with their associated ***redeemer data***, provides an effective semantic model offering\n     * better clarity and intution.\n     *\n     * Each type of contract activity corresponds to an enum variant in the contract script.\n     * For each of those variants, its redeemer data contextualizes the behavior of the requested\n     * transaction.  A non-enum redeemer-type implies that there is only one type of activity.\n     *\n     * Any data not present in the transaction inputs or outputs, but needed for\n     * specificity of the requested activity, can only be provided through these activity details.\n     * If that material is like a \"claim ticket\", it would match the \"redeemer\" type of labeling.\n     *\n     * Activity data can include any kinds of details needed by the validator: settings for what it\n     * is doing, options for how it is being done, or what remaining information the validator may\n     * need, to verify the task is being completed according to protocol.  Transactions containing\n     * a variety of inputs and output, each potential candidates for an activity, can use the activity\n     * details to resolve ambiguity so the validator easily acts on the correct items.\n     *\n     * ### Setup and Type generation\n     * #### Step 1: create your script **`.hlb.ts`**\n     * With a defined script bundle, `import YourScriptNameBundle from \"./YourBundleName.hlb.js\"`\n     * to your StellarContracts class module, and define a `scriptBundle() { return new YourScriptNameBundle() }` or\n     * similar method in that class.\n     *\n     * This results in a generated **`.typeInfo.d.ts`** and **`.bridge.ts`** with complete\n     * typescript bindings for your on-chain script (trouble? check Plugin setup below).\n     *\n     * #### Step 2: Import the generated bridge class\n     * Using the generated .bridge file:\n     * > `import YourScriptNameDataBridge from \"./YourBundleName.bridge.js\"`\n     *\n     * ... and set the `dataBridgeClass` property in your class:\n     *\n     * >    `dataBridgeClass = YourScriptNameDataBridge`\n     *\n     * ### Plugin Setup\n     *\n     * The activity types should be available through type-safe auto-complete in your editor.  If not,\n     * you may need to install and configure the Stellar Contracts rollup plugins for importing .hl\n     * files and generating .d.ts for your .hlb.ts files.  See the Stellar Contracts development\n     * guide for additional details.\n     *\n     */\n    // get activity(): findActivityType<this> {\n    //     const bridge = this.onchain;\n    //     // each specific bridge has to have an activity type, but this code can't\n    //     // introspect that type.  It could be a getter OR a method, and Typescript can only\n    //     // be told it is one, or the other, concretely.\n    //     // findActivityType() does probe for the specific type for specific contracts,\n    //     // at the **interface** level, but this code has no visibility of that.\n\n    //     //x@ts-expect-error accessing it in this way\n    //     const { activity } = bridge\n\n    //     return activity as any\n    // }\n\n    // /**\n    //  * Redirect for intuitive developers having a 'redeemer' habit\n    //  *\n    //  * @deprecated - We recommend using `activity` instead of `redeemer`\n    //  */\n    // get redeemer(): findActivityType<this> {\n    //     return this.activity;\n    // }\n\n    /**\n     * Provides access to the script's defined on-chain types, using a fluent\n     * API for type-safe generation of data conforming to on-chain data formats & types.\n     * @remarks\n     *\n     */\n    _dataBridge?: ContractDataBridge;\n    // get mkDatum() : findDatumType<this> {\n    //     //x@ts-expect-error probing for presence\n    //     if (!this.onchain?.datum) throw new Error(`${this.constructor.name}: no datum is used on this type of script`);\n\n    //     //@ts-expect-error probing for presence\n    //     return this.onchain.datum;\n    // }\n\n    getOnchainBridge(): possiblyAbstractContractBridgeType<this> {\n        if (\"undefined\" == typeof this._dataBridge) {\n            const { dataBridgeClass } = this;\n            if (!dataBridgeClass) {\n                if (this.usesContractScript) {\n                    throw new Error(\n                        `${\n                            this._bundle?.moduleName || this.constructor.name\n                        }: each contract script needs a dataBridgeClass = dataBridge‹YourScriptName›\\n` +\n                            `  ... this dataBridge class is generated by heliosRollupBundler \\n` +\n                            `  ... and imported (\\`import dataBridge‹something› from \"./‹yourScriptName›.bridge.js\"\\`)\\n` +\n                            `      This critical class converts between off-chain and on-chain typed data\\n\\n` +\n                            `Note: if you haven't customized the mint AND spend delegates for your Capo, \\n` +\n                            `  ... you might want to define both of those roles using a single \\n` +\n                            `  ... subclass of the BasicMintDelegate. That fixes the most common \\n` +\n                            `  ... first-time setup problems of this kind.`\n                    );\n                } else {\n                    console.log(\n                        `${this.constructor.name} dataBridgeClass = NONE`\n                    );\n                    this._dataBridge = undefined;\n                    //@ts-expect-error setting to degenerate type\n                    return null;\n                }\n            }\n\n            const datumType = this.getBundle().locateDatumType();\n            const isMainnet = this.setup.isMainnet;\n            let newBridge: any;\n            try {\n                newBridge = new (dataBridgeClass as any)(\n                    isMainnet ?? false\n                ) as any;\n            } catch (e) {\n                console.error(e);\n                debugger;\n            }\n            if (datumType) {\n                // verifies that the dataBridge ALSO has a datum-type\n                console.log(\n                    `${this.constructor.name} dataBridgeClass = `,\n                    dataBridgeClass.name\n                );\n                if (!newBridge.datum) {\n                    console.warn(\n                        `${this.constructor.name}: dataBridgeClass must define a datum accessor.  This is likely a code-generation problem.`\n                    );\n                }\n            }\n            // verifies that every dataBridge has an activity-type\n            if (!newBridge.activity) {\n                console.warn(\n                    `${this.constructor.name}: dataBridgeClass must define an activity accessor.  This is likely a code-generation problem.`\n                );\n            }\n            if (\"undefined\" == typeof isMainnet) {\n                return newBridge;\n            }\n\n            return (this._dataBridge = newBridge);\n        }\n\n        if (!this._dataBridge) {\n            throw new Error(\n                `${this.constructor.name}: this contract script doesn't have a dataBridgeClass defined`\n            );\n        }\n        //@ts-expect-error - the type we show externally is fine, given the above logic.\n        // It's not worth hoop-jumping to make TS perfectly happy with how the sausage is made.\n        return this._dataBridge;\n    }\n\n    ADA(n: bigint | number): bigint {\n        const bn =\n            \"number\" == typeof n\n                ? BigInt(Math.round(1_000_000 * n))\n                : ((BigInt(1_000_000) * n) as bigint);\n        return bn;\n    }\n\n    get isConfigured(): boolean {\n        return !!this.configIn;\n    }\n\n    get isConnected() {\n        return this.isConfigured && !!this.wallet;\n    }\n\n    /**\n     * returns the wallet connection used by the current actor\n     * @remarks\n     *\n     * Throws an error if the strella contract facade has not been initialized with a wallet in settings.actorContext\n     * @public\n     **/\n    get wallet() {\n        if (!this.actorContext.wallet) throw new Error(this.missingActorError);\n        return this.actorContext.wallet;\n    }\n\n    get missingActorError(): string {\n        return `Wallet not connected to Stellar Contract '${this.constructor.name}'`;\n    }\n\n    /**\n     * Transforms input configuration to contract script params\n     * @remarks\n     * May filter out any keys from the ConfigType that are not in the contract\n     * script's params.  Should add any keys that may be needed by the script and\n     * not included in the ConfigType (as delegate scripts do with `delegateName`).\n     */\n    getContractScriptParams(\n        config: ConfigType\n    ): Partial<ConfigType> & Required<Pick<ConfigType, \"rev\">> {\n        return config;\n    }\n\n    delegateReqdAddress(): false | Address {\n        return this.address;\n    }\n    delegateAddrHint(): Address[] | undefined {\n        return undefined;\n    }\n\n    walletNetworkCheck?: Promise<NetworkName> | NetworkName;\n    /**\n     * Factory function for a configured instance of the contract\n     * @remarks\n     *\n     * Due to boring details of initialization order, this factory function is needed\n     * for creating a new instance of the contract.\n     * @param args - setup and configuration details\n     * @public\n     **/\n    static async createWith<\n        thisType extends StellarContract<configType>,\n        configType extends configBaseWithRev = thisType extends StellarContract<\n            infer iCT\n        >\n            ? iCT\n            : never\n    >(\n        this: stellarSubclass<any>,\n        args: StellarSetupDetails<configType>\n    ): Promise<StellarContract<configType> & InstanceType<typeof this>> {\n        const Class = this;\n        const {\n            setup,\n            config,\n            partialConfig,\n            previousOnchainScript: program,\n        } = args;\n        const c: StellarContract<configType> = new Class(setup);\n\n        // now all internal property assignments have been triggered,\n        //  (e.g. class-level currentRev = .... declarations)\n        // so we can do initialization activities post-construction\n        return c.init(args);\n    }\n    /**\n     * obsolete public constructor.  Use the createWith() factory function instead.\n     *\n     * @public\n     **/\n    constructor(setup: SetupInfo) {\n        this.setup = setup;\n        this._utxoHelper = new UtxoHelper(this.setup, this);\n        setup.uh = this._utxoHelper;\n\n        // console.log(new Error(`\\n  in ${this.constructor.name}`).stack!.split(\"\\n\").slice(1).join(\"\\n\"));\n\n        const { networkParams, isTest, isMainnet, actorContext } = setup;\n        this.actorContext = actorContext;\n        // helios.config.set({ IS_TESTNET: !isMainnet }); use for TxBuilderConfig from this.setup.isMainnet\n        this.networkParams = networkParams;\n        // this.isTest = isTest\n    }\n\n    get canPartialConfig() {\n        return false;\n    }\n    /**\n     * performs async initialization, enabling an async factory pattern\n     * @remarks\n     * This method is called by the createWith() factory function, and should not be called directly.\n     *\n     *\n     */\n    async init(args: StellarSetupDetails<ConfigType>) {\n        const { isMainnet, actorContext } = this.setup;\n        const chosenNetwork = isMainnet ? \"mainnet\" : \"testnet\";\n\n        if (\"undefined\" !== typeof configuredNetwork) {\n            if (configuredNetwork != chosenNetwork) {\n                console.warn(\n                    `Possible CONFLICT:  previously configured as ${configuredNetwork}, while this setup indicates ${chosenNetwork}` +\n                        `\\n   ... are you or the user switching between networks?`\n                );\n            }\n        }\n        configuredNetwork = chosenNetwork;\n        if (actorContext.wallet) {\n            const walletIsMainnet = await actorContext.wallet.isMainnet();\n            const foundNetwork = walletIsMainnet\n                ? \"mainnet\"\n                : \"a testnet (preprod/preview)\";\n            const chosenNetworkLabel = isMainnet\n                ? \"mainnet\"\n                : \"a testnet (preprod/preview)\";\n            if (walletIsMainnet !== isMainnet) {\n                const message = `The wallet is connected to ${foundNetwork}, doesn't match this app's target network  ${chosenNetworkLabel}`;\n                if (chosenNetwork == \"mainnet\") {\n                    console.log(\n                        `${message}\\n   ... have you provided env.TESTNET to the build to target a testnet?`\n                    );\n                }\n                throw new Error(message);\n            }\n            // redundant\n            this.actorContext = actorContext;\n        }\n\n        // the config comes from...\n        //  - a Stellar SaaSaaS configuration handle\n        //      - has a SaaS application id\n        //      - maps domain name to a specific SaaS instance for that SaaS app\n        //      - resolves to a Capo Configuration structure\n        //  - a Capo Configuration structure created in Stellar SaaS, with...\n        //      - Capo minter's seed-txn/mph/rev\n        //          - seed txn == a utxo in Stellar SaaS contract\n        //          - in this case, there is also args.programBundle, provided by\n        //            the Capo's init(), via its connectMintingScript().\n        //      - Capo's mph/rev & script hash\n        //      - each delegate's {rev, delegateName, isMint/Spend/DataPolicy} details\n        //          - a script hash for the delegate's script, can be cross-checked with the on-chain version\n        //          - possibly an \"upgrade from ... \" {rev} for strong signals of need to update\n        //      - materialized in code bundle and/or dApp's localStorage/indexedDB\n        //          - with CBOR scripts ready to use\n        //  - (temporary) a similar configuration structure included with the dApp, where supported\n        //  - (temporary) a null configuration for testnet deployment\n        //      - the dApp will generate a config structure to be deployed\n        //      - ... using a seed txn selected from the creator's wallet (for a Capo Minter in testnet)\n        //  - low-level bootstrap details for emulator & automated-testing\n        //      - using a seed txn from emulated environment's wallet\n        //      - the minter MPH (for a Capo)\n        //      - derived details for delegates\n\n        const {\n            config,\n            partialConfig,\n            programBundle,\n            previousOnchainScript,\n            previousOnchainScript: { validatorHash, uplcProgram } = {},\n        } = args;\n        this.partialConfig = partialConfig;\n        this.configIn = config;\n\n        if (uplcProgram) {\n            // with a rawProgram, the contract script is used directly\n            // to make a HeliosScriptBundle with that rawProgram\n            // as an override.\n            this._bundle = this.scriptBundle().withSetupDetails({\n                setup: this.setup,\n                previousOnchainScript: previousOnchainScript,\n                // params: this.getContractScriptParams(config),\n                // deployedDetails: {\n                //     config,\n                // },\n            });\n        } else if (config || partialConfig) {\n            //@ts-expect-error on probe for possible but not\n            //   required variant config\n            const variant = (config || partialConfig).variant;\n\n            // const params = this.getContractScriptParams(config);\n            if (this.usesContractScript) {\n                const genericBundle = this.scriptBundle();\n                if (!config) {\n                    // debugger;\n                    console.warn(\n                        `${this.constructor.name}: no config provided`\n                    );\n                }\n                const params =\n                    genericBundle.scriptParamsSource != \"bundle\"\n                        ? config\n                            ? { params: this.getContractScriptParams(config) }\n                            : {}\n                        : {};\n                const deployedDetails = {\n                    config,\n                    programBundle,\n                    // scriptHash,\n                };\n                if (!programBundle) {\n                    console.log(\n                        `  -- 🐞🐞🐞 🐞 ${this.constructor.name}: no programBundle; will use JIT compilation`\n                    );\n                }\n                this._bundle = genericBundle.withSetupDetails({\n                    ...params,\n                    setup: this.setup,\n                    deployedDetails,\n                    variant,\n                });\n                // await this.prepareBundleWithScriptParams(params);\n            } else if (partialConfig) {\n                // if (this.canPartialConfig) {\n                throw new Error(\n                    `${this.constructor.name}: any use case for partial-config?`\n                );\n                this.partialConfig = partialConfig;\n                // this._bundle = this.scriptBundle();\n            }\n            if (this.usesContractScript) {\n                const bundle = this.getBundle();\n                if (!bundle) {\n                    throw new Error(\n                        `${this.constructor.name}: missing required this.bundle for contract class`\n                    );\n                } else if (!bundle.isHeliosScriptBundle()) {\n                    throw new Error(\n                        `${this.constructor.name}: this.bundle must be a HeliosScriptBundle; got ${bundle.constructor.name}`\n                    );\n                }\n                if (bundle.setup && bundle.configuredParams) {\n                    try {\n                        // eager compile for early feedback on errors\n                        this._compiledScript = await bundle.compiledScript(\n                            true\n                        );\n                    } catch (e: any) {\n                        console.warn(\n                            \"while setting compiledScript: \",\n                            e.message\n                        );\n                    }\n                } else if (bundle.setup && bundle.params) {\n                    debugger;\n                    throw new Error(`what is this situation here? (dbpa)`);\n                }\n                console.log(this.program.name, \"bundle loaded\");\n            }\n        } else {\n            const bundle = this.getBundle();\n            if (bundle.isPrecompiled) {\n                console.log(\n                    `${bundle.displayName}: will use precompiled script on-demand`\n                );\n                // this.compiledScript = await bundle.compiledScript();\n            } else if (bundle.scriptParamsSource == \"config\") {\n                console.log(\n                    `${this.constructor.name}: not preconfigured; will use JIT compilation`\n                );\n            } else if (bundle.scriptParamsSource == \"bundle\") {\n                throw new Error(\n                    `missing required on-chain script params in bundle`\n                );\n            }\n            this.partialConfig = partialConfig;\n        }\n\n        return this;\n    }\n\n    _compiledScript!: anyUplcProgram; // initialized in compileWithScriptParams()\n    get compiledScript(): anyUplcProgram {\n        if (!this._compiledScript) {\n            throw new Error(\n                `${this.constructor.name}: compiledScript not yet initialized; call asyncCompiledScript() first`\n            );\n        }\n        return this._compiledScript;\n    }\n\n    async asyncCompiledScript() {\n        const s = await this.getBundle().compiledScript(true);\n        this._compiledScript = s;\n        return s;\n    }\n    usesContractScript: boolean = true;\n\n    get datumType(): DataType {\n        return this.onChainDatumType;\n    }\n\n    /**\n     * @internal\n     **/\n    get purpose(): scriptPurpose {\n        const purpose = this.program.purpose as scriptPurpose;\n        if (!purpose) return \"non-script\";\n        return purpose;\n    }\n\n    get validatorHash() {\n        const { vh } = this._cache;\n        if (vh) return vh;\n        // console.log(this.constructor.name, \"cached vh\", vh?.hex || \"none\");\n\n        // debugger\n        const nvh = this.compiledScript.hash();\n        // console.log(\"nvh\", nvh.hex);\n        // if (vh) {\n        //     if (!vh.eq(nvh)) {\n        //         console.warn(`validatorHash mismatch: ${vh.hex} != ${nvh.hex}`);\n        //         debugger\n        //     }\n        // }\n        return (this._cache.vh = makeValidatorHash(nvh));\n    }\n\n    //  todo: stakingAddress?: Address or credential or whatever;\n\n    get address(): Address {\n        const prevVh = this._bundle?.previousOnchainScript?.validatorHash;\n        if (prevVh) {\n            return makeAddress(this.setup.isMainnet, makeValidatorHash(prevVh));\n        }\n        const { addr } = this._cache;\n        if (addr) return addr;\n        if (!this.validatorHash) {\n            throw new Error(\n                \"This contract isn't yet configured with a validatorHash\"\n            );\n        }\n        console.log(this.constructor.name, \"caching addr\");\n        console.log(\n            \"TODO TODO TODO - ensure each contract can indicate the right stake part of its address\"\n        );\n        console.log(\"and that the onchain part also supports it\");\n        const isMainnet = this.setup.isMainnet;\n        if (\"undefined\" == typeof isMainnet) {\n            throw new Error(\n                `${this.constructor.name}: isMainnet must be defined in the setup`\n            );\n        }\n        const nAddr = makeAddress(isMainnet, this.validatorHash);\n        // this.validatorHash);\n        // console.log(\"nAddr\", nAddr.toBech32());\n        // if (this._address) {\n        //     if (!this._address.eq(nAddr)) {\n        //         console.warn(`address mismatch: ${this._address.toBech32()} != ${nAddr.toBech32()}`);\n        //         debugger\n        //     }\n        // }\n        return (this._cache.addr = nAddr);\n    }\n\n    get mintingPolicyHash() {\n        if (\"minting\" != this.purpose) return undefined;\n        const { mph } = this._cache;\n        if (mph) return mph;\n        // console.log(this.constructor.name, \"_mph\", this._mph?.hex || \"none\");\n        const nMph = makeMintingPolicyHash(this.compiledScript.hash());\n        // console.log(\"nMph\", nMph.hex);\n        // if (this._mph) {\n        //     if (!this._mph.eq(nMph)) {\n        //         console.warn(\n        //             `mintingPolicyHash mismatch: ${this._mph.hex} != ${nMph.hex}`\n        //         );\n        //         debugger\n        //     }\n        // }\n        return (this._cache.mph = nMph);\n    }\n\n    get identity() {\n        const { identity } = this._cache;\n        if (identity) return identity;\n        console.log(this.constructor.name, \"identity\", identity || \"none\");\n\n        let result: string;\n        if (\"minting\" == this.purpose) {\n            const b32 = this.mintingPolicyHash!.toString();\n            //!!! todo: verify bech32 checksum isn't messed up by this:\n            result = b32.replace(/^asset/, \"mph\");\n        } else {\n            result = this.address.toString();\n        }\n        // if (this._identity) {\n        //     if (this._identity != result) {\n        //         console.warn(\n        //             `identity mismatch: ${this._identity} != ${result}`\n        //         );\n        //         debugger\n        //     }\n        // }\n        // console.log(\"nIdentity\", result);\n        return (this._cache.identity = result);\n    }\n\n    //! searches the network for utxos stored in the contract,\n    //  returning those whose datum hash is the same as the input datum\n    async outputsSentToDatum(datum: InlineDatum): Promise<any> /*unused*/ {\n        const myUtxos = await this.network.getUtxos(this.address);\n        throw new Error(`unused`);\n        // const dump = utxosAsString(myUtxos)\n        // console.log({dump})\n        return myUtxos.filter((u) => {\n            return u.output.datum?.hash.isEqual(datum.hash);\n        });\n    }\n\n    /**\n     * Returns the indicated Value to the contract script\n     * @public\n     * @param tcx - transaction context\n     * @param value - a value already having minUtxo calculated\n     * @param datum - inline datum\n     **/\n    //! adds the indicated Value to the transaction;\n    //  ... EXPECTS  the value to already have minUtxo calculated on it.\n    @partialTxn // non-activity partial\n    txnKeepValue(tcx: StellarTxnContext, value: Value, datum: InlineDatum) {\n        tcx.addOutput(makeTxOutput(this.address, value, datum));\n\n        return tcx;\n    }\n\n    /**\n     * Returns all the types exposed by the contract script\n     * @remarks\n     *\n     * Passed directly from Helios; property names match contract's defined type names\n     *\n     * @public\n     **/\n    get onChainTypes(): Program[\"userTypes\"][string] {\n        // compiledScript.userTypes()\n        // const types = { ...this.scriptProgram!.types };\n\n        const scriptNamespace = this.program.name;\n        return this.program.userTypes[scriptNamespace];\n    }\n\n    /**\n     * identifies the enum used for the script Datum\n     * @remarks\n     *\n     * Override this if your contract script uses a type name other than Datum.\n     * @public\n     **/\n    get scriptDatumName() {\n        return \"Datum\";\n    }\n\n    /**\n     * The on-chain type for datum\n     * @remarks\n     *\n     * This getter provides a class, representing the on-chain enum used for attaching\n     * data (or data hashes) to contract utxos the returned type (and its enum variants)\n     * are suitable for off-chain txn-creation override `get scriptDatumName()` if\n     * needed to match your contract script.\n     * @public\n     **/\n    get onChainDatumType(): DataType {\n        return this.getBundle()!.locateDatumType()!;\n    }\n\n    /**\n     * identifies the enum used for activities (redeemers) in the Helios script\n     * @remarks\n     *\n     * Override this if your contract script uses a type name other than Activity.\n     * @public\n     **/\n\n    get scriptActivitiesName() {\n        return \"Activity\";\n    }\n\n    getSeed(arg: hasSeed) {\n        return getSeed(arg);\n    }\n\n    /**\n     * returns the on-chain type for activities (\"redeemers\")\n     * @remarks\n     *\n     * Use mustGetActivityName() instead, to get the type for a specific activity.\n     *\n     * returns the on-chain enum used for spending contract utxos or for different use-cases of minting (in a minting script).\n     * the returned type (and its enum variants) are suitable for off-chain txn-creation\n     * override `get onChainActivitiesName()` if needed to match your contract script.\n     * @public\n     **/\n    get onChainActivitiesType(): DataType {\n        const { scriptActivitiesName: onChainActivitiesName } = this;\n        if (!this._bundle) throw new Error(`no scriptProgram`);\n        const scriptNamespace = this.program.name;\n        const {\n            [scriptNamespace]: { [onChainActivitiesName]: ActivitiesType },\n        } = this.program.userTypes;\n\n        return ActivitiesType;\n    }\n\n    /**\n     * @deprecated - see {@link StellarContract.activityVariantToUplc|this.activityVariantToUplc(variant, data)} instead\n     * Retrieves an on-chain type for a specific named activity (\"redeemer\")\n     * @remarks\n     *\n     * Cross-checks the requested name against the available activities in the script.\n     * Throws a helpful error if the requested activity name isn't present.'\n     *\n     * @param activityName - the name of the requested activity\n     * @public\n     **/\n    mustGetActivity(activityName: string): EnumMemberType | null {\n        const ocat = this.onChainActivitiesType;\n        return this.mustGetEnumVariant(ocat, activityName);\n    }\n\n    /**\n     * asserts the presence of the indicated activity name in the on-chain script\n     * @remarks\n     * The activity name is expected to be found in the script's redeemer enum\n     */\n    mustHaveActivity(activityName: string): EnumMemberType | null {\n        const ocat = this.onChainActivitiesType;\n        if (!(activityName in ocat.typeMembers)) {\n            throw new Error(\n                `${this.constructor.name}: missing required on-chain activity: ${activityName}`\n            );\n        }\n        return this.mustGetEnumVariant(ocat, activityName);\n    }\n\n    activityRedeemer(activityName: string, data?: any) {\n        const activities = this.onChainActivitiesType;\n\n        return {\n            redeemer: this.typeToUplc(activities, {\n                [activityName]: data,\n            }),\n        };\n    }\n\n    activityVariantToUplc(activityName: string, data: any) {\n        const activities = this.onChainActivitiesType;\n\n        return this.typeToUplc(activities, {\n            [activityName]: data,\n        });\n    }\n\n    mustGetEnumVariant(\n        enumType: DataType,\n        variantName: string\n    ): EnumMemberType | null {\n        const { [variantName]: variantType } = enumType.typeMembers;\n\n        if (!variantType) {\n            // const { scriptActivitiesName: onChainActivitiesName } = this;\n            const variantNames: string[] = [];\n            //inspect the properties in `this`, using property descriptors.\n            for (const [name, _] of Object.entries(enumType.typeMembers)) {\n                //Some of them will point to Class definitions.\n                // check if any of those classes inherit from UplcData.\n                debugger;\n                if (isUplcData(enumType[name].prototype)) {\n                    console.warn(\n                        \"\\n\".repeat(8) +\n                            \"------------------------ check enum variant name\",\n                        name\n                    );\n                    debugger;\n                    // if so, add the name to activityNames.\n                    variantNames.push(name);\n                } else {\n                    debugger;\n                    throw new Error(\n                        \"variant names only available via HeliosData : (\"\n                    );\n                }\n            }\n            debugger;\n            //!!! TODO\n            // enumType.name.site.syntaxError(\"yuck\")\n            ///or similar (search: getFilePos())\n            throw new Error(\n                `$${this.constructor.name}: activity/enum-variant name mismatch in ${enumType.name}: variant '${variantName}' unknown\\n` +\n                    ` ... variants in this enum: ${variantNames.join(\", \")}`\n            );\n        }\n        return variantType.asEnumMemberType;\n    }\n\n    inlineDatum(datumName: string, data: any) {\n        return makeInlineTxOutputDatum(\n            this.typeToUplc(this.onChainDatumType, {\n                [datumName]: data,\n            })\n        );\n    }\n\n    /**\n     * provides a temporary indicator of mainnet-ness, while not\n     * requiring the question to be permanently resolved.\n     * @remarks\n     * Allows other methods to proceed prior to the final determination of mainnet status.\n     *\n     * Any code using this path should avoid caching a negative result.  If you need to\n     * determine the actual network being used, getBundle().isMainnet, if present, provides\n     * the definitive answer.  If that attribute is not yet present, then the mainnet status\n     * has not yet been materialized.\n     * @public\n     */\n    isDefinitelyMainnet() {\n        return this.getBundle().isDefinitelyMainnet();\n    }\n\n    paramsToUplc(params: Record<string, any>): UplcRecord<ConfigType> {\n        return this.getBundle().paramsToUplc(params);\n    }\n\n    typeToUplc(type: DataType, data: any, path: string = \"\"): UplcData {\n        return this.getBundle().typeToUplc(type, data, path);\n    }\n\n    get program() {\n        return this.getBundle()!.program;\n    }\n\n    _utxoHelper: UtxoHelper;\n    /**\n     * Provides access to a UtxoHelper instance\n     */\n    get utxoHelper() {\n        return this._utxoHelper;\n    }\n    /**\n     * Provides access to a UtxoHelper instance\n     * @remarks - same as utxoHelper, but with a shorter name\n     */\n    get uh() {\n        return this._utxoHelper;\n    }\n\n    /**\n     * @deprecated - use `tcx.submit()` instead.\n     */\n    async submit(\n        tcx: StellarTxnContext,\n        {\n            signers = [],\n            addlTxInfo = {\n                description: tcx.txnName ? \": \" + tcx.txnName : \"\",\n            },\n        }: {\n            signers?: Address[];\n            addlTxInfo?: Pick<TxDescription<any, any>, \"description\">;\n        } = {}\n    ) {\n        console.warn(\"deprecated: use tcx.submit() instead\");\n        return tcx.buildAndQueue({ signers, addlTxInfo });\n    }\n\n    //!!! todo: implement more and/or test me:\n    // async findFreeLovelaceWithTokens(v: Value, w: Wallet) {\n    // it.todo(\"helps find spare lovelace in tokens\");\n    // it.todo(\"will help harvest spare lovelace in the future if minUtxo is changed\");\n    //     const utxos = await w.utxos;\n    //     const lovelaceOnly = v.assets.isZero();\n    //     //! it finds free lovelace in token bundles, if it can't find free lovelace otherwise\n    //     if (lovelaceOnly) {\n    //         let maxFree: TxInput, minToken: TxInput;\n    //         let minPolicyCount = Infinity;\n\n    //         for (const u of utxos) {\n    //             const policies = u.value.assets.mintingPolicies.length;\n    //             if (policies < minPolicyCount) {\n    //                 minPolicyCount = policies;\n    //                 minToken = u;\n    //             }\n\n    //             const free =\n    //                 u.value.lovelace -\n    //                 u.origOutput.calcMinLovelace(this.networkParams);\n    //             //@ts-ignore\n    //             if (!maxFree) {\n    //                 maxFree = u;\n    //             } else if (free > maxFree!.value.lovelace) {\n    //                 maxFree = u;\n    //             }\n    //         }\n    //     }\n    // }\n\n    _cache: ComputedScriptProperties = {};\n    optimize: boolean = true;\n\n    async prepareBundleWithScriptParams(\n        params: Partial<ConfigType> & Required<Pick<ConfigType, \"rev\">>\n    ) {\n        if (this._compiledScript) {\n            console.warn(\n                \"compileWithScriptParams() called after script compilation already done\"\n            );\n            debugger;\n        }\n        if (!this.usesContractScript) {\n            throw new Error(`avoid this call to begin with?`);\n            return;\n        }\n        if (!params) {\n            throw new Error(`contractParams not set`);\n        }\n\n        let bundle = this.getBundle();\n        // if (bundle.isPrecompiled) {\n        //     debugger;\n        //     console.warn(\n        //         `deployed script shouldn't need to compile (debugging breakpoint available)`\n        //     );\n        // }\n        if (!this.setup) {\n            console.warn(\n                `compileWithScriptParams() called before setup is available`\n            );\n            debugger;\n        }\n\n        if (\n            !bundle.setup ||\n            bundle.setup.isPlaceholder ||\n            !bundle.configuredUplcParams\n        ) {\n            // serves capo's bootstrap in mkTxnMintCharterToken()\n            // also allows delegates to call <bundleClass>.create() without args,\n            // ... and still get the right setup details.\n            bundle = this._bundle = bundle.withSetupDetails({\n                params,\n                setup: this.setup,\n            });\n        }\n        // this._compiledScript = await bundle.compiledScript(true);\n\n        // console.log(\n        //     `       ✅ ${this.constructor.name} ready with scriptHash=`,\n        //     bytesToHex(this.compiledScript.hash())\n        // );\n        this._cache = {};\n    }\n\n    /**\n     * Locates a UTxO locked in a validator contract address\n     * @remarks\n     *\n     * Throws an error if no matching UTxO can be found\n     * @param semanticName - descriptive name; used in diagnostic messages and any errors thrown\n     * @param predicate - filter function; returns its utxo if it matches expectations\n     * @param exceptInTcx - any utxos already in the transaction context are disregarded and not passed to the predicate function\n     * @param extraErrorHint - user- or developer-facing guidance for guiding them to deal with the miss\n     * @public\n     **/\n    //! finds a utxo (\n    async mustFindMyUtxo(\n        semanticName: string,\n        options: {\n            predicate: utxoPredicate;\n            exceptInTcx?: StellarTxnContext;\n            extraErrorHint?: string;\n            utxos?: TxInput[];\n        }\n    ): Promise<TxInput> {\n        const { predicate, exceptInTcx, extraErrorHint, utxos } = options;\n        const { address } = this;\n\n        return this.utxoHelper.mustFindUtxo(semanticName, {\n            predicate,\n            address,\n            exceptInTcx,\n            extraErrorHint,\n            utxos,\n        });\n    }\n\n    /**\n     * Reuses an existing transaction context, or creates a new one with the given name and the current actor context\n     */\n    mkTcx<TCX extends StellarTxnContext>(\n        tcx: StellarTxnContext | undefined,\n        name?: string\n    ): TCX;\n    /**\n     * Creates a new transaction context with the current actor context\n     */\n    mkTcx(name?: string): StellarTxnContext;\n    mkTcx(tcxOrName?: StellarTxnContext | string, name?: string) {\n        const tcx =\n            tcxOrName instanceof StellarTxnContext\n                ? tcxOrName\n                : new StellarTxnContext(this.setup).withName(name || \"\");\n\n        const effectiveName =\n            tcxOrName instanceof StellarTxnContext ? name : tcxOrName;\n\n        if (effectiveName && !tcx.txnName) return tcx.withName(effectiveName);\n        return tcx;\n    }\n\n    /**\n     * Finds a free seed-utxo from the user wallet, and adds it to the transaction\n     * @remarks\n     *\n     * Accepts a transaction context that may already have a seed.  Returns a typed\n     * tcx with hasSeedUtxo type.\n     *\n     * The seedUtxo will be consumed in the transaction, so it can never be used\n     * again; its value will be returned to the user wallet.\n     *\n     * The seedUtxo is needed for UUT minting, and the transaction is typed with\n     * the presence of that seed (found in tcx.state.seedUtxo).\n     *\n     * If a seedUtxo is already present in the transaction context, no additional seedUtxo\n     * will be added.\n     *\n     * If a seedUtxo is provided as an argument, that utxo must already be present\n     * in the transaction inputs; the state will be updated to reference it.\n     *\n     * @public\n     *\n     **/\n    async tcxWithSeedUtxo<TCX extends StellarTxnContext>(\n        tcx: TCX = new StellarTxnContext(this.setup) as TCX,\n        seedUtxo?: TxInput\n    ): Promise<TCX & hasSeedUtxo> {\n        if (\n            //prettier-ignore\n            //@ts-expect-error on this type probe\n            tcx.state && tcx.state.seedUtxo\n        ) {\n            return tcx as TCX & hasSeedUtxo;\n        }\n        if (seedUtxo) {\n            let tcx2 = tcx as TCX & hasSeedUtxo;\n            if (!tcx.inputs.find((utxo) => utxo.isEqual(seedUtxo))) {\n                tcx2 = tcx2.addInput(seedUtxo);\n                // throw new Error(`seedUtxo not found in transaction inputs`);\n            }\n            tcx2.state.seedUtxo = seedUtxo;\n            return tcx2;\n        } else {\n            return this.findUutSeedUtxo([], tcx).then((newSeedUtxo) => {\n                const tcx2 = tcx.addInput(newSeedUtxo) as TCX & hasSeedUtxo;\n                tcx2.state.seedUtxo = newSeedUtxo;\n                return tcx2;\n            });\n        }\n    }\n    async findUutSeedUtxo(uutPurposes: string[], tcx: StellarTxnContext<any>) {\n        const uh = this.utxoHelper;\n        //!!! big enough to serve minUtxo for each of the new UUT(s)\n        const uutSeed = uh.mkValuePredicate(BigInt(13_000_000), tcx);\n        return uh.mustFindActorUtxo(`seed-for-uut ${uutPurposes.join(\"+\")}`, {\n            predicate: uutSeed,\n            exceptInTcx: tcx,\n            extraErrorHint:\n                \"You might need to create some granular utxos in your wallet by sending yourself a series of small transactions (e.g. 15 then 16 and then 17 ADA) as separate utxos/txns\",\n        });\n    }\n}\n","/**\n * Documents one specific requirement\n * @remarks\n *\n * Describes the purpose, details, and implementation mechanism for a single requirement for a unit of software.\n *\n * Also references any other requirements in the host ReqtsMap structure, whose behavior this requirement\n * depends on.  The details of those other dependencies, are delegated entirely to the other requirement, facilitating\n * narrowly-focused capture of for key expectations within each individual semantic expectation of a software unit's\n * behavior.\n * \n * if there are inherited requirements, dependencies on them can be expressed in the `requiresInherited` field.\n *\n * @typeParam reqts - constrains `requires` entries to the list of requirements in the host ReqtsMap structure\n * @public\n **/\nexport type RequirementEntry<reqtName extends string, reqts extends string, inheritedNames extends string | never> = {\n    purpose: string;\n    details: string[];\n    mech: string[];\n    impl?: string; // todo: constrained to method names of the object meeting the requirements\n\n    // excludes the requirement from being referenced as its own dependendcy\n    // excludes inherited reqt names from being referenced as dependencies (use requiresInherited instead)\n    // allows inherited names to reference other inherited names\n    requires?: reqtName extends inheritedNames ? inheritedNames[] : Exclude<reqts, reqtName | inheritedNames>[];\n\n    requiresInherited? : inheritedNames[];\n};\n\nconst TODO = Symbol(\"needs to be implemented\");\n/**\n * tags requirement that aren't yet implemented\n * @public\n **/\nexport type TODO_TYPE = typeof TODO;\n\n/**\n * Describes the requirements for a unit of software\n * @remarks\n *\n * A requirements map is a list of described requirements, in which each requirement\n * has a synopsis, a description of its purpose, descriptive detail, and technical requirements\n * for the mechanism used for implementation.  The mech strings should be usable as unit-test titles.\n *\n * use the hasReqts() helper method to declare a type-safe set of requirements following this data structure.\n *\n * Each requirement also has space for nested 'requires', without the need for deeply nested data structures;\n * these reference other requirements in the same hasReqts() data structure. As a result, high-level and detail-\n * level requirements and 'impl' details can have progressive levels of detail.\n *\n * @typeParam reqts - the list of known requirement names.  Implicitly detected by the hasReqts() helper.\n * @public\n **/\nexport type ReqtsMap<validReqts extends string, inheritedNames extends string | never = never> = {\n    [reqtDescription in validReqts]: TODO_TYPE | RequirementEntry<reqtDescription, validReqts, inheritedNames>;\n};\n\n/**\n * Factory for type-safe requirements details for a unit of software\n * @public\n * @remarks\n * return `hasReqts({... requirements})` from a requirements() or other method in a class, to express\n * requirements using a standardized form that supports arbitrary amounts of detailed requirements\n * with references to unit-test labels that can verify the impl details.\n *\n * You don't need to provide the type params or TS type annotations.  `requirements() { return hasReqts({...yourReqts}) }` will work fine.\n *\n * See the {@link ReqtsMap} and {@link RequirementEntry} types for more details about expressing requirements.\n *\n * NOTE: Type parameters are inferred from the provided data structure\n * @param reqtsMap - the ReqtsMap structure for the software unit\n */\nexport function hasReqts<\n    R extends ReqtsMap<validReqts, inheritedNames>,\n    const validReqts extends string = string & keyof R,\n    const inheritedNames extends string | never = never\n>(reqtsMap: R): ReqtsMap<validReqts, inheritedNames> {\n    return reqtsMap;\n}\n/** @public */\nhasReqts.TODO = TODO;\n\n/**\n * Factory for type-safe requirements combining inherited requirements with subclass-specific requirements\n * @remarks\n *\n * Use this method to combine the requirements of a subclass with the requirements of its superclass.  This\n * allows the subclass, in its requires: [ ... ] section, to reference capabilities of the base class that the subclass depends on.\n *\n * See the {@link ReqtsMap} and {@link RequirementEntry} types for more details about expressing requirements.\n *\n * @param inherits - the requirements of the base class\n * @param reqtsMap - the requirements of the subclass\n * @public\n **/\nexport function mergesInheritedReqts<\n    IR extends ReqtsMap<inheritedReqts>,\n    R extends ReqtsMap<myReqts, inheritedReqts>,\n    const inheritedReqts extends string = string & keyof IR,\n    const myReqts extends string = keyof R extends keyof IR ? never : string & keyof R,\n    // const parentReqts extends string = keyof { [parentReqt in inheritedReqts as `Parent: ${parentReqt}`] : any}\n>(inherits: IR, reqtsMap: R): ReqtsMap<myReqts | inheritedReqts , inheritedReqts \n        // never /*parentReqts */\n    > & IR {\n\n        //@ts-expect-error - uff, sorry folks.\n    return { ...inherits, ...reqtsMap } \n}\n","import type { TxInput, ValidatorHash } from \"@helios-lang/ledger\";\nimport type { Value } from \"@helios-lang/ledger\";\n\nimport { StellarContract, type configBaseWithRev } from \"../StellarContract.js\";\nimport { StellarTxnContext } from \"../StellarTxnContext.js\";\nimport type { capoDelegateConfig } from \"./RolesAndDelegates.js\";\nimport type {\n    ContractDataBridgeWithEnumDatum,\n    ContractDataBridgeWithOtherDatum,\n} from \"../helios/dataBridge/DataBridge.js\";\nimport type { AbstractNew } from \"../helios/typeUtils.js\";\n\nimport type { isActivity } from \"../ActivityTypes.js\";\nimport { hasReqts } from \"../Requirements.js\";\nimport { dumpAny } from \"../diagnostics.js\";\nimport { mkTv } from \"../utils.js\";\n\n/**\n * Base class for modules that can serve as Capo delegates\n * @public\n * @remarks\n *\n * establishes a base protocol for delegates.\n * @typeParam CT - type of any specialized configuration; use capoDelegateConfig by default.\n **/\nexport abstract class StellarDelegate extends StellarContract<capoDelegateConfig> {\n    static currentRev = 1n;\n    static get defaultParams() {\n        return { \n            rev: this.currentRev\n         };\n    }\n    // not required except for Contract-based delegates.  A subclass can represent a delegation\n    // relationship without an on-chain contract, resulting in there being no relevant data-bridge.\n    declare dataBridgeClass:\n        | AbstractNew<ContractDataBridgeWithEnumDatum>\n        | undefined;\n\n    /**\n     * Finds and adds the delegate's authority token to the transaction\n     * @remarks\n     *\n     * calls the delegate-specific DelegateAddsAuthorityToken() method,\n     * with the uut found by DelegateMustFindAuthorityToken().\n     *\n     * returns the token back to the contract using {@link StellarDelegate.txnReceiveAuthorityToken | txnReceiveAuthorityToken() }\n     * @param tcx - transaction context\n     * @public\n     **/\n    async txnGrantAuthority<TCX extends StellarTxnContext>(\n        tcx: TCX,\n        redeemer?: isActivity,\n        skipReturningDelegate?: \"skipDelegateReturn\"\n    ) {\n        const label = `${this.constructor.name} authority`;\n        const useMinTv = true;\n        const authorityVal = this.tvAuthorityToken(useMinTv);\n\n        const existing= tcx.hasAuthorityToken(authorityVal)\n        if (existing) {\n            console.error(\"This should be okay IF the redeemer on the txn is consistent with the redeemer being added\");\n            console.error(\"TODO: can the delegate have multiple redeemers, covering both activities?\");\n\n            throw new Error(`Delegate ${label}: already added: ${dumpAny(\n                authorityVal,\n                this.networkParams\n            )}`);\n        }\n\n        const uutxo = await this.DelegateMustFindAuthorityToken(tcx, label);\n        console.log(\n            `   ------- delegate '${label}' grants authority with ${dumpAny(\n                authorityVal,\n                this.networkParams\n            )}`\n        );\n\n        try {\n            const tcx2 = await this.DelegateAddsAuthorityToken(\n                tcx,\n                uutxo,\n                redeemer\n            );\n            if (skipReturningDelegate) return tcx2;\n            return this.txnReceiveAuthorityToken(tcx2, authorityVal, uutxo);\n        } catch (error: any) {\n            if (error.message.match(/input already added/)) {\n                throw new Error(\n                    `Delegate ${label}: already added: ${dumpAny(\n                        authorityVal,\n                        this.networkParams\n                    )}`\n                );\n            }\n            throw error;\n        }\n    }\n\n    /**\n     * Finds the authority token and adds it to the transaction, tagged for retirement\n     * @public\n     * @remarks\n     * Doesn't return the token back to the contract.\n     **/\n    async txnRetireAuthorityToken<TCX extends StellarTxnContext>(tcx: TCX) {\n        const uutxo = await this.DelegateMustFindAuthorityToken(\n            tcx,\n            `${this.constructor.name} authority`\n        );\n        return this.DelegateRetiresAuthorityToken(tcx, uutxo);\n    }\n\n    /**\n     * Standard delegate method for receiving the authority token as a txn output\n     * @remarks\n     *\n     * creates a UTxO / TxOutput, depositing the indicated token-name into the delegated destination.\n     *\n     * Each implemented subclass can use it's own style to match its strategy & mechanism,\n     * and is EXPECTED to use tcx.addOutput() to receive the indicated `tokenValue` into the\n     * contract or other destination address.\n     *\n     * This method is used both for the original deposit and for returning the token during a grant-of-authority.\n     *\n     * Impls should normally preserve the datum from an already-present sourceUtxo, possibly with evolved details.\n     *\n     * @param tcx - transaction-context\n     * @param tokenValue - the Value of the token that needs to be received.  Always includes\n     *   the minUtxo needed for this authority token\n     * @param fromFoundUtxo - always present when the authority token already existed; can be\n     *   used to duplicate or iterate on an existing datum, or to include any additional Value in the new\n     *   UTxO, to match the previous UTxO with minimal extra heuristics\n     * @public\n     **/\n\n    abstract txnReceiveAuthorityToken<TCX extends StellarTxnContext>(\n        tcx: TCX,\n        tokenValue: Value,\n        // delegateAddr: Address,\n        fromFoundUtxo?: TxInput\n    ): Promise<TCX>;\n\n    mkAuthorityTokenPredicate() {\n        return this.uh.mkTokenPredicate(this.tvAuthorityToken());\n    }\n    get authorityTokenName() {\n        return this.configIn!.tn;\n    }\n\n    tvAuthorityToken(useMinTv: boolean = false) {\n        if (!this.configIn)\n            throw new Error(`must be instantiated with a configIn`);\n\n        const {\n            mph,\n            tn,\n            // reqdAddress,  // removed\n        } = this.configIn;\n        if (useMinTv) return this.uh.mkMinTv(mph, tn);\n        return mkTv(mph, tn);\n    }\n\n    get delegateValidatorHash(): ValidatorHash | undefined {\n        return undefined;\n    }\n\n    /**\n     * Finds the delegate authority token, normally in the delegate's contract address\n     * @public\n     * @remarks\n     *\n     * The default implementation finds the UTxO having the authority token\n     * in the delegate's contract address.\n     *\n     * @param tcx - the transaction context\n     * @reqt It MUST resolve and return the UTxO (a TxInput type ready for spending)\n     *  ... or throw an informative error\n     **/\n    abstract DelegateMustFindAuthorityToken(\n        tcx: StellarTxnContext,\n        label: string\n    ): Promise<TxInput>;\n\n    /**\n     * Adds the delegate's authority token to a transaction\n     * @public\n     * @remarks\n     * Given a delegate already configured by a Capo, this method implements\n     * transaction-building logic needed to include the UUT into the `tcx`.\n     * the `utxo` is discovered by {@link StellarDelegate.DelegateMustFindAuthorityToken | DelegateMustFindAuthorityToken() }\n     **/\n    abstract DelegateAddsAuthorityToken<TCX extends StellarTxnContext>(\n        tcx: TCX,\n        uutxo: TxInput,\n        redeemer?: isActivity\n    ): Promise<TCX>;\n\n    /**\n     * Adds any important transaction elemements supporting the authority token being retired, closing the delegate contracts' utxo.\n     * @remarks\n     *\n     * EXPECTS to receive a Utxo having the result of txnMustFindAuthorityToken()\n     *\n     * EXPECTS the `burn` instruction to be separately added to the transaction.\n     *\n     * The default implementation uses the conventional `Retiring` activity\n     * to spend the token.\n     *\n     * @reqt\n     * It MUST add the indicated utxo to the transaction as an input\n     *\n     * @reqt\n     * When backed by a contract:\n     *   * it should use an activity/redeemer allowing the token to be spent\n     *      **and NOT returned**.\n     *   * the contract script SHOULD ensure any other UTXOs it may also hold, related to this delegation,\n     *      do not become inaccessible as a result.\n     *\n     * It MAY enforce additional requirements and/or block the action.\n     *\n     *\n     * @param tcx - transaction context\n     * @param fromFoundUtxo - the utxo having the authority otken\n     * @public\n     **/\n    abstract DelegateRetiresAuthorityToken<TCX extends StellarTxnContext>(\n        tcx: TCX,\n        fromFoundUtxo: TxInput\n    ): Promise<TCX>;\n\n    /**\n     * Captures requirements as data\n     * @remarks\n     *\n     * see reqts structure\n     * @public\n     **/\n    delegateRequirements() {\n        return hasReqts({\n            \"provides an interface for providing arms-length proof of authority to any other contract\":\n                {\n                    purpose:\n                        \"to decouple authority administration from its effects\",\n                    details: [\n                        \"Any contract can create a UUT for use with an authority policy.\",\n                        \"By depositing that UUT to the authority contract, it can delegate completely\",\n                        \"  ... all the implementation details for administration of the authority itself.\",\n                        \"It can then focus on implementing the effects of authority, requiring only \",\n                        \"  ... that the correct UUT has been spent, to indicate that the authority is granted.\",\n                        \"The authority contract can have its own internal details \",\n                        \"A subclass of this authority policy may provide additional administrative dynamics.\",\n                    ],\n                    mech: [],\n                    requires: [\n                        \"implementations SHOULD positively govern spend of the UUT\",\n                        \"implementations MUST provide an essential interface for transaction-building\",\n                    ],\n                },\n\n            \"implementations SHOULD positively govern spend of the UUT\": {\n                purpose: \"for sufficient assurance of desirable safeguards\",\n                details: [\n                    \"A subclass of the GenericAuthority should take care of guarding the UUT's spend\",\n                    \"  ... in whatever way is appropriate for its use-case\",\n                ],\n                mech: [],\n                requires: [],\n            },\n\n            \"implementations MUST provide an essential interface for transaction-building\":\n                {\n                    purpose:\n                        \"enabling a strategy-agnostic interface for making transactions using any supported strategy-variant\",\n                    details: [\n                        \"Subclasses MUST implement the interface methods\",\n                        \"  ... in whatever way is good for its use-case.\",\n                        \"An interface method whose requirement is marked with 'MAY/SHOULD' behavior, \",\n                        \"  ... MUST still implement the method satisfying the interface, \",\n                        \"  ... but MAY throw an UnsupportedAction error, to indicate that\",\n                        \"  ... the strategy variant has no meaningful action to perform \",\n                        \"  ... that would serve the method's purpose\",\n                    ],\n                    mech: [],\n                    requires: [\n                        //!!! todo: cross-check these requirements for completeness\n                        //  ... and for accuracy\n                        \"requires a txnReceiveAuthorityToken(tcx, delegateAddr, fromFoundUtxo?)\",\n                        \"requires a mustFindAuthorityToken(tcx)\",\n                        \"requires a txnGrantAuthority(tcx, delegateAddr, fromFoundUtxo)\",\n                        \"requires txnRetireCred(tcx, fromFoundUtxo)\",\n                    ],\n                },\n\n            \"requires a txnReceiveAuthorityToken(tcx, delegateAddr, fromFoundUtxo?)\":\n                {\n                    purpose:\n                        \"to deposit the authority token (back) to the delegated destination\",\n                    details: [\n                        \"impls MUST implement txnReceiveAuthorityToken\",\n                        \"Each implemented subclass can use it's own style to match its strategy & mechanism\",\n                        \"This is used both for the original deposit and for returning the token during a grant-of-authority\",\n                    ],\n                    mech: [\n                        \"impls MUST create a UTxO depositing the indicated token-name into the delegated destination.\",\n                        \"impls should normally preserve the datum from an already-present sourceUtxo\",\n                    ],\n                    requires: [],\n                },\n\n            \"requires a mustFindAuthorityToken(tcx)\": {\n                purpose: \"to locate the given authority token\",\n                details: [\n                    \"allows different strategies for finding the UTxO having the authority token\",\n                    \"impls MAY use details seen in the txn context to find the indicated token\",\n                ],\n                mech: [\n                    \"impls MUST resolve the indicated token to a specific UTxO or throw an informative error\",\n                ],\n            },\n\n            \"requires a txnGrantAuthority(tcx, delegateAddr, fromFoundUtxo)\": {\n                purpose: \"to use the delegated authority\",\n                details: [\n                    \"Adds the indicated utxo to the transaction with appropriate activity/redeemer\",\n                    \"Contracts needing the authority within a transaction can rely on the presence of this spent authority\",\n                    \"Impls can EXPECT the token will be returned via txnReceiveAuthorityToken\",\n                    \"a contract-backed impl SHOULD enforce the expected return in its on-chain code\",\n                ],\n                mech: [\n                    \"the base AuthorityPolicy MUST call txnReceiveAuthorityToken() with the token's sourceUtxo\",\n                ],\n            },\n\n            \"requires txnRetireCred(tcx, fromFoundUtxo)\": {\n                purpose: \"to allow burning the authority token\",\n                details: [\n                    \"Adds the indicated utxo to the transaction with appropriate activity/redeemer\",\n                    \"  ... allowing the token to be burned by the minting policy.\",\n                    \"Impls SHOULD ensure any other UTXOs it may hold do not become inaccessible as a result\",\n                ],\n                mech: [\n                    \"impls MUST add the token to the txn if it can be retired\",\n                    \"if the token cannot be retired, by appropriate policy, it SHOULD throw an informative error\",\n                ],\n            },\n        });\n    }\n}\n","import { makeTxInput, makeTxOutput } from \"@helios-lang/ledger\";\nimport type {\n    Value,\n    TxOutputId,\n    TxInput,\n    ValidatorHash,\n} from \"@helios-lang/ledger\";\nimport type { Capo } from \"../Capo.js\";\nimport type {\n    DelegateSetupWithoutMintDelegate,\n    MinimalDelegateLink,\n    MintUutActivityArgs,\n    NormalDelegateSetup,\n    hasCharterRef,\n} from \"../CapoTypes.js\";\nimport type {\n    mustFindActivityType,\n    mustFindConcreteContractBridgeType,\n    mustFindDatumType,\n    mustFindReadDatumType,\n} from \"../helios/dataBridge/BridgeTypes.js\";\nimport type {\n    GenericDelegateBridge,\n    GenericDelegateBridgeClass,\n    GenericDelegateDatum,\n} from \"./GenericDelegateBridge.js\";\n\nimport { Activity, datum } from \"../StellarContract.js\";\nimport { StellarDelegate } from \"./StellarDelegate.js\";\nimport type {\n    DelegationDetail,\n    capoDelegateConfig,\n} from \"./RolesAndDelegates.js\";\nimport { StellarTxnContext } from \"../StellarTxnContext.js\";\nimport type { CapoDelegateBundle } from \"../helios/scriptBundling/CapoDelegateBundle.js\";\nimport type { isActivity } from \"../ActivityTypes.js\";\n\nimport { bytesToText, textToBytes } from \"../HeliosPromotedTypes.js\";\nimport type { IFISNEVER } from \"../helios/typeUtils.js\";\n\n/**\n * Base class for delegates controlled by a smart contract, as opposed\n * to a simple delegate backed by an issued token, whose presence\n * grants delegated authority.\n * @public\n */\nexport class ContractBasedDelegate extends StellarDelegate {\n    /**\n     * Each contract-based delegate must define its own dataBridgeClass, but they all\n     * use the same essential template for the outer layer of their activity & datum interface.\n     */\n    declare dataBridgeClass: GenericDelegateBridgeClass;\n    declare _dataBridge: GenericDelegateBridge;\n    static currentRev = 1n;\n\n    /**\n     * Configures the matching parameter name in the on-chain script, indicating\n     * that this delegate serves the Capo by enforcing policy for spending the Capo's utxos.\n     * @remarks\n     * Not used for any mint delegate.  Howeever, a mint delegate class can instead provide a true isMintAndSpendDelegate,\n     *...  if a single script controls both the mintDgt-* and spendDgt-* tokens/delegation roles for your Capo.\n     *\n     * DO NOT enable this attribute for second-level delegates, such as named delegates or delegated-data controllers.\n     * The base on-chain delegate script recognizes this conditional role and enforces that its generic delegated-data activities\n     * are used only in the context the Capo's main spend delegate, re-delegating to the data-controller which\n     * can't use those generic activities, but instead implements its user-facing txns as variants of its SpendingActivities enum.\n     */\n    static isSpendDelegate = false\n\n    get delegateName(): string {\n        throw new Error(\n            `${this.constructor.name}: missing required get delegateName() : string`\n        );\n    }\n\n    get onchain(): mustFindConcreteContractBridgeType<this> {\n        return this.getOnchainBridge() as any;\n    }\n\n    get offchain(): mustFindConcreteContractBridgeType<this>[\"reader\"] {\n        return super.offchain as any;\n    }\n\n    get reader(): mustFindConcreteContractBridgeType<this>[\"reader\"] {\n        return super.offchain as any;\n    }\n\n    get activity(): mustFindActivityType<this> {\n        const bridge = this.onchain;\n        return bridge.activity as any;\n    }\n\n    get mkDatum(): mustFindDatumType<this> {\n        return this.onchain.datum;\n    }\n\n    get newReadDatum(): mustFindReadDatumType<this> {\n        // & ( (d: UplcData) => CapoDatumLike ) {\n        const bridge = this.getOnchainBridge();\n        //x@ts-expect-error probing for presence\n        const { readDatum } = bridge;\n        if (!readDatum) {\n            throw new Error(\n                `${\n                    (this as any).constructor.name\n                }: this contract script doesn't use datum`\n            );\n        }\n\n        return readDatum as any;\n    }\n\n    get capo(): Capo<any, any> {\n        return (this.configIn || this.partialConfig)?.capo as unknown as Capo<any, any>;\n    }\n\n    // mkBundleWithCapo<T extends HeliosScriptBundle>(BundleClass: new (capo: CapoHeliosBundle) => T) : T {\n    //     const { capo } = this.configIn || this.partialConfig || {};\n    //     if (!capo)\n    //         throw new Error(\n    //             `missing capo in config or partial-config for ${this.constructor.name}`\n    //         );\n    //     const capoBundle = capo.getBundle() as CapoHeliosBundle;\n    //     return new BundleClass(capoBundle);\n    // }\n\n    scriptBundle(): CapoDelegateBundle {\n        throw new Error(\n            `${this.constructor.name}: missing required implementation of scriptBundle()\\n` +\n                `\\nEach contract-based delegate must provide a scriptBundle() method.\\n` +\n                `It should return an instance of a class defined in a *.hlb.ts file.  At minimum:\\n\\n` +\n                `    import {YourAppCapo} from \"./YourAppCapo.js\";\\n\\n` +\n                `    import SomeSpecializedDelegate from \"./YourSpecializedDelegate.hl\";\\n\\n` +\n                `    export default class SomeDelegateBundle extends CapoDelegateBundle.using(YourAppCapo) {\\n` +\n                `        specializedDelegateModule = SomeSpecializedDelegate; \\n` +\n                `    }\\n\\n` +\n                `We'll generate an additional .typeInfo.d.ts, based on the types in your Helios sources,\\n` +\n                `  ... and a .bridge.ts with generated data-conversion code for bridging between off-chain` +\n                `  ... and on-chain data encoding.` +\n                `Your scriptBundle() method can \\`return new SomeDelegateBundle()\\``\n        );\n    }\n\n    get scriptDatumName() {\n        return \"DelegateDatum\";\n    }\n\n    get scriptActivitiesName() {\n        return \"DelegateActivity\";\n    }\n\n    static isMintDelegate = false;\n    static isMintAndSpendDelegate = false;\n    static isDgDataPolicy = false;\n\n    static get defaultParams() {\n        const params = {\n            rev: this.currentRev,\n            isMintDelegate: this.isMintDelegate,\n            isSpendDelegate: this.isMintAndSpendDelegate,\n            isDgDataPolicy: this.isDgDataPolicy,\n        };\n        return params;\n    }\n    static mkDelegateWithArgs(a: capoDelegateConfig) {}\n\n    getContractScriptParams(config: capoDelegateConfig) {\n        const { capoAddr, mph, tn, capo, ...otherConfig } = config;\n\n        return {\n            ...otherConfig,\n            delegateName: this.delegateName,\n        }\n    }\n\n    tcxWithCharterRef<TCX extends StellarTxnContext | hasCharterRef>(tcx: TCX) {\n        return this.capo.tcxWithCharterRef(tcx);\n    }\n\n    /**\n     * Adds a mint-delegate-specific authority token to the txn output\n     * @remarks\n     *\n     * Implements {@link StellarDelegate.txnReceiveAuthorityToken | txnReceiveAuthorityToken() }.\n     *\n     * Uses {@link ContractBasedDelegate.mkDelegationDatum | mkDelegationDatum()} to make the inline Datum for the output.\n     * @see {@link StellarDelegate.txnReceiveAuthorityToken | baseline txnReceiveAuthorityToken()'s doc }\n     * @public\n     **/\n    async txnReceiveAuthorityToken<TCX extends StellarTxnContext>(\n        tcx: TCX,\n        tokenValue: Value,\n        fromFoundUtxo?: TxInput\n    ): Promise<TCX> {\n        const datum = this.mkDelegationDatum(fromFoundUtxo);\n\n        const newOutput = makeTxOutput(this.address, tokenValue, datum);\n        // const separator = `     -----`;\n        // console.log(\n        //     `${separator} delegate script receiving dgTkn\\n${separator} ${dumpAny(\n        //         newOutput\n        //     )}` // ${dumpAny(tokenValue)} at ${dumpAny(addr)} = ${addr.toBech32()}`\n        // );\n        // const ffu = fromFoundUtxo;\n        // const v : Value = ffu?.value || this.mkMinAssetValue(this.configIn!.uut);\n        return tcx.addOutput(newOutput);\n    }\n\n    mkDelegationDatum(txin?: TxInput) {\n        if (txin) return txin.output.datum!;\n        const { capoAddr, mph, tn, ..._otherCfgSettings } = this.configIn!;\n\n        return this.mkDatum.IsDelegation({\n            capoAddr,\n            mph,\n            tn,\n        });\n    }\n\n    /**\n     * redeemer for replacing the authority UUT with a new one\n     * @remarks\n     *\n     * When replacing the delegate, the current UUT will be burned,\n     * and a new one will be minted.  It can be deposited to any next delegate address.\n     *\n     * @param seedTxnDetails - seed details for the new UUT\n     * @public\n     **/\n    @Activity.redeemer\n    activityReplacingMe({\n        seed,\n        purpose,\n    }: Omit<MintUutActivityArgs, \"purposes\"> & { purpose: string }) {\n        throw new Error(`deprecated: explicit activity helper`);\n\n        // return this.mkDelegateLifecycleActivity(\"ReplacingMe\", {\n        //     seed,\n        //     purpose,\n        // });\n    }\n\n    mkDelegateLifecycleActivity(\n        delegateActivityName: \"ReplacingMe\" | \"Retiring\" | \"ValidatingSettings\",\n        args?: Record<string, any>\n    ): isActivity {\n        throw new Error(`deprecated: explicit activity helper`);\n\n        // try {\n        //     return this.activityRedeemer(\"DelegateLifecycleActivities\", {\n        //         activity: { [delegateActivityName]: args },\n        //     });\n        // } catch (e: any) {\n        //     // warning emoji: \"⚠️\"\n        //     e.message =\n        //         \"⚠️ ⚠️ ⚠️ error constructing delegate lifecycle activity.  You might need \" +\n        //         \"to format the args as UplcData if the enum doesn't recognize a valid off-chain type.\\nDelegate lifecycle activity: \" +\n        //         e.message;\n        //     throw e;\n        // }\n    }\n\n    mkCapoLifecycleActivity(\n        capoLifecycleActivityName: \"CreatingDelegate\" | \"ActivatingDelegate\",\n        {\n            seed,\n            purpose,\n            ...otherArgs\n        }: Omit<MintUutActivityArgs, \"purposes\"> & { purpose?: string }\n    ): isActivity {\n        throw new Error(`deprecated: explicit activity helper`);\n\n        // return this.activityRedeemer(\"CapoLifecycleActivities\", {\n        //     activity: {\n        //         [capoLifecycleActivityName]: { seed, purpose, ...otherArgs },\n        //     },\n        // });\n    }\n\n    /**\n     * Creates a reedemer for the indicated spending activity name\n     **/\n    mkSpendingActivity(\n        spendingActivityName: string,\n        args: { id: string | number[] } & Record<string, any>\n    ): isActivity {\n        throw new Error(`deprecated: explicit activity helper`);\n\n        // try {\n        //     let id : number[] = (\"string\" == typeof args.id) ?\n        //         textToBytes(args.id as string) : args.id as number[];\n\n        //         // TODO: require that the on-chain type have first field = 'id', not 'recId' or whatever\n        //     return this.activityRedeemer(\"SpendingActivities\", {\n        //         activity: {\n        //             [spendingActivityName]: { ...args, id },\n        //         },\n        //     });\n        // } catch (e: any) {\n        //     // warning emoji: \"⚠️\"\n        //     e.message =\n        //         \"⚠️ ⚠️ ⚠️ error constructing spending activity: \" + e.message;\n        //     throw e;\n        // }\n    }\n\n    mkSeedlessMintingActivity(\n        mintingActivityName: string,\n        args: Record<string, any>\n    ): isActivity {\n        const { MintingActivity } = this.onChainTypes;\n        const NestedVariant = this.mustGetEnumVariant(\n            MintingActivity,\n            mintingActivityName\n        );\n        throw new Error(`mkSeedlessMintingActivity: deprecated`);\n        // debugger; // ??? vvv\n        // //@ts-ignore !!!!\n        // const nestedVarSt = NestedVariant.prototype._enumVariantStatement;\n        // const firstActivityField =\n        //     nestedVarSt.dataDefinition.fields[0].name.value;\n        // if (\"seed\" === firstActivityField) {\n        //     throw new Error(\n        //         `Minting activity '${mintingActivityName}' requires a seed 🍉. \\n` +\n        //             `   ... therefore, you must use mkSeededMintingActivity() instead.`\n        //     );\n        // }\n        // if (args.seed) {\n        //     throw new Error(\n        //         `mkSeedlessMintingActivity: found unexpected 'seed' field in seedless MintingActivity variant!\\n` +\n        //             `  🍉 ... if this minting activity actually needs a seed, you'd need to adjust its on-chain type definition.` +\n        //             `  ... a seed provides guaranteed uniqueness for minting e.g. a UUT. ` +\n        //             `  ... e.g.minting only fungible tokens doesn't require a seed`\n        //     );\n        // }\n\n        // try {\n        //     return this.activityRedeemer(\"MintingActivities\", {\n        //         activity: { [mintingActivityName]: args },\n        //     });\n        // } catch (e: any) {\n        //     // warning emoji: \"⚠️\"\n        //     e.message =\n        //         \"⚠️ ⚠️ ⚠️ error constructing minting activity.  You might need \" +\n        //         \"to format the args as UplcData if the enum doesn't recognize a valid off-chain type.\\nMinting activity: \" +\n        //         e.message;\n        //     throw e;\n        // }\n    }\n\n    mkSeededMintingActivity(\n        mintingActivityName: string,\n        args: { seed: TxOutputId } & Record<string, any>\n    ): isActivity {\n        const { MintingActivity } = this.onChainTypes;\n        const NestedVariant = this.mustGetEnumVariant(\n            MintingActivity,\n            mintingActivityName\n        );\n        throw new Error(`mkSeededMintingActivity: deprecated`);\n        // if (!NestedVariant) {\n        //     throw new Error(\n        //         `mkSeededMintingActivity: missing MintingActivity variant '${mintingActivityName}'`\n        //     );\n        // }\n        // // const nestedVarSt = NestedVariant.prototype._enumVariantStatement;\n        // const firstActivityField = NestedVariant.fieldNames[0];\n        // // nestedVarSt.dataDefinition.fields[0].name.value;\n        // if (\"seed\" !== firstActivityField) {\n        //     throw new Error(\n        //         `Minting activity '${mintingActivityName}' is not a seeded activity.  \\n` +\n        //             `   ... therefore, you must use mkSeedlessMintingActivity() instead.  🍉`\n        //     );\n        // }\n        // if (!args.seed) {\n        //     throw new Error(\n        //         `mkSeedlessMintingActivity: missing required 'seed' field in MintingActivity variant!\\n` +\n        //             `  🍉 ... if this minting activity doesn't actually need a seed, you'd need to adjust its on-chain type definition.` +\n        //             `  ... a seed provides guaranteed uniqueness for minting e.g. a UUT. ` +\n        //             `  ... e.g., minting only fungible tokens doesn't require a seed`\n        //     );\n        // }\n\n        // try {\n        //     return this.activityRedeemer(\"MintingActivities\", {\n        //         activity: { [mintingActivityName]: args },\n        //     });\n        // } catch (e: any) {\n        //     // warning emoji: \"⚠️\"\n        //     e.message =\n        //         \"⚠️ ⚠️ ⚠️ error constructing minting activity.  You might need \" +\n        //         \"to format the args as UplcData if the enum doesn't recognize a valid off-chain type.\\nMinting activity: \" +\n        //         e.message;\n        //     throw e;\n        // }\n    }\n\n    /**\n     * redeemer for spending the authority UUT for burning it.\n     * @public\n     * @remarks\n     *\n     * The Retiring redeemer indicates that the delegate is being\n     * removed.\n     *\n     **/\n    @Activity.redeemer\n    activityRetiring() {\n        throw new Error(`deprecated: explicit activity helper`);\n\n        // return this.mkDelegateLifecycleActivity(\"Retiring\");\n    }\n\n    @Activity.redeemer\n    activityValidatingSettings() {\n        throw new Error(`deprecated: explicit activity helper`);\n\n        // return this.mkDelegateLifecycleActivity(\"ValidatingSettings\");\n    }\n\n    // @Activity.redeemer\n    activityMultipleDelegateActivities(\n        ...activities: isActivity[]\n    ): isActivity {\n        throw new Error(`deprecated: explicit activity helper`);\n        // return this.activityRedeemer(\"MultipleDelegateActivities\", {\n        //     // todo: allow the cast to take already-uplc'd data\n        //     activities: activities.map((a) => a.redeemer),\n        // });\n    }\n\n    // /**\n    //  * A spend-delegate activity indicating that a delegated-data controller will be governing\n    //  * an update to a specific piece of delegated data.  No further redeemer details are needed here,\n    //  * but the data-delegate's controller-token may have additional details in ITS redeemer,\n    //  * which will be aligned with the one.\n    //  *\n    //  * May be present in the context of a nested MultipleDelegateActivities redeemer, in which\n    //  * case, multiple cases of the above scenario will be present in a single transaction.\n    //  */\n    // @Activity.redeemer\n    // activityUpdatingDelegatedData(\n    //     recId: string | number[]\n    // ): isActivity {\n    //     const recIdBytes = Array.isArray(recId)\n    //         ? recId\n    //         : textToBytes(recId);\n    //     // const Activity = this.mustGetActivity(\"UpdatingDelegatedData\");\n\n    //     // this.activity.DeletingDelegatedData\n\n    //     return {\n    //         // redeemer: new Activity(uutPurpose, recIdBytes),\n    //         redeemer: this.activityVariantToUplc(\"UpdatingDelegatedData\", {\n    //             recId: recIdBytes,\n    //         }),\n    //     };\n    // }\n\n    /**\n     * A mint-delegate activity indicating that a delegated-data controller will be governing\n     * a deletion (burning its UUT) of a specific piece of delegated data.  No further redeemer details are needed here,\n     * but the data-delegate's controller-token may have additional details in ITS redeemer,\n     */\n    @Activity.redeemer\n    activityDeletingDelegatedData(recId: string | number[]): isActivity {\n        throw new Error(`deprecated: explicit activity helper`);\n\n        // const recIdBytes = Array.isArray(recId)\n        //     ? recId\n        //     : textToBytes(recId);\n\n        //     return {\n        //     redeemer: this.activityVariantToUplc(\"DeletingDelegatedData\", {\n        //         recId: recIdBytes,\n        //     }),\n        // };\n    }\n\n    /**\n     * creates the essential datum for a delegate UTxO\n     * @remarks\n     *\n     * Every delegate is expected to have a two-field 'IsDelegation' variant\n     * in the first position of its on-chain Datum type.  This helper method\n     * constructs a suitable UplcData structure, given appropriate inputs.\n     * @param dd - Delegation details\n     * @public\n     **/\n    @datum\n    mkDatumIsDelegation(dd: DelegationDetail) {\n        const { DelegationDetail } = this.onChainTypes;\n        throw new Error(`deprecated: explicit datum helper`);\n\n        // const schema = DelegationDetail.toSchema()\n        // const cast = new Cast(schema, {\n        //     isMainnet: this.setup.isMainnet || false\n        // });\n        return this.inlineDatum(\"IsDelegation\", { dd });\n    }\n\n    /**\n     * returns the ValidatorHash of the delegate script, if relevant\n     * @public\n     * @remarks\n     *\n     * A delegate that doesn't use an on-chain validator should override this method and return undefined.\n     **/\n    get delegateValidatorHash(): ValidatorHash | undefined {\n        if (!this.validatorHash) {\n            throw new Error(\n                `${this.constructor.name}: address doesn't use a validator hash!\\n` +\n                    `  ... if that's by design, you may wish to override 'get delegateValidatorHash()'`\n            );\n        }\n        return this.validatorHash;\n    }\n\n    /**\n     * {@inheritdoc StellarDelegate.DelegateMustFindAuthorityToken}\n     **/\n    async DelegateMustFindAuthorityToken(\n        tcx: StellarTxnContext,\n        label: string\n    ): Promise<TxInput> {\n        return this.mustFindMyUtxo(\n            `${label}: ${bytesToText(this.configIn!.tn)}`, {\n                predicate: this.uh.mkTokenPredicate(this.tvAuthorityToken()),\n                extraErrorHint: \"this delegate strategy might need to override txnMustFindAuthorityToken()\"\n            }\n        );\n    }\n\n    /**\n     * Adds the delegate's authority token to a transaction\n     * @public\n     * @remarks\n     * Given a delegate already configured by a Capo, this method implements\n     * transaction-building logic needed to include the UUT into the `tcx`.\n     * the `utxo` is discovered by {@link StellarDelegate.DelegateMustFindAuthorityToken | DelegateMustFindAuthorityToken() }\n     *\n     * The off-chain code shouldn't need to check the details; it can simply\n     * arrange the details properly and spend the delegate's authority token,\n     * using this method.\n     *\n     * ### Reliance on this delegate\n     *\n     * Other contract scripts can rely on the delegate script to have validated its\n     * on-chain policy and enforced its own \"return to the delegate script\" logic.\n     *\n     * ### Enforcing on-chain policy\n     *\n     * When spending the authority token in this way, the delegate's authority is typically\n     * narrowly scoped, and it's expected that the delegate's on-chain script validates that\n     * those parts of the transaction detail should be authorized, in accordance with the\n     * delegate's core purpose/responsbility - i.e. that the txn does all of what the delegate\n     * expects, and none of what it shouldn't do in that department.\n     *\n     * The on-chain code SHOULD typically enforce:\n     *  * that the token is spent with an application-specific redeemer variant of its\n     *     MintingActivity or SpendingActivitie.\n     *\n     *  * that the authority token is returned to the contract with its datum unchanged\n     *  * that any other tokens it may also hold in the same UTxO do not become\n     *     inaccessible as a result of the transactions - perhaps by requiring them to be\n     *     returned together with the authority token.\n     *\n     * It MAY enforce additional requirements as well.\n     *\n     * @example\n     * A minting delegate should check that all the expected tokens are\n     * minted, AND that no other tokens are minted.\n     *\n     * @example\n     * A role-based authentication/signature-checking delegate can\n     * require an appropriate signature on the txn.\n     *\n     * @param tcx - the transaction context\n     * @param utxo - the utxo having the authority UUT for this delegate\n     * @reqt Adds the uutxo to the transaction inputs with appropriate redeemer.\n     * @reqt Does not output the value; can EXPECT txnReceiveAuthorityToken to be called for that purpose.\n     **/\n    async DelegateAddsAuthorityToken<TCX extends StellarTxnContext>(\n        tcx: TCX,\n        uutxo: TxInput,\n        redeemer: isActivity\n    ): Promise<TCX> {\n        const { capo } = this.configIn!;\n\n        // when there is a delegate upgrade in progress, we must \n        // use the previous script, not the next script, to locate \n        // the authority token.\n\n        const script = this._bundle?.previousCompiledScript() || this.compiledScript\n        const tcx2 = await capo.txnAttachScriptOrRefScript(\n            tcx,\n            script\n        );\n        if (!redeemer.redeemer) debugger\n        return tcx2.addInput(uutxo, redeemer);\n\n        // return this.txnKeepValue(\n        //     tcx,\n        //     uutxo.value,\n        //     uutxo.origOutput.datum as InlineDatum\n        // );\n    }\n\n    /**\n     * {@inheritdoc StellarDelegate.DelegateAddsAuthorityToken}\n     **/\n\n    async DelegateRetiresAuthorityToken<TCX extends StellarTxnContext>(\n        this: ContractBasedDelegate,\n        tcx: StellarTxnContext,\n        fromFoundUtxo: TxInput\n    ): Promise<TCX> {\n        const utxo = fromFoundUtxo;\n\n        return tcx.addInput(\n            makeTxInput(utxo.id, utxo.output),\n            this.activity.DelegateLifecycleActivities.Retiring\n        ) as TCX;\n    }\n}\n\n/**\n * @public\n */\nexport type NamedPolicyCreationOptions<\n    thisType extends Capo<any>,\n    DT extends StellarDelegate\n> = PolicyCreationOptions & {\n    /**\n     * Optional name for the UUT; uses the delegate name if not provided.\n     **/\n    uutName?: string;\n};\n// MinimalDelegateLink<DT> & {\n//     uutOptions: UutCreationAttrs | ForcedUutReplacement\n//     strategyName: string &\n//     keyof thisType[\"delegateRoles\"][\"spendDelegate\"][\"variants\"];\n//     forcedUpdate?: true;\n// };\n\nexport type PolicyCreationOptions = MinimalDelegateLink & {\n    /**\n     * details for creating the delegate\n     */\n    mintSetup: NormalDelegateSetup | DelegateSetupWithoutMintDelegate;\n    // strategyName: string & STRATEGIES;\n    /**\n     * Installs the named delegate without burning the existing UUT for this delegate.\n     * That UUT may become lost and inaccessible, along with any of its minUtxo.\n     **/\n    forcedUpdate?: true;\n};\n"],"names":["bytesToText","textToBytes","extraNewLine","usesOutdent","multiLine","s","x","tx","txName","tcx","t","v","mph","datum","__decorateClass"],"mappings":"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"}