{"version":3,"file":"CapoMinter.hlb.mjs","sources":["../../src/minting/CapoMinter.hlb.ts"],"sourcesContent":["import type { Source } from \"@helios-lang/compiler-utils\";\nimport { CapoHeliosBundle } from \"../helios/scriptBundling/CapoHeliosBundle.js\";\nimport type { CapoConfig } from \"../CapoTypes.js\";\nimport type { RequiredDeployedScriptDetails } from \"../configuration/DeployedScriptConfigs.js\";\nimport { CapoDelegateBundle } from \"../helios/scriptBundling/CapoDelegateBundle.js\";\nimport { HeliosScriptBundle } from \"../helios/scriptBundling/HeliosScriptBundle.js\";\n\nimport CapoMinterScript from \"./CapoMinter.hl\";\nimport type { StellarBundleSetupDetails } from \"../StellarContract.js\";\n\n\n// this class expresses a \"has dependences from the Capo\" semantic,\n// ... not because it expects any dynamic code dependencies from an\n// ... application-specific Capo, but rather by simple convention of playing\n// ... in the pattern of \"Capo provides dependency code\".\n//\n// It can safely get its code dependencies from the normal, unspecialized \n// Capo bundle\n\n/**\n * for the special Capo minter; makes the Capo's modules available\n * to the minter for imports\n **/\nexport class CapoMinterBundle \nextends HeliosScriptBundle.usingCapoBundleClass(CapoHeliosBundle) {\n    scriptParamsSource = \"config\" as const\n    //pro-forma to make TypeScript happy\n    requiresGovAuthority = true;\n\n    static needsSpecializedDelegateModule = false\n    static needsCapoConfiguration = true\n    \n    declare capoBundle: CapoHeliosBundle;\n    // constructor(\n    //     setupDetails?: StellarBundleSetupDetails<any>\n    // ) {\n    //     super(setupDetails);\n    //     //@ts-expect-error setting the required property\n    // }\n\n    get rev(): bigint {\n        return 1n\n    }\n\n    get params() {\n        const {configuredScriptDetails, configuredParams } = this.capoBundle || {}\n        \n        debugger\n        const noConfig = `${this.constructor.name}: capoMph not found in deployed capo bundle; can't make config yet (dbpa)`;\n        if (!configuredScriptDetails) {\n            \n            if (configuredParams) {                \n                console.warn(noConfig);\n                debugger\n            }\n            return undefined\n        }\n        const capoConfig = (configuredScriptDetails as RequiredDeployedScriptDetails<CapoConfig>).config\n        const {\n            mph,\n            seedTxn,\n            seedIndex,\n        } = capoConfig\n        if (!mph) {\n            console.warn(noConfig);\n            debugger\n            throw new Error(noConfig) // ????\n            return undefined\n        }\n\n        return {\n            rev: this.rev,\n            seedTxn,\n            seedIndex\n        }\n    }\n\n    // // no datum types in this script\n    // declare Activity: makesUplcActivityEnumData<MinterActivityLike>;\n\n    // constructor(capoBundle: CapoHeliosBundle) {\n    //     super();\n    //     this.capoBundle = capoBundle;\n    // }\n\n    get main(): Source {\n        return CapoMinterScript;\n    }    \n\n    // automatically-included modules from Capo don't need to be specified\n    // get modules() {\n    //     return [...this.capoBundle.modules];\n    // }\n}\n\nexport default CapoMinterBundle"],"names":["CapoMinterScript"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAuBO,MAAM,gBACL,SAAA,kBAAA,CAAmB,oBAAqB,CAAA,gBAAgB,CAAE,CAAA;AAAA,EAC9D,kBAAqB,GAAA,QAAA;AAAA;AAAA,EAErB,oBAAuB,GAAA,IAAA;AAAA,EAEvB,OAAO,8BAAiC,GAAA,KAAA;AAAA,EACxC,OAAO,sBAAyB,GAAA,IAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUhC,IAAI,GAAc,GAAA;AACd,IAAO,OAAA,EAAA;AAAA;AACX,EAEA,IAAI,MAAS,GAAA;AACT,IAAA,MAAM,EAAC,uBAAyB,EAAA,gBAAA,EAAqB,GAAA,IAAA,CAAK,cAAc,EAAC;AAEzE,IAAA;AACA,IAAA,MAAM,QAAW,GAAA,CAAA,EAAG,IAAK,CAAA,WAAA,CAAY,IAAI,CAAA,yEAAA,CAAA;AACzC,IAAA,IAAI,CAAC,uBAAyB,EAAA;AAE1B,MAAA,IAAI,gBAAkB,EAAA;AAClB,QAAA,OAAA,CAAQ,KAAK,QAAQ,CAAA;AACrB,QAAA;AAAA;AAEJ,MAAO,OAAA,MAAA;AAAA;AAEX,IAAA,MAAM,aAAc,uBAAsE,CAAA,MAAA;AAC1F,IAAM,MAAA;AAAA,MACF,GAAA;AAAA,MACA,OAAA;AAAA,MACA;AAAA,KACA,GAAA,UAAA;AACJ,IAAA,IAAI,CAAC,GAAK,EAAA;AACN,MAAA,OAAA,CAAQ,KAAK,QAAQ,CAAA;AACrB,MAAA;AACA,MAAM,MAAA,IAAI,MAAM,QAAQ,CAAA;AACjB;AAGX,IAAO,OAAA;AAAA,MACH,KAAK,IAAK,CAAA,GAAA;AAAA,MACV,OAAA;AAAA,MACA;AAAA,KACJ;AAAA;AACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,IAAI,IAAe,GAAA;AACf,IAAO,OAAAA,aAAA;AAAA;AACX;AAAA;AAAA;AAAA;AAMJ;;;;"}