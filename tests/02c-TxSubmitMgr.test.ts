import {
    describe as descrWithContext,
    expect,
    it as itWithContext,
    beforeEach,
    vi,
    assertType,
    expectTypeOf,
    beforeAll,
    afterEach,
} from "vitest";
import {
    decodeTx,
    makeTxOutput,
    NetworkParams,
    Tx,
    TxOutput,
} from "@helios-lang/ledger";
import {
    Capo,
    StellarTxnContext,
    parseCapoJSONConfig,
    CapoWithoutSettings,
    type ConfigFor,
    TxDescription,
    GenericSigner,
    SetupInfo,
    TxBatcher,
    colors
} from "@donecollectively/stellar-contracts";
const { blue } = colors

import { SubmitterRetryIntervals, TxSubmitMgr } from "../src/networkClients/TxSubmitMgr.js";

import {
    ADA,
    StellarTestContext,
    TestHelperState,
    addTestContext,
} from "../src/testing";
import { DefaultCapoTestHelper } from "../src/testing/DefaultCapoTestHelper";
import { expectTxnError } from "../src/testing/StellarTestHelper";
import { makeBlockfrostV0Client } from "@helios-lang/tx-utils";
import { UplcConsoleLogger } from "../src/UplcConsoleLogger";
// import { RoleDefs } from "../src/RolesAndDelegates";

type localTC = StellarTestContext<DefaultCapoTestHelper>;

const it = itWithContext<localTC>;
const fit = it.only;
const xit = it.skip; //!!! todo: update this when vitest can have skip<HeliosTestingContext>
//!!! until then, we need to use if(0) it(...) : (
// ... or something we make up that's nicer

const describe = descrWithContext<localTC>;
const bf = makeBlockfrostV0Client(
    "preprod",
    "preprod8IoaBd05Hl9xP3ptE44f42xtKvkKWHC4"
);
let networkParams: NetworkParams;
const retryIntervals : SubmitterRetryIntervals = {
    reconfirm: 140,
    submit: 200,
    confirm: 100,
    startup: 50,
    maximum: 1200,
};

let lastStatus: TxSubmitMgr["$$statusSummary"] = {} as any;
function logProgress(tsm: TxSubmitMgr) {
    tsm.$notifier.on("changed", (tsm) => {
        const diff = {};
        for (const [k, v] of Object.entries(tsm.$$statusSummary)) {
            if (lastStatus[k] !== v) {
                diff[k] = v;
            }
        }
        lastStatus = tsm.$$statusSummary;
        
        console.log("Updated tx submit status:", diff);
    });
}

let tx: Tx = undefined as any;
let tsm: TxSubmitMgr = undefined as any;
let mkSubmitMgr: () => {
    promise: Promise<any>;
    resolve: (x: any) => void;
    reject: (x: any) => void;
    tsm: TxSubmitMgr;
};
let timeout = 5000;

describe("TxSubmitMgr", async () => {
    beforeAll(async () => {
        if (!networkParams) networkParams = await bf.parameters;

        tx = decodeTx(testTx);
        tx.body.recover(bf);
    });

    beforeEach<localTC>(async (context) => {
        console.log(
            blue(
                "=====================================================================" +
                    "=====================================================================\n" +
                    "=====================================================================" +
                    "====================================================================="
            )
        );
        await addTestContext(
            context,
            DefaultCapoTestHelper,
            undefined,
            // fake helper state to get rid of the big helpful message
            {} as any
        );
        await context.h.delay(1);

        // this setup isn't good enough for most things, but
        // it's good enough for isolated testing of the tx submit mgr
        const miniSetup: SetupInfo = {
            network: bf,
            networkParams,
            isTest: true,
            isMainnet: false,
            txBatcher: new TxBatcher({
                submitters: {
                    blockfrost: bf,
                },
            }),
        } as any;
        // we shouldn't even need to touch the txBatcher
        // miniSetup.txBatcher.setup = miniSetup;

        mkSubmitMgr = () => {
            const logger = new UplcConsoleLogger();
            logger.logPrint("  -- testing tx submission --");

            let resolve, reject;
            const promise = new Promise((res, rej) => {
                resolve = res;
                reject = rej;
            });

            tsm = new TxSubmitMgr({
                name: "test",
                txd: {
                    tx,
                    description: "test tx",
                    id: "54321",
                    tcx: { logger } as any,
                    signedTxCborHex: testTx,
                    // depth: 0,
                    options: {
                        // onSubmitError: reject,
                    },
                    // stats: {
                    //     /** not used in the tx submit mgr obj */
                    // } as any,
                    // txCborHex: "unused",
                    txId: tx.id(),
                } as any,
                // setup: capo.setup,
                setup: miniSetup as any,
                submitter: bf,
                retryIntervals,
            });
            const timeoutId = setTimeout(() => {
                reject(new Error("timeout"));
            }, timeout);
            promise.then(
                () => {
                    clearTimeout(timeoutId);
                },
                () => {
                    // no worries, someone else will catch the error if important
                }
            );

            logProgress(tsm);

            return { tsm, promise, resolve, reject };
        };
    });
    afterEach(async() => {        
        tsm?.destroy();

        // await tsm?.delayed(10000);
    });

    it("submits a tx and confirms it", async (context: localTC) => {
        const { resolve, tsm, reject, promise } = mkSubmitMgr();

        vi.spyOn(tsm, "doSubmit").mockImplementation(async () => {
            return tx.id();
        });
        vi.spyOn(tsm, "confirmTx").mockImplementation(async () => {
            return true;
        });
        vi.spyOn(tsm, "isExpiryError").mockImplementation((problem) => {
            throw new Error(`there shouldn't be ANY errors`);
        });
        vi.spyOn(tsm, "isUnknownUtxoError").mockImplementation((problem) => {
            throw new Error(`there shouldn't be ANY errors`);
        });

        tsm.$notifier.on("state:entered", (tsm, state) => {
            if (state === "confirmed") {
                resolve(tsm);
            }
        });

        return promise;
    });

    it("tries hard to get confirmation, and resubmits with gradual backoff", async (context: localTC) => {
        timeout = 10000
        const { resolve, tsm, reject, promise } = mkSubmitMgr();

        let submitCount = 0;
        let confirmCount = 0;
        vi.spyOn(tsm, "doSubmit").mockImplementation(async () => {
            await tsm.delayed(1);
            if (submitCount > 3) {
                throw new Error("fake submit error");
            }
            submitCount++;
            return tx.id();
        });
        let mockedExpiryError = false;
        vi.spyOn(tsm, "isExpiryError").mockImplementation((problem) => {
            return mockedExpiryError;
        });
        vi.spyOn(tsm, "isUnknownUtxoError").mockImplementation((problem) => {
            return false;
        });

        vi.spyOn(tsm, "confirmTx").mockImplementation(async () => {
            confirmCount++;
            return false;
        });

        tsm.$notifier.on("state:entered", (tsm, state) => {
            if (state === "submitting") {
                // in a real life version of this scenario, we'd keep trying until the 
                // tx becomes expired or the user themselves gives up.  But here,
                // we can just resolve it after a few tries.
                if (submitCount > 3) {
                    //Now we simulate expiration of the tx:
                    mockedExpiryError = true;
                    vi.spyOn(tsm, "isTxExpired").mockImplementation(() => {
                        return true;
                    });
                }
                submitCount++;
            }
            if (state === "confirmed") {
                reject(new Error("shouldn't ever confirm"));
            }
            if (state === "failed") {
                resolve(tsm);
            }
        });
        let confirmBackoffs: number[] = [];

        tsm.$notifier.on("backoff", (tsm, interval, transition) => {
            if (transition === "confirming") {
                console.log("     --- will retry confirmation after", interval);
                confirmBackoffs.push(interval);
            }
        });

        return promise.then(() => {
            expect(submitCount).toBe(4);
            expect(confirmCount).toBeGreaterThan(6)
            // each time in te confirmation state has its own limited number of backoffs
            expect(confirmBackoffs.length).toBe(20);
            const firstBackoff = confirmBackoffs[0];
            const lastBackoff = confirmBackoffs[confirmBackoffs.length - 1];
            expect(lastBackoff, "backoff should be increasing significantly").toBeGreaterThan(firstBackoff * 2);

            expect(tsm.$state).toBe("failed");
        })
    });

    it("re-confirms a tx even if it seems to be expired", async (context: localTC) => {
        const { resolve, tsm, reject, promise } = mkSubmitMgr();

        vi.spyOn(tsm, "doSubmit").mockImplementation(async () => {
            debugger;
            await tsm.delayed(1);
            debugger;
            throw new Error("fake expired error");
        });
        vi.spyOn(tsm, "confirmTx").mockImplementation(async () => {
            await tsm.delayed(1);
            return true;
        });
        vi.spyOn(tsm, "isExpiryError").mockImplementation((problem) => {
            return problem.message.includes("fake expired error");
        });
        vi.spyOn(tsm, "isTxExpired").mockImplementation(() => {
            return true
        });
        vi.spyOn(tsm, "isUnknownUtxoError").mockImplementation((problem) => {
            return false;
        });
        tsm.$notifier.on("state:entered", (tsm, state) => {
            if (state === "confirmed") {
                resolve(tsm);
            }
        });

        return promise;
    });

    it("re-confirms a tx if it's already on-chain", async (context: localTC) => {
        const { resolve, tsm, reject, promise } = mkSubmitMgr();

        vi.spyOn(tsm, "doSubmit").mockImplementation(async () => {
            await tsm.delayed(1);
            throw new Error("fake submit error");
        });
        vi.spyOn(tsm, "isExpiryError").mockImplementation((problem) => {
            return false;
            return problem.message.includes("fake submit error");
        });
        vi.spyOn(tsm, "isUnknownUtxoError").mockImplementation((problem) => {
            // "already spent utxo"
            return problem.message.includes("fake submit error");
        });

        tsm.$notifier.on("state:entered", (tsm, state) => {
            if (state === "confirmed") {
                resolve(tsm);
            }
        });

        return promise;
    });

    it("acknoweldges permanent failure when the tx can't ever be valid", async (context: localTC) => {
        // timeout = 5000000
        const { resolve, tsm, reject, promise } = mkSubmitMgr();

        vi.spyOn(tsm, "doSubmit").mockImplementation(async () => {
            await tsm.delayed(1);
            throw new Error("bad txn error");
        });
        vi.spyOn(tsm, "confirmTx").mockImplementation(async () => {
            await tsm.delayed(1);
            debugger;
            return false;
        });
        vi.spyOn(tsm, "isExpiryError").mockImplementation((problem) => {
            return false;
        });
        vi.spyOn(tsm, "isUnknownUtxoError").mockImplementation((problem) => {
            return false;
        });
        tsm.$notifier.on("state:entered", (tsm, state) => {
            if (state === "failed") {
                resolve(tsm);
            }
        });

        return promise;
    });
});

const testTx =
    "84a500d90102818258204c2adc3b66d6dcbfec8163b16ad11f45e0516fa772bf4751dc51a41827515594040182a400581d7014162ee25103a5ce041babfaf579345747baa2b3049fcf8e8e61f9a6011a031d1390028201d81843d87a8003d818592e828202592e7d592e7a0100002223232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232533357346660020020940922930b111191a999ab9a3370e00290020930a999ab9a3370e00290010919191919192999ab9a35333573466e1cd55ce9baa0084804048c8c8cc11000894ccd5cd19981000f001251135333573466e1cd55ce9baa0014802848ccc03c03c03800854ccd5cd19b8735573a6ea8005200e1233300f00f00e00215333573466e1cd55ce9baa0014803049854ccd5cd19b8735573a6ea8005200212615333573466e1cd55ce9baa0014800049854ccd5cd19b8735573a6ea8005201012612600115333573466603e03c0049444d4ccd5cd19b8735573a6ea8005200c1233573664a666ae680045261633302001f0034a066601e01e01c0042a666ae68cdc39aab9d375400290050930a999ab9a3370e6aae74dd5000a401c24c2a666ae68cdc39aab9d375400290010930a999ab9a3370e6aae74dd5000a400024c2a666ae68cdc39aab9d375400290080930930008b18099919aba0375200297ae1103d87980001bae357426ae88014dd61aba135573c6ea800454ccd5cd19b8735573a6ea80212002123235333573466e1cd55ce9baa001480004c8c8c8c8c8c88c8c8c8c8c8c8c94ccd5cd00088010a50333333301b0080063357406ea4dcc002a5eb812824c944010c8d4ccd5cd19b8735573a6ea8005200a124a224940004c0b8004c07ccd5d01ba90064bd70903d87980001b99007330593305800400648004c8dcc9bae001357426ae88d55cf1baa002357426aae78dd50009bae001357420086eb8004d5d08009aba20013574400a2a666ae68cdc39aab9d37540029001099119b87332232323232323330010012253335573e0022c2a666ae68cdd79aab9d3574200200826eb4d55cf1aba10011330020023574400200e444a666aae7c0045854ccd5cd19baf35573a6ae840040144cc008008dd59aab9e3574200226660060060046ae88004d5d09aba2002357420026aae78004dd50009827827198289bae357420046eb8d5d09aba200248004d5d10028930009aba135573c6ea800454ccd5cd19b8735573a6ea802120001323232232323232323233573664646a666ae68cdc3800a40002464a666ae68cdd78008050a4c2c6ae84d55cf1baa00115333573466e1c005200a1235333573466e1cd55ce9baa00948000492612600912600235573a6ea8004c0a80154ccd5cd1a999ab9a3370e6aae74dd500324000246464646a666ae68cdc39aab9d375400a90000919ab9b53335734666666603601a00866ae80dd49b980034bd702510024a0930a4c293191a999ab9a3370e6aae74dd5000a400424c246466ae6cc94ccd5cd0008a4c2c66e5cc8dcc9bae00135742002600a00c6606e0020206eb0d5d09aab9e375400200264666608e0026ea4dcc002119ba548000cd5d0000a5eb80530103d87a80003237566ae84d5d11aba235573c6ea8004cc0a009c028498014c074008c8dcc9bae001357426ae88d55cf1baa002357426aae78dd50008a999ab9a3370e6aae74dd50032400424646464646464646464646464646466ae6cd4ccd5cd0028930924c00c66ae6cc94ccd5cd0008a4c2c6466ebcdd38009ba700e3574401666a666ae6801449854ccd5cd19b8735573a6ea801920001232323232233300100400300230460043237326eb8004d5d09aba2002357420026aae78dd50008919191911998008020018011822001991b99375c0026ae84d5d11aab9e37540046ae84d55cf1baa00100622232325333573400420022940d4ccd5cd19b8735573a6ea8051200212615333573466e1cd55ce9baa0144800048c8cd5cda999ab9a001149858c94ccd5cd00108008a5035333573401624c2a666ae68cdc39aab9d375401890000925113232322323357366a666ae6800c49854ccd5cd19b870044801849854ccd5cd19b8700448038498492600f3233573664a666ae68004526163375e0046ae84d55cf1baa0014a26a666ae68cdc380224000246466e95200033574000297ae03304b304801a02315333573466e1c011200212323374a900019aba00014bd70198259bac357426aae78dd500d0118a999ab9a00e12615333573466e1c011200a12615333573466e1c011200c12615333573400624c2a666ae68cdc38022400c24c24c01e6ae84d5d11aba2357446aae78dd500099b8700148010d55ce8009baa00a00c3305f012235333573466e1cd55ce9baa0014800048c8c8d4ccd5cd19b8735573a6ea800520081232333573466e5c00403128251304d001126001357426ae88004dd61aba135573c6ea8004498004498050d4ccd5cd19b8735573a6ea804d2002124a22a666ae68cdc39aab9d37540269000091a999ab9a0091261232323232335736a666ae68cdcb80098020040a4c2c6464a666ae694ccd5cd0028a5114a020022940d4ccd5cd19b8735573a6ea8041200412335736646a666ae68cdc39aab9d375400290000919191a999ab9a3370e6aae74dd5000a40042464a666ae68cdcb8008078a4c2c646e64dd70009aba1357446aae78dd50008930009982b000a4410374706500357426aae78dd5000893000998219bab357426ae88c168064031288925101032335736a666ae68004526164a26608e004040646e64dd70009aba100135333573466e1cd55ce9baa0094800849848dd61aba135573c6ea8004024ccccccc0ac074018cd5d01ba9373000a97ae04a2605e00c94126302e00500a126013353335734004208424c0066ae84d5d100299b8735573a6ea800520083574200666e1cd55ce9baa00148008d5d08011aba200137586ae84d55cf1baa0013305900148000d5d08009bac357426ae88d5d11822000998130128041bac357426ae88d5d118210009982a002a40002a666ae68cdc39aab9d375400c90020930a999ab9a3370e6aae74dd50032400c2644646464646466ae6cc94ccd5cd0008a4c2c66e1cc14cdd61aba13574400490002999ab9a33302c02b00c4a2266660b200a44600444646466ae6cc8d4ccd5cd19b8735573a6ea80052002123235333573466e1cd55ce9baa0014800049849260013303800500312335736a666ae68cdc3982d802a40002c293191991191919191919ab9b5333573466e1c0052002149858cd5cda999ab9a3372e01600e2930b19ab9b32533357340022930b1919baf374e0086e9c004c8dd61aba135573c6ea8004d5d09aba23574401864a666ae68cdcb8008018a4c2c646a666ae68cdc39aab9d37540029002091919ab9b3235333573466e1cd55ce9baa001480004984926001330433574402801c00260960022a666ae68cdc39aab9d3754002900008258930009aba100c375a6ae84d5d11aba235573c6ea800cc8dcc9bae001357426ae88d55cf1baa00237586ae84d55cf1baa0013306600148008cc12c0052201037470650037326eb8d55ce8009aab9e0013574200a0026ae84008c8d4ccd5cd19b8735573a6ea80052000122330010073574400c244660026604a00e0086ae88018004d5d0801191a999ab9a3370e6aae74dd5000a4010208224c0026ae84d5d10009a999ab9a3370e6aae74dd5001a4000246eb0d5d09aab9e375400224c00646600200a0044466ebcdd30009ba600215333573466605a0560189444c8c8cd5cda999ab9a3370e60aa00290000a4c2c944ccc16801888c8c8d4ccd5cd19b8735573a6ea80052008123232323357366a666ae68cdc39aab9d375400290040924c24c0026a666ae68cdc39aab9d375400490000900489191a999ab9a3370e6aae74dd5000a400424c24646464646a666ae68cdc39aab9d375400290000900809191919191a999ab9a3370e6aae74dd5000a400424c246466ae6d4ccd5cd199ab9a3370e66e0520000050014a0944585263232330010010182253335573e002200226464a666ae68cdd78029aab9d0021330040040011335740004660080080026ae88008d5d08009ba9009375a6ae84d55cf1baa00100133033013006373200a6eb4d5d09aba2357446aae78dd500099835802240040026609e0069101036d706800375c6609c004910102746e003304d00148810374706500357426aae78dd50008009981d0070020011aba13574400a6ae84010c104004498004d5d09aba200135333573466e1cd55ce9baa0014800048dd61aba135573c6ea80044980040054ccd5cd1982b982e02d80789919ab9b53335734666ae68cdc4982a000a4004941288b0a4c660ae60ba0b802060b80b6297adef6c601637566ae84004d5d11822800998138130049bab357420066eb0d5d09aba2002357440062a666ae68cdc39aab9d375400c9006091919ab9b35333573466e1cd55ce9baa0014800049854ccd5cd19b8735573a6ea8005200212615333573466e1cd55ce9baa0014801048c8c8c8c8c8c8c8c8cd5cd991a999ab9a3370e6aae74dd5000a400424c246464646466ae6d4ccd5cd19b8f00200d149858cd5cd9a999ab9a3370e6aae74dd5000a400024c24930009a999ab9a3370e6aae74dd5001a4000249309300199824801a45036d706800375c66090004910102746e003304700148810374706500357426aae78dd50008009981a001004192999ab9a001149858c8cdd79ba6001374c660420060126eacd5d09aba2304b00632323235333573466e1cd55ce9baa0014800849848d5d09aab9e375400200264660ae0020066eb0d5d09aba235573c6ea8180dcc803998150078031bab001357420026ae88c11c004cc0a40a002ccc1600252000375c6ae84d5d11aab9e3754004646e64dd70009aba135573c6ea800454ccd5cd19b8735573a6ea8005200612612498005289aba135573c6ea800454ccd5cd19b8735573a6ea8019200a12612600614a22940d4ccd5cd19b8735573a6ea8005200e12615333573466e1cd55ce9baa0014800848cd5cd992999ab9a001149858ccc094090015280010a999ab9a3370e6aae74dd5000a40002466ae6cc94ccd5cd0008a4c2c66604c04800a94000854ccd5cd19b8735573a6ea8005200c125333573466604c04800a9445300103d879800015333573466604a04800a944530103d87a80001612600135333573466e1cd55ce9baa0044802049854ccd5cd19b8735573a6ea8011200a12615333573466e1cd55ce9baa0044803049300103d87a800015333573466e1cd55ce9baa004480084930103d879800015333573466e1cd55ce9baa004480104930103d87a800015333573466e1cd55ce9baa004480184930103d87f8000124c0103d8798000004303d00130200013302301f30173357406ea400d2f5c2103d87980001aba135573c6ea8004dd70009aba1001357440062a666ae68cdc39aab9d375401090050991919119191919ab9b32533357340022930b199811810800a503232323253335734a666ae694ccd5cd2999ab9a33333330170090073357406ea4dcc00125eb8128801a504985288a5013333302001f01e00500100614a029445280992513235333573466e1cd55ce9baa0014801848c8cd5cd9a999ab9a5333333574800229445280a5014a0294048c8c94ccd5cd0008a4c2c66ebc0314ccd55cf8008b09aba100135573c6ea8004498004c0bc01cd5d09aab9e37540022a666ae68cdc39aab9d37540029008091919ab9b53335734666ae68cdc49828000a4000941288a4c2c6466ae6d4ccd5cd199ab9a3371260a200290002504a22930b19ab9b5333573466e1cc1440052002149858c0c0020ccc1000048d4ccd5cd19b8735573a6ea800520061232353335734a666666ae900045288a5014a0294052809191919ab9b5333573466e1c008008526165333573466ebc040d5d08008a5114a06aae78dd50011aab9d375400224c0026ae84d55cf1baa001124a000297ae037586ae84d55cf1baa001126001302d00414a06e60c008004c8c8dcc9bae001357426aae78dd50009aba1357446ae88008c060010cccc090084078004008c05ccd5d01ba90044bd708103d8798000191b99375c0026ae84d5d11aab9e37540046ae84d55cf1baa001375c0026ae84004d5d10018a999ab9a3370e6aae74dd5004240182464646466ae6cc94ccd5cd0008a4c2c66603e03c002940cd5cd9924c64944c8cd5cd991a999ab9a3370e6aae74dd5000a401024930930009aba13574400264646a666ae68cdc39aab9d37540029002091919ab9b353335734a666666ae900045288a5014a0294052809191919ab9b5333573466e1c008008526163253335734666ae68cdc7805800a504a22c2931bae357420026aae78dd50011aab9d375400224c002605400a6ae84d55cf1baa00115333573466e1cd55ce9baa0014804048c8cd5cda999ab9a333573466e24c12c00520004a09445261632335736a666ae68ccd5cd19b89304c0014800128251149858cd5cda999ab9a3370e609800290010a4c2c605600c66607600246a666ae68cdc39aab9d375400290050930a999ab9a3370e6aae74dd5000a401824c2a666ae68cdc39aab9d375400290070930a999ab9a3370e6aae74dd5000a400824646a666ae694cccccd5d20008a5114a029405280a50123232335736a666ae68cdc38010010a4c2c64a666ae68ccd5cd19b8f00e0014a0944585289bae357420026aae78dd50011aab9d375400224c0026ae84d55cf1baa001124a000297ae037586ae84d55cf1baa00112600130280023732006666604203c0360020066466ae6d4ccd5cd19baf001001149858cd5cda999ab9a3372e9210873657474696e677300004132498c8dd71aba135573c6ea8004c8d4ccd5cd19b8735573a6ea800520021261232323374a900019aba0375200297ae0375c6606e002910102746e00357426aae78dd500080099198129bab357426ae88c0f000524010f63757272656e7453657474696e6773003304e301f00248000526533357346666603403203000400600829445281919191a999ab9a3370e6aae74dd5000a400424c246ae84d55cf1baa001001323304700100337586ae84d55cf1baa05037320066603400200460286466ae80dd4800a5eb8503d87980001bae357426ae88018dd71aba1357446aae78dd5001191b99375c0026ae84d55cf1baa00115333573466e1cd55ce9baa0084803849854ccd5cd19b8735573a6ea80212004124a22a666ae68cdc39aab9d3754010900309251124a20102a666ae68c94ccd5cd1a999ab9a3370e6aae74dd5004a40042494454ccd5cd19b8735573a6ea80252000123235333573466e1cd55ce9baa0014800049849288009aba135573c6ea800454ccd5cd19b8735573a6ea8025200612323235333573466e1cd55ce9baa0024800048c8ccccccc048dd71aba13574401200297ae10107466d656d626572002504992824c6ae84d55cf1baa00115333573466e1cd55ce9baa0024801048cd5cd9924c64944cc08c07c00928891919ab9b32498c9289981201000199ab9b32533357340022930b19b8730483304b305105000648008cd5cd9924c66e59241176f6b2c206d696e74696e672066756e6769626c65733a20003732002944dd71aba135573c6ea8004008c050cd5d01ba90034bd70903d87980001aba135573c6ea800454ccd5cd19b8735573a6ea8025200a124a22a666ae68cdc39aab9d375401290060925115333573466e1cd55ce9baa0094803849288930048a5113371e6ecc12cdd9803991bae357426ae88004dd61aba135573c6ea80185288b0a503001323237566ae84d5d11aab9e37540026ae84d5d11aab9e3754002a08464464646466e58cdcb19b9600149103202b2000002003323233300100100249010022253335573e004292010013372c66e58004dcc9bae357420046660060066ae88009240103202b20003233304b001223322330423357406ea4dcc182700099aba04c010847c397f09f92b42000335740646ea4dcc0009b990024bd700021bae35573a0026eb4d55cf000a5eb80cc11c00c010cdcb19192999ab9a337100049000099b96491012d00300133704004900089800801119b96304a33706a666ae68cdc4000a4000266e08005200110014820225e8cdcb249012e0037326464666600200200490002450022225333573466e1c00d200015333573466e25200c00210011333300400448000cdc00012400466e2d20600011333300400433706006900a19b8000248008cdc599b803370c006900a240c000266e180052080897a3230323370866e0800520808095e789c60448202a35ae41cc8cdc219b80001333573466e200052000482fe10f520c0843d4820225e8c8c0c8cdc219b82001482036b10252080a8d6b9073233704002904044bd19199800800912999aab9f00114800054ccd5cd19baf35573a6ae8400530010140001375a6aae78d5d08008998010011aba200100322253335573e002290000a999ab9a3375e6aae74d5d0800a6101400013300200237566aae78d5d080089998018018011aba2001491042041444100303f3302433303200123233357340029412899b8f375c6aae740052201004bd6f7b63011199ab9a3371e008004941289bae357426ae88004dd60009aba135573c0026ea800448d4ccd5cd19b8735573a6ea800d200212615333573466e1cd55ce9baa0034800049848d4ccd5cd19b8735573a6ea8011200212615333573466e1cd55ce9baa0044800049849280020018019aab9d37540044464646600200200844a666aae7c00440044c8c94ccd5cd19baf00535573a004266008008002266ae80008cc010010004d5d10011aba100137526e600048888888c8c8c8c8c8cd5cda999ab9a33357346608c004018941288b0a4c6466ae6ccc04000488c9263732004646466ae6ccd5cd99809000911924c6e64008c92630423302700522333573466e3c0080452825132335736a666ae6800452616335736649319ab9b5333573464666ae68005282513304037586ae84d55cf1baa04e23375e6ae84d55cf1baa001010161499289919ab9b533357340022930b2999ab9a002100114a0a666ae68c8ccd5cd000a504a2608401029444c94ccd5cd18218008a511335736646600200200444a666aae7c0045261323357366644646603400444a666ae68c8ccd5cd000a504a2646a666ae68cdc39aab9d375400290010925012323370e0020086eb4d5d09aab9e3754002002660360060042c293198278060011bae35573a0026eacd55cf000998018019aba2002357420029454ccd5cd198250028080991919800800803912999aab9f0011001132325333573466ebc014d55ce801099802002000899aba000233004004001357440046ae84004dd4808080299baf374c0026e9800ccc03c0048888cdc8002001198230018069980699822800806111119b9000400233037330374bd6f7b630001991919800800801112999aab9f00114bd6f7b63009981d1bab35742002660040046ae88004c8cc004004028894ccd55cf8008a5eb804cd5d01ba6323333303000e4a2600e0029412637326eb8d5d0800998010011aba2001304904832324a260420026608c646464646609464660960029000181a991aba1357446ae88d55cf1baa001357426ae88d55cf1baa00148000c8d4ccd5cd19b8735573a6ea8005200012357426aae78dd500089191a999ab9a3370e6aae74dd5000a4000246ae84d55cf1baa001126001323304300100437586ae84d55cf1baa04c001330400030012330353237566ae84d5d11aab9e37540026ae84d5d11aab9e375400200460560146eb0d5d09aba235573c6ea811d2000533357340062004297adef6c605333573400820062601600c44646600200200644a666aae7c00440044c8c8c8cc00400400c894ccd55cf800899aba00030011325333573466660106eb8d55ce8021bad35573c0086eb8d55ce8009bad35573c002266ae800100084cd5d0000998018019aba2002357420026ae84008cc008008d5d10009119998158011ba900123374a900019aba00014bd700a60103d87a80002232330010010032253335573e00229309919ab9b33004375c6aae74004dd69aab9e00133003003357440046ae840048c8c8c8c8c8c88cdcb19b96001491012d0000230423337189000240186e500054ccd5cd199ab9a337126e3400920124a0944584cdc519b8a00148810140000023337189005240806ecc00cdd99ba8001375a6ae84d5d11aab9e37540046ae84d55cf1baa00123235333573466e1cd55ce9baa001480084800c54ccd5cd19b8735573a6ea80052004126123232323357406ea400ccd5d019ba548008cd5d000099aba00024bd7025eb80cc0f4c8cc0f80052000302832357426ae88d5d11aab9e37540026ae84d5d11aab9e3754002900019191a999ab9a3370e6aae74dd5000a4000246ae84d55cf1baa001126001323303500123302b3237566ae84d5d11aab9e37540026ae84d5d11aab9e37540020066eb0d5d09aba235573c6ea80f8c080004dd71aba1003001357426ae880048c8d4ccd5cd19b8735573a6ea800520041200315333573466e1cd55ce9baa0014800849848c8c8c8c8cd5d01ba900433574066e95200433574000266ae800092f5c097ae03303d323303e00148000c0a0c8d5d09aba2357446aae78dd50009aba1357446aae78dd5000a4000646a666ae68cdc39aab9d37540029000091aba135573c6ea8004498004c8cc0d00048cc0a8c8dd59aba1357446aae78dd50009aba1357446aae78dd50008019bac357426aae78dd501e980f8009bae357420060026ae84d5d10009119191981880092999ab9a3302737566ae84d5d11aab9e3754002008266ebcd5d09aab9e37540020062940dd61aba1357446ae88d55cf1baa03a30223007002222323235333573466e1cd55ce9baa0014800849848d5d09aab9e3754002002660080066666603c6eb8d5d0801a50499288011b99001222223235333573466e1cd55ce9baa0014801048c8c94ccd5cd19199ab9a3371e00200e941289bae33023002488103406964001615333573464666ae68cdcb8008032504a2646e64dd700099811801244103747065001614a26e64014c074008498004c090c8d5d09aba2357446aae78dd5000999802802001801111912999ab9a3375e60420020042646a666ae68cdc39aab9d3754002900209192999ab9a3371e00c91010014a2266e3cdd719810000a450340696400006301b002124a00026044646ae84d5d11aba235573c6ea8004d5d09aba235573c6ea8004528180f98020011111199119aba0374e00a66ae80010cd5d000199aba00023357406ea40052f5c0664464646a666ae68cdc39aab9d3754002900109309191919191a999ab9a3370e6aae74dd5000a40002400224c0026606a0104a666ae68cdd7991aba135573c6ea8004c0a400400c4cc0acc8dd59aba1357446aae78dd50009aba1357446aae78dd50008010a50333330220064a200a941263374a900119aba0375200297ae0375c6ae84d55cf1baa001001357426ae88018c8dcc9bae0013574200a6eb0d5d09aab9e375406e6eb8d5d08021bae357420084646a666ae68cdc39aab9d37540029001091aba1357446aae78dd50008a999ab9a3370e6aae74dd5000a4008246ae84d5d11aab9e375400224c0026ae84d5d100091191a999ab9a3370e6aae74dd5000a40082466068603e646ae84d5d11aba235573c6ea8004c8c8cc004004008894ccd55cf8008b0992999ab9a5333573466ebcd5d09aab9e37540026044601000e2660486eacd5d09aba235573c6ea8004ccccc074dd71aba10074a29210763686172746572004a0930a501001133003003357440046ae84004dd61aba1357446ae88d55cf1baa03548000498004d5d09aba200123235333573466e1cd55ce9baa0014800848c8cc0cc0052000357426aae78dd50008a999ab9a3370e6aae74dd5000a400824646606600290001aba135573c6ea8004498004d5d09aba2001222323232335736a666ae694ccd5cd0008a5113335734006941288a4c2c0026603e646eacd5d09aba235573c6ea8004d5d09aba235573c6ea8004cc044c8dd61aba135573c6ea8004c014010dd71aba1004502c53335734002294052891119191919ab9b53335734a666ae680045288999ab9a0034a0944526160013301e3237566ae84d5d11aab9e37540026ae84d5d11aab9e3754002660206018600a0086eb8d5d08022815a999ab9a00114a029448888c8d4ccd5cd19b8735573a6ea80052002126123233235333573466e1cd55ce9baa0014800848c8c88cc00400c008c8dcc9bae001357426ae88d55cf1baa00237586ae84d55cf1baa0011260013301900148903747065002233330080070023374a900419aba037526e600192f5c066e9520003357406ea4dcc000a5eb80d5d09aab9e37540020026600c646eacd5d09aba2301e00130040020012233573664a666ae6800452616330093237586ae84c06c004c008004dd71aba100100122333301a00237526e600048cdd2a400066ae800052f5c02980103d87a800023235333573466e1cd55ce9baa0014800049854ccd5cd19b8735573a6ea80052002126123232323235333573466e1c005200412615333573466e1c005200812615333573466e1c00520021200415333573466e1c005200a1200415333573466e1c0052006120041200400335573a0026ea8004c040004d5d09aba235573c6ea8004004d5d09aba2001232323232323232335736a666ae680045261633573664a666ae68004526163300c00700500835333573466e1cd55ce9baa0024800048c8cd5cd992999ab9a001149858cc074cc0640c800400cc8d4ccd5cd19b8735573a6ea80052000124a224c0026466052002466e3cdd99aba1357446ae88d55cf1baa001376664646ae84d5d11aba235573c6ea8004d5d09aba235573c6ea8004d5d09aab9e37540126eb0d5d09aba2357446aae78dd50191bae357426aae78dd500089300119999809801a510024a0931aba135744008646e64dd70009aba1003375c6ae84d5d11aba2357446ae8800cd5d09aba2357446ae88008dd61aba1001232323357366a666ae694cccccd5d20008a5114a029405280a501232498d55ce9baa00112498004004c030004c8d5d09aab9e37540026ae84d5d11aba23574400246eb0d5d09aba2357446ae88d55cf1baa00122333010002233002375c6aae74004dd59aab9e0014bd6f7b630111919191919ab9b53335734a666ae68ccd5cd000a504a229445280b0a4c0026a666ae68cdc39aab9d3754004900009191980b998098160008019bae357426aae78dd500089191a999ab9a3370e6aae74dd5000a4000249444928000991981100091980c1bab357426ae88d55cf1baa00100437586ae84d5d11aba235573c6ea80ac008ccccc03400d28801250498d5d09aba20033237326eb8004d5d080111198148009b983237326eb8004d5d08011119999804800a513237326eb8004d5d08012504988c8dcc9bae001357426ae88d5d11aab9e37540024646e64dd70009aba1357446ae88d55cf1baa00123237326eb8004d5d09aab9e375400246a666ae694cccccd5d20008a5114a029405280a50123232353335734a666666ae900045280a5114a02940528091aba1003126001357420026aae78dd50008930009191919199980780100090008b1919800800801112999aab9f00116132533357346a666ae68cdc39aab9d375400290010919baf357426aae78dd5000803092500011001133003003357440046aae74d5d08009bab357426ae88d5d11aba23574460180406ae84d55cf1baa0012333330020014a29210763686172746572004a09311111191919ab9b53335734666ae68cdc49b8d0014800128251149858cc09ccc09801c005200253335734006200426e600054ccd5cd00208018a4810022323232330010010032253335573e0022c2646464a666ae68cdd780100308008998028029aba200435573c0046aae74004d5d08009ba90023756004466e00cdc2000a402866e10cdc2800a40289005111919980d00091198060011bab357426ae88d55cf1baa0014bd6f7b630191998020009192999ab9a3370e6aae74dd5000a4004266e3c010c8dd71aba135573c6ea8004cc074005200214a0646ae84d55cf1baa001357426aae78dd5000a5eb80dd61aba1357446ae88d55cf1baa0022223233300100100400322253335573e0042008264a666ae68c0080044cd5d00009998020021aba20030021333004004357440060046ae840088c8d5d09aab9e37540026ae84d5d11aab9e37540024646464a666ae68cdc38012400826ae8400458d55cf0011aab9d00137540024464660020026601000600444a666aae7c0045288992999ab9a323335734002941289991191980080099806801801112999aab9f00114a2264a666ae68c8ccd5cd000a504a26644666ae68cdc4001000a504a26602400a0026602400800229404cc00c00cd5d10011aba1001330090050013300900400114a02660060066ae88008d5d080091aba2357446ae88d5d11aba235573c6ea80048888c8ccc0040040140108894ccd55cf8010020992999ab9a3375e0046aae740044c018d55cf00089998020021aba2003002357420044464660020026600a00600444a666aae7c00452f5bded8c02646464a666aae7c00440084cd5d019bb0003374c002004664464660020026601600600444a666aae7c00452f5bded8c02646464a666ae68cdc3800a40002004266ae80cdd80019ba8001002337006602200c0046602200a004660060066ae88008d5d08009980380300119803802801198018019aba20023574200244646600200200644a666aae7c00452f5bded8c02a666ae68cdd79aab9d3574200200626eacd55cf1aba1001133002002357440024464646600a004666002002004006444a666aae7c00452f5c0264a666ae68cc0240148cdd780080109998020020019aba200213357400026660080080066ae88008d55ce9aba100132330010010032253335573e002297ae013357406aae74d5d0800998010011aba2001223233300100100200322253335573e0022004266ae80d5d08009998018018011aba2001223233300100100300222253335573e004294054ccd5cd18009aba100214a226660060066ae8800800488c8ccc00400400c0088894ccd55cf8010a40002a666ae68cdd79aab9d3574200400226eb4d55cf1aba10021333003003357440040024646600200200444a666aae7c0045288a999ab9a3232330010010022253335573e002294454ccd5cd19b87375a6aae78d5d0800a40002660040046ae880045281bab35573c6ae840044cc008008d5d10008a50233300a001223233300d37566aae7800888c8c8cdcb0022999ab9a3371e00a91010013372c92010a6c6f76656c6163653a20003372c60200029201010a0013372c602a00a66e592401012e003372c602a00466e59241023a20003372c60200029201010a00375a6aae78008dd71aab9d001003375c6aae7400524100223233300100100300222253335573e004298103d87a8000132533357346004002266e95200033574000297ae01333004004357440060046ae8400888c8ccc00400400c0088894ccd55cf8010a5115333573460026ae840084ccc00c00cd5d10010008a50232330010010022253335573e00229000099b803300200235744002900109919198008009bac357426aae78dd5004912999aab9f001161325333573466ebcd5d09aab9e375400200820022660060066ae88008d5d08009aba135573c6ea8004d5d09aba200b223232330010010042253335573e0022c2a666ae68cdd79aab9d3574200200626eacd55cf1aba1001133002002357440026ea400488c8c8cc004004010894ccd55cf8008a5015333573466ebcd55ce9aba100100314a22660040046ae88004dd480091b99325333573466e200092000133716902d19980080099b820024800522100133300100100248900222325333573466e2000d20141001133300400433706006900a00099b8b3370066e18009201448180004888c8ccc0040040100088894ccd55cf801080089998018019aba2002330050013574200444a666ae68cdc39aab9d375400400220042c6ae840148dd59aba1357446ae88d5d11aba235573c6ea80048c8cc00400400888c94ccd5cd19b88480000044cdcb1b9932333573466e1cdc6800a400466e2d2060001001373064646e654ccd5cd19b88002480004cdc5a40b466600200266e0800920014890013330010010024890022232325333573466e2001120201001133300500533706008901000099b8b333573466e20005201433700002903019b80001482b804008cdc30012404066e3800920003300300333371890010008010a4900371a0024466e9520003357406ea4008cd5d01ba90014bd7011191919aba0337600046e98cd5d019bb0001375000697adef6c604bd6f7b6301aba1357446aae78dd50019aba135573c6ea8008d55cf0009baa0011a20058390045e892bc99aeb4ce3606ae1c5deca664e83aa97c9ff7214fbd08b51ce007c13f07e7767a66ecf9b5a2476801fb4c95a0fbee4bab2d3292a7011a0e640a7e021a000aa8e1031a051d7e01081a050dac01a100d90102818258206f0c719a9e9dd78adc078445cdaa4bf4fba60a663d89a541e1af1cbdde07ca8f58406011b391a7a0bd601961b99b3276c37ad0a50fd0a167e4df23100d4265121264f83eff02c90d7547b1df6185d1eeb8076f554da01cd2ba8342919bcb23e3fa06f5f6";
